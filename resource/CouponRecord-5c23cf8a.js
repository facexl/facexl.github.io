import{d as e,u as a,r as t,m as n,o,$ as i,G as s,a as d,b as r,e as l,w as c,f as u,M as p,F as m,q as _,z as g,s as h,p as k,B as f,X as b,A as y,E as v,_ as x}from"./index-c2ae2a0e.js";import{u as w,_ as C}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as R}from"./index-ef11d20c.js";import{u as j,a as D}from"./useSearchItems-c7d75cf3.js";import{u as I}from"./usePagination-c05046ed.js";import{d as q}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const Y={class:"coupon-record"},E=x(e({__name:"CouponRecord",setup(e){a();const x=j([["input","uid","用户ID"],["input","cid","优惠券ID"],["input","coupon_name","优惠券名称"],["input","coupon_remark","优惠券备注"],["dateRange","send_start-send_end",["发放时间开始","发放时间结束"]],["dateRange","effect_start-effect_end",["生效时间开始","生效时间结束"]],["dateRange","expire_start-expire_end",["到期时间开始","到期时间结束"]],["dateRange","used_start-used_end",["使用时间开始","使用时间结束"]],["select","is_used","是否使用"],["input","use_order_sn","使用订单号"],["select","source","来源"],["input","get_order_sn","来源订单号"],["select","enabled","状态"]]),E=w([["编号","id"],["用户ID","uid"],["优惠券ID","cid"],["优惠券名称","name"],["优惠券备注","remark"],["满金额","limit_money"],["减金额","money"],["发放时间","created_at"],["生效时间","start_at"],["到期时间","end_at"],["是否使用","is_used"],["使用订单号","use_order_id"],["使用时间","used_at"],["来源","source"],["来源订单号","get_order_id"],["状态","enabled"],["操作","operate",140,"right"]]),S=t(),H=n({time:[]}),M={required:!0,message:"请输入"},O=n({activeName:"Coupon",loading:!1,pagination:I(),query:{},dataSource:[],link:"",linkDialogVisible:!1,linkImg:"",handlingId:"",showNewDialog:!1,showEditVisible:!1});o((()=>{V()}));const V=async()=>{try{O.loading=!0;const{data:e}=await i.act.couponRecord.list({...O.query,page:O.pagination.current,page_size:O.pagination.pageSize});1===O.pagination.current&&(O.pagination.total=+(null==e?void 0:e.count)),O.dataSource=e.items,D(x,"is_used",{0:"未使用",1:"已使用",2:"已过期"}),D(x,"enabled",{1:"启用",0:"禁用"}),D(x,"source",{1:"系统",2:"订单",3:"充值",6:"抽奖活动",10:"任务"}),O.loading=!1}catch(e){O.loading=!1}},T=()=>{S.value.validate().then((async e=>{e.time&&e.time.length&&(e.start=e.time[0],e.end=e.time[1]),delete e.time,await i.act.couponRecord.edit({id:O.handlingId,...e}),O.showEditVisible=!1,V()})).catch((e=>{console.log(e)}))},U=e=>{O.pagination={...O.pagination,...e},V()},z=e=>{O.query=e,O.pagination={...O.pagination,current:1},V()};return(e,a)=>{const t=s("Export"),n=s("Search"),o=R,w=f,j=C,D=b,I=y,B=v,F=p;return d(),r("div",Y,[l(n,{"search-options":u(x),onOnSearch:z},{default:c((()=>[l(t,{query:u(O).query,api:u(i).act.couponRecord.export},null,8,["query","api"])])),_:1},8,["search-options"]),l(j,{"row-key":"order_id","data-source":u(O).dataSource,columns:u(E),scroll:{x:"max-content"},loading:u(O).loading,pagination:u(O).pagination,onChange:U},{bodyCell:c((({column:e,record:a})=>["is_used"===e.key?(d(),r(m,{key:0},[_(g(a.is_used?"已使用":"未使用"),1)],64)):h("",!0),"enabled"===e.key?(d(),k(o,{key:1,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{q.confirm({title:"提示",content:1===e.enabled?"启用后，优惠券将会展示在用户的优惠券列表并可以使用":"禁用后，优惠券将不会展示在用户的优惠券列表并不可以使用",okText:"确认",cancelText:"取消",onOk:async()=>{await i.act.couponRecord.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1})),V()},onCancel:()=>{e.enabled=1===e.enabled?0:1}})})(a)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===e.key?(d(),r(m,{key:2},[l(w,{type:"link",onClick:e=>{return(t=a).start_at&&t.end_at?H.time=[t.start_at,t.end_at]:H.time=void 0,O.handlingId=t.id,void(O.showEditVisible=!0);var t}},{default:c((()=>[_(" 编辑 ")])),_:2},1032,["onClick"]),l(w,{type:"link",class:"danger-color",onClick:e=>{return t=a.id,void q.confirm({title:"提示",content:"确认删除？删除后相当于用户没有领取该优惠券，可以重新领取",okText:"确认",cancelText:"取消",onOk:async()=>{await i.act.couponRecord.del({id:t}),V()}});var t}},{default:c((()=>[_(" 删除 ")])),_:2},1032,["onClick"])],64)):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),l(F,{visible:u(O).showEditVisible,"onUpdate:visible":a[1]||(a[1]=e=>u(O).showEditVisible=e),visibleModifiers:{sync:!0},title:"编辑",width:"640px","mask-closable":!1,onOk:T},{default:c((()=>[l(B,{ref_key:"formRef",ref:S,model:u(H),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:15}},{default:c((()=>[l(I,{name:"time",label:"用券时间",rules:M},{default:c((()=>[l(D,{value:u(H).time,"onUpdate:value":a[0]||(a[0]=e=>u(H).time=e),"show-time":{format:"HH:mm:ss"},"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-747479c8"]]);export{E as default};
