import{d as e,a0 as a,i as o,r as i,m as t,l,a as s,b as r,e as d,w as n,f as _,k as c,$ as u,M as p,F as f,n as v,p as m,q as b,z as h,V as g,W as y,A as w,I as k,E as x,o as L,a7 as R,h as O,H as I,g as j,x as U,y as E,B as F,S,cN as C,s as T,_ as q}from"./index-c2ae2a0e.js";import{u as D,_ as M}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as V}from"./index-00d344de.js";import{C as B}from"./index-1dfc023a.js";import{D as $,_ as A}from"./index-923a8554.js";import{_ as N}from"./RemarkOrder.vue_vue_type_script_setup_true_lang-d3464674.js";import{_ as z}from"./Transport.vue_vue_type_script_setup_true_lang-724b9997.js";import{d as G}from"./dtool-b3945d0c.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";import"./index-b1df7cdb.js";const H=e({__name:"EditLogisticsSn",props:{show:Boolean,id:{type:[String,Number],default:""}},emits:["fresh"],setup(e,{emit:L}){const R=e;a("enums");const O=o(R,"show",L),I=i(),j={required:!0,message:"请输入"},U=t({logistics_code:void 0,logistics_sn:void 0}),E=t({logisticsMap:void 0});l(O,(e=>{e&&!E.logisticsMap&&(I.value&&I.value.resetFields(),u.common.getLogisticsMap({}).then((e=>{E.logisticsMap=e.data})))}));const F=()=>{I.value.validate().then((async e=>{await u.order.orderList.editLogisticsSn({...e,order_id:+R.id||void 0}),O.value=!1,L("fresh")})).catch((e=>{console.log(e)}))};return(e,a)=>{const o=g,i=y,t=w,l=k,u=x,L=p;return s(),r("div",null,[d(L,{visible:_(O),"onUpdate:visible":a[2]||(a[2]=e=>c(O)?O.value=e:null),width:"550px",title:"修改物流信息","mask-closable":!1,onOk:F},{default:n((()=>[d(u,{ref_key:"formRef",ref:I,model:_(U),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:17}},{default:n((()=>[d(t,{label:"快递",name:"logistics_code",rules:j},{default:n((()=>[d(i,{value:_(U).logistics_code,"onUpdate:value":a[0]||(a[0]=e=>_(U).logistics_code=e),placeholder:"请选择快递公司",style:{width:"200px"}},{default:n((()=>[(s(!0),r(f,null,v(_(E).logisticsMap||{},((e,a)=>(s(),m(o,{key:a,value:a},{default:n((()=>[b(h(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),d(t,{label:"物流单号",name:"logistics_sn",rules:j},{default:n((()=>[d(l,{value:_(U).logistics_sn,"onUpdate:value":a[1]||(a[1]=e=>_(U).logistics_sn=e),placeholder:"请输入物流单号",maxlength:40},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}}),J=e({__name:"EditReceiveInfo",props:{show:Boolean,id:{type:[String,Number],default:""},handlingInfo:{type:Object,default:()=>{}}},emits:["fresh"],setup(e,{emit:O}){const I=e;a("enums");const j=o(I,"show",O),U=i(),E={required:!0,message:"请输入"},F=t({receiver_name:void 0,receiver_phone:void 0,receiver_province_code:void 0,receiver_city_code:void 0,receiver_district_code:void 0,receiver_address:void 0}),S=t({loading:!1,proviceList:[],cityList:[],districtList:[]});L((()=>{T(1,void 0)})),l(j,(e=>{e&&(U.value&&U.value.resetFields(),I.id&&(S.loading=!0,setTimeout((e=>{for(let a in F)void 0!==I.handlingInfo[a]&&(F[a]=I.handlingInfo[a]);setTimeout((e=>{S.loading=!1}),50)}),50)))})),l((()=>F.receiver_province_code),(e=>{e&&T(2,e),S.loading||(F.receiver_city_code=void 0,F.receiver_district_code=void 0)})),l((()=>F.receiver_city_code),(e=>{e&&T(3,e),S.loading||(F.receiver_district_code=void 0)}));const C=e=>{let a="provice";return 2===e&&(a="city"),3===e&&(a="district"),a},T=(e,a)=>{let o=C(e);u.common.getAreaList({level:e,code:a,is_select:1}).then((e=>{S[o+"List"]=e.data}))},q=(e,a)=>{let o=C(e),i=S[o+"List"];for(let t=0;t<i.length;t++)if(i[t].code===a)return i[t].name},D=()=>{U.value.validate().then((async e=>{e.receiver_province_code&&(e.receiver_province=q(1,e.receiver_province_code)),e.receiver_city_code&&(e.receiver_city=q(2,e.receiver_city_code)),e.receiver_district_code&&(e.receiver_district=q(3,e.receiver_district_code)),await u.order.orderList.editReceiveInfo({...e,order_id:I.id||void 0}),j.value=!1,O("fresh")})).catch((e=>{console.log(e)}))};return(e,a)=>{const o=k,i=w,t=g,l=y,u=R,L=x,O=p;return s(),r("div",null,[d(O,{visible:_(j),"onUpdate:visible":a[6]||(a[6]=e=>c(j)?j.value=e:null),width:"550px",title:"修改收货人信息","mask-closable":!1,onOk:D},{default:n((()=>[d(L,{ref_key:"formRef",ref:U,model:_(F),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:17}},{default:n((()=>[d(i,{label:"收货人姓名",name:"receiver_name",rules:E},{default:n((()=>[d(o,{value:_(F).receiver_name,"onUpdate:value":a[0]||(a[0]=e=>_(F).receiver_name=e),placeholder:"请输入收货人姓名"},null,8,["value"])])),_:1}),d(i,{label:"手机号码",name:"receiver_phone",rules:E},{default:n((()=>[d(o,{value:_(F).receiver_phone,"onUpdate:value":a[1]||(a[1]=e=>_(F).receiver_phone=e),placeholder:"请输入手机号码"},null,8,["value"])])),_:1}),d(i,{name:"receiver_province_code",label:"所在区域",rules:E},{default:n((()=>[d(l,{value:_(F).receiver_province_code,"onUpdate:value":a[2]||(a[2]=e=>_(F).receiver_province_code=e),style:{width:"140px"},"allow-clear":"",placeholder:"省",rules:E},{default:n((()=>[(s(!0),r(f,null,v(_(S).proviceList,(e=>(s(),m(t,{key:e.code},{default:n((()=>[b(h(e.name),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1}),d(i,{name:"receiver_city_code",label:" ",class:"no-label-colon",rules:E},{default:n((()=>[d(l,{value:_(F).receiver_city_code,"onUpdate:value":a[3]||(a[3]=e=>_(F).receiver_city_code=e),style:{width:"140px"},"allow-clear":"",placeholder:"市"},{default:n((()=>[(s(!0),r(f,null,v(_(S).cityList,(e=>(s(),m(t,{key:e.code},{default:n((()=>[b(h(e.name),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1}),d(i,{name:"receiver_district_code",label:" ",class:"no-label-colon",rules:E},{default:n((()=>[d(l,{value:_(F).receiver_district_code,"onUpdate:value":a[4]||(a[4]=e=>_(F).receiver_district_code=e),style:{width:"140px"},"allow-clear":"",placeholder:"区"},{default:n((()=>[(s(!0),r(f,null,v(_(S).districtList,(e=>(s(),m(t,{key:e.code},{default:n((()=>[b(h(e.name),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1}),d(i,{label:"详细地址",name:"receiver_address",rules:E},{default:n((()=>[d(u,{value:_(F).receiver_address,"onUpdate:value":a[5]||(a[5]=e=>_(F).receiver_address=e),placeholder:"请输入详细地址",style:{"min-height":"100px"}},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}}),K={class:"orderDetail-container card-container"},P={class:"top-btn"},W={class:"left-text"},Q={style:{color:"#fc5855"}},X={class:"right-btn"},Y={key:0},Z={key:1},ee=q(e({__name:"OrderDetail",setup(e){a("enums");const o=O(),l={required:!0,message:"请输入"},c=o.params.id,v=t({showRemarkOrder:!1,showEditLogisticsSn:!1,showEditReceiveInfo:!1,loading:!1,base_info:{},recipient_info:{},goods_info:{},fee_info:{},operate_info:[],closeOrderVisible:!1,showTransoprt:!1,handlingRow:{}}),g=i(),y=t({type:void 0,money:"",add_fee:"",is_quality:void 0,add_type:void 0,is_deduct_rebate:void 0,is_deduct_integral:void 0,freight_type:0,freight_fee:"",complete_required:void 0,remark:"",operate_remark:""}),R=t({password:""}),q=D([["商品图片","sku_thumb"],["商品名称","goods_title",150],["规格","sku_name",150],["商品ID","goods_id"],["价格","market_price"],["数量","nums"],["小计","subtotal"]]),ee=D([["商品图片","sku_thumb"],["商品名称","goods_title",150],["规格","sku_name",150],["商品ID","goods_id"],["价格(积分)","market_price"],["数量","nums"],["小计(积分)","subtotal"]]),ae=D([["操作者","operator"],["操作时间","operate_at"],["操作类型","operate_type"],["操作说明","operate_content"],["备注","operate_remark"]]);L((()=>{oe()}));const oe=async()=>{v.loading=!0;const e=await u.order.orderList.detail({id:c});v.loading=!1,e.data.goods_info.sku_items.push({nums:e.data.goods_info.total_num,subtotal:e.data.goods_info.total_market_price,sku_thumb:"合计"}),G().insertPartForm(v,e.data),G(e.data.sale).insertForm(y)},ie=()=>{g.value.validate().then((async e=>{await u.order.orderList.close({order_id:+c,...R}),oe(),v.closeOrderVisible=!1})).catch((e=>{console.log(e)}))};return(e,a)=>{const o=F,i=$,t=A,y=B,L=V,O=M,D=S,G=k,te=w,le=x,se=p,re=I("permission");return s(),r("div",K,[j("div",P,[j("div",W,[d(_(C),{style:{color:"#fc5855"}}),b("当前订单状态： "),j("b",Q,h(_(v).base_info.status_name||"--"),1)]),j("div",X,[U((s(),m(o,{type:"primary",ghost:"",onClick:a[0]||(a[0]=e=>_(v).showEditLogisticsSn=!0)},{default:n((()=>[b(" 修改物流信息 ")])),_:1})),[[re,[_(u).order.orderList.editLogisticsSn]]]),U((s(),m(o,{type:"primary",ghost:"",onClick:a[1]||(a[1]=e=>_(v).showEditReceiveInfo=!0)},{default:n((()=>[b(" 修改收货人信息 ")])),_:1})),[[re,[_(u).order.orderList.editReceiveInfo]]]),U((s(),m(o,{type:"primary",ghost:"",onClick:a[2]||(a[2]=e=>_(v).showRemarkOrder=!0)},{default:n((()=>[b(" 备注订单 ")])),_:1})),[[re,[_(u).order.orderList.addRemark]]]),U((s(),m(o,{danger:"",onClick:a[3]||(a[3]=e=>_(v).closeOrderVisible=!0)},{default:n((()=>[b(" 关闭订单 ")])),_:1})),[[E,7!==_(v).base_info.status&&8!==_(v).base_info.status],[re,[_(u).order.orderList.close]]])])]),d(D,{spinning:_(v).loading},{default:n((()=>[d(y,{title:"基本信息"},{default:n((()=>[d(t,{layout:"vertical",bordered:"",column:5},{default:n((()=>[d(i,{label:"订单编号"},{default:n((()=>[b(h(_(v).base_info.order_sn||"--")+" ",1),_(v).base_info.parent_order_sn?(s(),r("br",Y)):T("",!0),b(" "+h(_(v).base_info.parent_order_sn?`主订单号：${_(v).base_info.parent_order_sn}`:""),1)])),_:1}),d(i,{label:"订单来源"},{default:n((()=>[b(h(_(v).base_info.client_type||"--"),1)])),_:1}),d(i,{label:"供应商"},{default:n((()=>[b(h(_(v).base_info.supplier_name||"--"),1)])),_:1}),d(i,{label:"用户账号"},{default:n((()=>[b(h(_(v).base_info.username||"--")+" ",1),d(o,{onClick:a[4]||(a[4]=a=>e.$router.push({name:"userDetail",params:{id:_(v).base_info.uid,type:"detail"}}))},{default:n((()=>[b(" 查看 ")])),_:1})])),_:1}),d(i,{label:"支付方式"},{default:n((()=>[b(h(_(v).base_info.pay_type||"--"),1)])),_:1}),d(i,{label:"物流单号"},{default:n((()=>[b(h(_(v).base_info.logistics_sn||"--")+" ",1),_(v).base_info.logistics_sn?(s(),r("a",{key:0,type:"link",href:"javascript:;",onClick:a[5]||(a[5]=e=>{_(v).showTransoprt=!0,_(v).handlingRow={..._(v).base_info,..._(v).recipient_info}})}," 查看物流 ")):T("",!0)])),_:1}),d(i,{label:"付款时间"},{default:n((()=>[b(h(_(v).base_info.pay_at||"--"),1)])),_:1}),d(i,{label:"发货时间"},{default:n((()=>[b(h(_(v).base_info.send_at||"--"),1)])),_:1}),d(i,{label:"成交时间"},{default:n((()=>[b(h(_(v).base_info.take_at||"--"),1)])),_:1}),d(i,{label:"用户备注"},{default:n((()=>[b(h(_(v).base_info.user_remark||"--"),1)])),_:1})])),_:1})])),_:1}),d(y,{title:"收货人信息",style:{"margin-top":"8px"}},{default:n((()=>[d(t,{layout:"vertical",bordered:"",column:3},{default:n((()=>[d(i,{label:"收货人"},{default:n((()=>[b(h(_(v).recipient_info.receiver_name),1)])),_:1}),d(i,{label:"手机号码"},{default:n((()=>[b(h(_(v).recipient_info.receiver_phone),1)])),_:1}),d(i,{label:"收货地址"},{default:n((()=>[b(h(_(v).recipient_info.receiver_full_address),1)])),_:1})])),_:1})])),_:1}),d(y,{title:"商品信息",style:{"margin-top":"8px"}},{default:n((()=>[d(O,{"row-key":"id","data-source":_(v).goods_info.sku_items||[],columns:2==+_(v).base_info.type?_(ee):_(q),scroll:{x:"max-content"},pagination:!1,bordered:""},{bodyCell:n((({column:e,record:a})=>["sku_thumb"===e.key?(s(),r(f,{key:0},["合计"!==a.sku_thumb?(s(),m(L,{key:0,width:50,height:50,src:a.sku_thumb},null,8,["src"])):(s(),r("span",Z,h(a.sku_thumb),1))],64)):T("",!0),"market_price"===e.key?(s(),r(f,{key:1},[b(h(a.market_price?2==+_(v).base_info.type?parseInt(a.market_price):`${a.market_price}`:""),1)],64)):T("",!0),"subtotal"===e.key?(s(),r(f,{key:2},[b(h(2==+_(v).base_info.type?parseInt(a.subtotal):`￥${a.subtotal}`),1)],64)):T("",!0)])),_:1},8,["data-source","columns"])])),_:1}),d(y,{title:"费用信息",style:{"margin-top":"8px"}},{default:n((()=>[d(t,{layout:"vertical",bordered:"",column:7},{default:n((()=>[d(i,{label:"商品合计"+(2==+_(v).base_info.type?"(积分)":"")},{default:n((()=>[b(h(2==+_(v).base_info.type?parseInt(_(v).fee_info.total_fee):_(v).fee_info.total_fee),1)])),_:1},8,["label"]),d(i,{label:"团购优惠"},{default:n((()=>[b(h(_(v).fee_info.group_discount_fee),1)])),_:1}),d(i,{label:"下单立减"},{default:n((()=>[b(h(_(v).fee_info.ordered_discount_fee),1)])),_:1}),d(i,{label:"优惠券"},{default:n((()=>[b(h(_(v).fee_info.coupon_fee),1)])),_:1}),d(i,{label:"运费"},{default:n((()=>[b(h(_(v).fee_info.freight_fee),1)])),_:1}),d(i,{label:"退换省心"},{default:n((()=>[b(h(_(v).fee_info.insurance_fee),1)])),_:1}),d(i,{label:"应付款总金额"},{default:n((()=>[b(h(_(v).fee_info.bill_fee),1)])),_:1})])),_:1})])),_:1}),d(y,{title:"操作信息信息",style:{"margin-top":"8px"}},{default:n((()=>[d(O,{"row-key":"id","data-source":_(v).operate_info||[],columns:_(ae),scroll:{x:"max-content"},pagination:!1,bordered:""},null,8,["data-source","columns"])])),_:1})])),_:1},8,["spinning"]),d(N,{id:_(c)+"",show:_(v).showRemarkOrder,"onUpdate:show":a[6]||(a[6]=e=>_(v).showRemarkOrder=e),onFresh:a[7]||(a[7]=e=>oe())},null,8,["id","show"]),d(H,{id:_(c),show:_(v).showEditLogisticsSn,"onUpdate:show":a[8]||(a[8]=e=>_(v).showEditLogisticsSn=e),onFresh:a[9]||(a[9]=e=>oe())},null,8,["id","show"]),d(J,{id:_(c),show:_(v).showEditReceiveInfo,"onUpdate:show":a[10]||(a[10]=e=>_(v).showEditReceiveInfo=e),"handling-info":_(v).recipient_info,onFresh:a[11]||(a[11]=e=>oe())},null,8,["id","show","handling-info"]),d(se,{ref:"modalRef",visible:_(v).closeOrderVisible,"onUpdate:visible":a[13]||(a[13]=e=>_(v).closeOrderVisible=e),width:"500px",title:"关闭订单","mask-closable":!1,onOk:ie},{default:n((()=>[d(le,{ref_key:"closeFormRef",ref:g,model:_(R),ausymbolcomplete:"off","label-col":{span:6},"wrapper-col":{span:14}},{default:n((()=>[d(te,{label:"密码",name:"password",rules:l},{default:n((()=>[d(G,{value:_(R).password,"onUpdate:value":a[12]||(a[12]=e=>_(R).password=e),type:"password",placeholder:"请输入密码"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),d(z,{show:_(v).showTransoprt,"onUpdate:show":a[14]||(a[14]=e=>_(v).showTransoprt=e),row:_(v).handlingRow},null,8,["show","row"])])}}}),[["__scopeId","data-v-0ed410db"]]);export{ee as default};
