import{d as e,i as a,r as t,m as o,o as n,l as r,a as l,b as s,e as d,w as i,f as u,k as _,$ as c,M as m,s as h,q as k,I as p,A as f,X as g,a7 as v,Y as w,E as y,_ as b,a0 as x,c as U,G as D,H as C,p as M,x as I,z as S,F as j,g as q,B as Y}from"./index-c2ae2a0e.js";import{u as N,_ as O}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import{C as B}from"./index-3f0a4d2e.js";import{_ as z}from"./index-ef11d20c.js";import{u as F,a as E}from"./useSearchItems-c7d75cf3.js";import{u as R}from"./usePagination-c05046ed.js";import{_ as T}from"./index-975d3375.js";import{_ as H}from"./index-00d344de.js";import{d as J}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const K={key:0,class:"block"},A={key:1,class:"block"},G=b(e({__name:"NewCheck",props:{show:Boolean,id:Number},emits:["fresh"],setup(e,{emit:b}){const x=e,U=a(x,"show",b),D=t(),C={required:!0,message:"请输入"},M=o({loading:!1}),I=o({check_name:"",time:[],switch_for_3:1,order_num_for_3:void 0,remark_for_3:void 0,switch_for_5:1,order_num_for_5:void 0,team_order_num_for_5:void 0,remark_for_5:void 0,enabled:0,check_time:"",new_for_check:0});n((()=>{})),r(U,(e=>{e&&(D.value&&D.value.resetFields(),x.id&&(M.loading=!0,c.user.checkManage.detail({id:x.id}).then((e=>{e.data.task_for_3=e.data.task_for_3?JSON.parse(e.data.task_for_3):{order_num:void 0,remark:void 0},e.data.order_num_for_3=e.data.task_for_3.order_num,e.data.remark_for_3=e.data.task_for_3.remark,e.data.task_for_5=e.data.task_for_5?JSON.parse(e.data.task_for_5):{order_num:void 0,remark:void 0,team_order_num:void 0},e.data.order_num_for_5=e.data.task_for_5.order_num,e.data.team_order_num_for_5=e.data.task_for_5.team_order_num,e.data.remark_for_5=e.data.task_for_5.remark,e.data.time=[e.data.task_start,e.data.task_end];for(let a in I)void 0!==e.data[a]&&(I[a]=e.data[a]);setTimeout((e=>{M.loading=!1}),50)}))))}));const S=()=>{D.value.validate().then((async e=>{e.task_start=e.time[0],e.task_end=e.time[1],e.time=void 0,await c.user.checkManage[x.id?"edit":"add"]({...e,id:x.id||void 0}),U.value=!1,b("fresh")})).catch((e=>{console.log(e)}))};return(a,t)=>{const o=p,n=f,r=g,c=z,b=v,x=w,M=B,j=y,q=m;return l(),s("div",null,[d(q,{visible:u(U),"onUpdate:visible":t[11]||(t[11]=e=>_(U)?U.value=e:null),width:"800px",title:e.id?"编辑":"新建","mask-closable":!1,onOk:S},{default:i((()=>[d(j,{ref_key:"formRef",ref:D,model:u(I),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:i((()=>[d(n,{name:"check_name",label:"考核名称",rules:[C]},{default:i((()=>[d(o,{value:u(I).check_name,"onUpdate:value":t[0]||(t[0]=e=>u(I).check_name=e),placeholder:"请输入考核名称",maxlength:20,"show-count":""},null,8,["value"])])),_:1},8,["rules"]),d(n,{name:"time",label:"数据统计时间段",rules:[C]},{default:i((()=>[d(r,{value:u(I).time,"onUpdate:value":t[1]||(t[1]=e=>u(I).time=e),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1},8,["rules"]),d(n,{name:"switch_for_3",label:"桔掌柜保级任务"},{default:i((()=>[d(c,{checked:u(I).switch_for_3,"onUpdate:checked":t[2]||(t[2]=e=>u(I).switch_for_3=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),u(I).switch_for_3?(l(),s("div",K,[d(n,{name:"order_num_for_3",label:"本人订单≥",rules:[C]},{default:i((()=>[d(o,{value:u(I).order_num_for_3,"onUpdate:value":t[3]||(t[3]=e=>u(I).order_num_for_3=e),"addon-after":"单"},null,8,["value"])])),_:1},8,["rules"]),d(n,{name:"remark_for_3",label:"提示"},{default:i((()=>[d(b,{value:u(I).remark_for_3,"onUpdate:value":t[4]||(t[4]=e=>u(I).remark_for_3=e),style:{height:"100px"},maxlength:100,"show-count":""},null,8,["value"])])),_:1})])):h("",!0),d(n,{name:"switch_for_5",label:"优秀桔掌柜保级任务"},{default:i((()=>[d(c,{checked:u(I).switch_for_5,"onUpdate:checked":t[5]||(t[5]=e=>u(I).switch_for_5=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),u(I).switch_for_5?(l(),s("div",A,[d(n,{name:"order_num_for_5",label:"本人订单≥",rules:[C]},{default:i((()=>[d(o,{value:u(I).order_num_for_5,"onUpdate:value":t[6]||(t[6]=e=>u(I).order_num_for_5=e),"addon-after":"单"},null,8,["value"])])),_:1},8,["rules"]),d(n,{name:"team_order_num_for_5",label:"团队订单≥",rules:[C]},{default:i((()=>[d(o,{value:u(I).team_order_num_for_5,"onUpdate:value":t[7]||(t[7]=e=>u(I).team_order_num_for_5=e),"addon-after":"单"},null,8,["value"])])),_:1},8,["rules"]),d(n,{name:"remark_for_5",label:"提示"},{default:i((()=>[d(b,{value:u(I).remark_for_5,"onUpdate:value":t[8]||(t[8]=e=>u(I).remark_for_5=e),style:{height:"100px"},maxlength:100,"show-count":""},null,8,["value"])])),_:1})])):h("",!0),d(n,{name:"check_time",label:"考核时间"},{default:i((()=>[d(x,{value:u(I).check_time,"onUpdate:value":t[9]||(t[9]=e=>u(I).check_time=e),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])])),_:1}),d(n,{name:"new_for_check",label:" ",colon:!1},{default:i((()=>[d(M,{checked:u(I).new_for_check,"onUpdate:checked":t[10]||(t[10]=e=>u(I).new_for_check=e)},{default:i((()=>[k(" 任务时间段内新晋的桔掌柜/优秀桔掌柜，不进行考核 ")])),_:1},8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-839bf43b"]]),L=e({__name:"CheckUserData",props:{show:Boolean,id:Number},emits:[],setup(e,{emit:t}){const m=e,p=x("enums"),f=a(m,"show",t),g=F([["input","uid","用户ID"],["input","username","用户昵称"],["select","success","是否达标",[{label:"是",value:1},{label:"否",value:0}]],["select","old_type","原用户类型",p.value.member_type],["select","new_type","新用户类型",p.value.member_type]]);r(f,(e=>{e&&(w.query={},w.pagination={...w.pagination,current:1},b())}));const v=N([["用户ID","uid"],["用户头像","useravatar"],["用户昵称","username"],["本人订单数","order_num"],["团队订单数","team_order_num"],["是否达标","success"],["原用户类型","old_type"],["新用户类型","new_type"]]),w=o({dataSource:[],loading:!1,pagination:R(),query:{}});n((()=>{}));const y=U((e=>e=>{for(let a=0;a<p.value.member_type.length;a++)if(e===p.value.member_type[a].value)return p.value.member_type[a].label})),b=()=>{w.loading=!0,c.user.checkManage.userDataList({page:w.pagination.current,page_size:w.pagination.pageSize,...w.query,check_task_id:m.id}).then((e=>{var a;w.loading=!1,w.dataSource=e.data.items,1===w.pagination.current&&(w.pagination.total=+(null==(a=e.data)?void 0:a.count))}))},q=e=>{w.pagination={...w.pagination,...e},b()},Y=e=>{w.query=e,w.pagination={...w.pagination,current:1},b()};return(e,a)=>{const t=D("Export"),o=D("Search"),n=H,r=O,p=T,b=C("permission");return l(),M(p,{visible:u(f),"onUpdate:visible":a[0]||(a[0]=e=>_(f)?f.value=e:null),title:"查看的列表",placement:"right",width:"80%"},{default:i((()=>[u(f)?(l(),M(o,{key:0,"search-options":u(g),onOnSearch:Y},{default:i((()=>[I(d(t,{api:u(c).user.checkManage.userDataExport,query:{check_task_id:m.id,...u(w).query}},null,8,["api","query"]),[[b,[u(c).user.checkManage.userDataExport]]])])),_:1},8,["search-options"])):h("",!0),d(r,{"row-key":"id","data-source":u(w).dataSource,columns:u(v),scroll:{x:"max-content"},loading:u(w).loading,pagination:u(w).pagination,onChange:q},{bodyCell:i((({column:e,record:a})=>["useravatar"===e.key?(l(),M(n,{key:0,width:50,src:a.useravatar},null,8,["src"])):h("",!0),"success"===e.key?(l(),s(j,{key:1},[k(S(+a.success?"是":"否"),1)],64)):h("",!0),"old_type"===e.key?(l(),s(j,{key:2},[k(S(u(y)(a.old_type)),1)],64)):h("",!0),"new_type"===e.key?(l(),s(j,{key:3},[k(S(u(y)(a.new_type)),1)],64)):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])),_:1},8,["visible"])}}}),P=q("div",{class:"tips",style:{"line-height":"34px","margin-left":"10px"}}," 每月指定日期，服务端通过执行脚本方式进行考核，考核完成后降级不达标用户的身份 ",-1),X={key:3},$=e({__name:"CheckManage",setup(e){const a=F([]),t=N([["考核编号","id"],["考核名称","check_name"],["数据统计时间段","task_start"],["考核状态","check_status"],["考核时间","check_time"],["降级到掌柜","down_to_3"],["降级到会员","down_to_1"],["创建时间","created_at"],["开关","enabled"],["操作","operate",200,"right"]]),r=o({handlingId:0,dataSource:[],loading:!1,query:{},pagination:R(),showNewDialog:!1,showUesrData:!1,handlingInfo:{},selectedRowKeys:[],selectBtn:void 0});n((()=>{_()}));const _=()=>{r.loading=!0,c.user.checkManage.list({page:r.pagination.current,page_size:r.pagination.pageSize,...r.query}).then((e=>{var t;r.loading=!1,r.dataSource=e.data.items,1===r.pagination.current&&(r.pagination.total=+(null==(t=e.data)?void 0:t.count)),E(a,"enabled",e.data.enabled_map),r.selectedRowKeys=[]}))},m=e=>{r.pagination={...r.pagination,...e},_()},p=e=>{r.query=e,r.pagination={...r.pagination,current:1},_()};return(e,o)=>{const n=Y,f=D("Search"),g=z,v=O,w=C("permission");return l(),s("div",null,[d(f,{"search-options":u(a),onOnSearch:p},{default:i((()=>[I((l(),M(n,{type:"primary",onClick:o[0]||(o[0]=e=>{u(r).handlingId=0,u(r).handlingInfo={},u(r).showNewDialog=!0})},{default:i((()=>[k(" 新建 ")])),_:1})),[[w,[u(c).user.checkManage.add]]]),P])),_:1},8,["search-options"]),d(v,{"data-source":u(r).dataSource,columns:u(t),scroll:{x:"max-content"},loading:u(r).loading,pagination:u(r).pagination,"row-key":"id",onChange:m},{bodyCell:i((({column:e,record:a})=>["task_start"===e.key?(l(),s(j,{key:0},[k(S(a.task_start)+" ~ "+S(a.task_end),1)],64)):h("",!0),"check_status"===e.key?(l(),s(j,{key:1},[k(S(+a.check_status?"已考核":"待考核"),1)],64)):h("",!0),"enabled"===e.key?(l(),M(g,{key:2,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await c.user.checkManage.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1})),_()})(a)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===e.key?(l(),s("div",X,[d(n,{type:"link",onClick:e=>{u(r).handlingId=a.id,u(r).handlingInfo=a,u(r).showNewDialog=!0}},{default:i((()=>[k(" 编辑 ")])),_:2},1032,["onClick"]),d(n,{type:"link",class:"danger-color",onClick:e=>{return t=a.id,void J.confirm({title:"提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:()=>{c.user.checkManage.del({id:t+""}).then((e=>{_()}))}});var t}},{default:i((()=>[k(" 删除 ")])),_:2},1032,["onClick"]),d(n,{type:"link",onClick:e=>{u(r).handlingId=a.id,u(r).handlingInfo=a,u(r).showUesrData=!0}},{default:i((()=>[k(" 用户数据 ")])),_:2},1032,["onClick"])])):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),d(G,{id:u(r).handlingId,show:u(r).showNewDialog,"onUpdate:show":o[1]||(o[1]=e=>u(r).showNewDialog=e),"handling-info":u(r).handlingInfo,onFresh:_},null,8,["id","show","handling-info"]),d(L,{id:u(r).handlingId,show:u(r).showUesrData,"onUpdate:show":o[2]||(o[2]=e=>u(r).showUesrData=e),onFresh:_},null,8,["id","show"])])}}});export{$ as default};
