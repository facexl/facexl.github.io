import{_ as a,a as e,b as t,d as l,u as s,h as d,r as n,m as i,o,$ as u,a6 as _,G as c,e as r,w as p,f as k,S as y,p as f,F as m,n as b,g,q as h,s as v,Z as w,I as D,A as j,X as q,B as x,E as U}from"./index-c2ae2a0e.js";import{_ as Y}from"./index-f5618084.js";import{_ as A}from"./index-ef11d20c.js";import{d as C}from"./dtool-b3945d0c.js";import{a as E}from"./useRequest-34a5e624.js";import"./Upload-053b6740.js";import"./index-b1df7cdb.js";import"./index-00d344de.js";import"./FolderOpenOutlined-fa174baf.js";import"./DeleteOutlined-1e1ff134.js";const F=a({},[["render",function(a,l){return e(),t("div")}]]),B=g("span",null,"积分",-1),M=g("p",{class:"tips mt8px"}," 支持“1,3,5”格式，代表连续第一天签到送1积分，连续第二天送3积分，连续第三天开始送5积分（并保持）；连签中断后从新循环赠送积分 ",-1),O=l({__name:"AddSignAct",setup(a){const l=E(),O=s(),G=d(),L=1==+G.query.isEdit,R=n(),S=i({loading:!1,submitLoading:!1}),z=i({title:"","start_at-end_at":[],integrals:"",enabled:0,task_list:{task_continue_days:{enabled:0,type:1,list:[]},task_accumulated_days:{enabled:0,type:2,list:[]},task_define_days:{enabled:0,type:3,list:[]}},rule:""}),I=()=>{R.value.validate().then((async a=>{const e=C(z).splitDayjs(["start_at","end_at"],"YYYY-MM-DD").custom((a=>{["task_continue_days","task_accumulated_days","task_define_days"].forEach((e=>{const t=a.task_list[e];if(1===t.enabled){if(0===t.list.length)throw w.error("请添加任务"),"";t.list.forEach((a=>{if(!a.target_day)throw w.error("请填写任务天数/时间"),"";if(!a.target_value)throw w.error("请填写任务积分或选择优惠券"),"";"task_define_days"===e&&(a.target_day=a.target_day.format("YYYY-MM-DD"))}))}}))})).end();console.log(e),L?await u.act.sign.edit({...e,id:G.query.id}):await u.act.sign.add(e),O.push({name:"signAct"})}))},X=(a,e)=>{e.splice(a,1)},Z=a=>{a.push({target_day:"",target_type:1,target_value:""})};return o((()=>{G.query.id&&(S.loading=!0,u.act.sign.detail({id:G.query.id}).then((a=>{S.loading=!1,C(a.data).combinDayjs(["start_at","end_at"]).custom((a=>{a.task_list.task_define_days.list.forEach((a=>{a.target_day=_(a.target_day)}))})).insertForm(z)})))})),(a,s)=>{const d=D,n=j,i=q,o=D,u=A,_=x,w=Y,C=j,E=U,O=c("FixBottomBar"),$=y;return e(),t("div",null,[r($,{spinning:k(S).loading},{default:p((()=>[r(E,{ref_key:"formRef",ref:R,model:k(z),autocomplete:"off","label-col":{span:4},"wrapper-col":{span:8}},{default:p((()=>[r(n,{name:"title",label:"活动名称",required:""},{default:p((()=>[r(d,{value:k(z).title,"onUpdate:value":s[0]||(s[0]=a=>k(z).title=a),placeholder:"请输入","show-count":"",maxlength:20},null,8,["value"])])),_:1}),r(n,{name:"start_at-end_at",label:"签到起止时间",required:""},{default:p((()=>[r(i,{value:k(z)["start_at-end_at"],"onUpdate:value":s[1]||(s[1]=a=>k(z)["start_at-end_at"]=a),placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1}),r(n,{name:"integrals",label:"每日签到送",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:p((()=>[r(o,{value:k(z).integrals,"onUpdate:value":s[2]||(s[2]=a=>k(z).integrals=a),style:{width:"40%"}},{addonAfter:p((()=>[B])),_:1},8,["value"]),M])),_:1}),r(n,{label:"连续签到送礼品"},{default:p((()=>[r(u,{checked:k(z).task_list.task_continue_days.enabled,"onUpdate:checked":s[3]||(s[3]=a=>k(z).task_list.task_continue_days.enabled=a),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),k(z).task_list.task_continue_days.enabled?(e(),f(n,{key:0,label:" ",colon:!1,"label-col":{span:4},"wrapper-col":{span:20}},{default:p((()=>[(e(!0),t(m,null,b(k(z).task_list.task_continue_days.list,((a,t)=>(e(),f(F,{key:t,type:"day",data:a,coupons:k(l),onDel:()=>X(t,k(z).task_list.task_continue_days.list)},null,8,["data","coupons","onDel"])))),128)),g("p",null,[r(_,{onClick:s[4]||(s[4]=a=>Z(k(z).task_list.task_continue_days.list))},{default:p((()=>[h(" 添加任务 ")])),_:1})])])),_:1})):v("",!0),r(n,{label:"累计签到送礼品"},{default:p((()=>[r(u,{checked:k(z).task_list.task_accumulated_days.enabled,"onUpdate:checked":s[5]||(s[5]=a=>k(z).task_list.task_accumulated_days.enabled=a),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),k(z).task_list.task_accumulated_days.enabled?(e(),f(n,{key:1,label:" ",colon:!1,"label-col":{span:4},"wrapper-col":{span:20}},{default:p((()=>[(e(!0),t(m,null,b(k(z).task_list.task_accumulated_days.list,((a,t)=>(e(),f(F,{key:t,type:"day",data:a,coupons:k(l),onDel:()=>X(t,k(z).task_list.task_accumulated_days.list)},null,8,["data","coupons","onDel"])))),128)),g("p",null,[r(_,{onClick:s[6]||(s[6]=a=>Z(k(z).task_list.task_accumulated_days.list))},{default:p((()=>[h(" 添加任务 ")])),_:1})])])),_:1})):v("",!0),r(n,{label:"指定日期送礼品"},{default:p((()=>[r(u,{checked:k(z).task_list.task_define_days.enabled,"onUpdate:checked":s[7]||(s[7]=a=>k(z).task_list.task_define_days.enabled=a),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),k(z).task_list.task_define_days.enabled?(e(),f(n,{key:2,label:" ",colon:!1,"label-col":{span:4},"wrapper-col":{span:20}},{default:p((()=>[(e(!0),t(m,null,b(k(z).task_list.task_define_days.list,((a,t)=>(e(),f(F,{key:t,type:"date",data:a,coupons:k(l),onDel:()=>X(t,k(z).task_list.task_define_days.list)},null,8,["data","coupons","onDel"])))),128)),g("p",null,[r(_,{onClick:s[8]||(s[8]=a=>Z(k(z).task_list.task_define_days.list))},{default:p((()=>[h(" 添加任务 ")])),_:1})])])),_:1})):v("",!0),r(C,{name:"rule",label:"签到规则",required:"","wrapper-col":{span:16}},{default:p((()=>[r(w,{value:k(z).rule,"onUpdate:value":s[9]||(s[9]=a=>k(z).rule=a)},null,8,["value"])])),_:1})])),_:1},8,["model"]),!k(G).query.id||L?(e(),f(O,{key:0},{default:p((()=>[r(_,{type:"primary",loading:k(S).submitLoading,onClick:I},{default:p((()=>[h(" 提交 ")])),_:1},8,["loading"])])),_:1})):v("",!0)])),_:1},8,["spinning"])])}}});export{O as default};
