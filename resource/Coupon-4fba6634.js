import{d as e,u as a,a0 as t,r as n,m as o,o as i,$ as s,G as l,a as d,b as c,e as r,w as u,f as p,p as m,s as g,M as _,q as k,F as y,z as b,x as h,y as w,g as f,B as v,X as C,A as x,E as D,a3 as T,a4 as R,_ as j}from"./index-c2ae2a0e.js";import{u as q,_ as I}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as U}from"./index-ef11d20c.js";import{u as V,a as S}from"./useSearchItems-c7d75cf3.js";import{u as Y}from"./usePagination-c05046ed.js";import{d as K}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const H={class:"coupon"},M={style:{"text-align":"center","padding-bottom":"50px"}},O=(e=>(T("data-v-b4e7b3b8"),e=e(),R(),e))((()=>f("div",{style:{"margin-top":"30px","margin-bottom":"10px"}}," 小程序二维码： ",-1))),$=["src"],z=j(e({__name:"Coupon",setup(e){const T=a(),R=t("enums"),j=V([["input","id","优惠券ID"],["input","name","优惠券名称"],["input","remark","优惠券备注"],["select","member_type","使用人群"],["select","up_status","领取状态"],["select","enabled","状态"],["dateRange","get_start_t1-get_start_t2",["领取开始时间开始","领取开始时间结束"]],["dateRange","get_end_t1-get_end_t2",["领取结束时间开始","领取结束时间结束"]],["dateRange","use_start_t1-use_start_t2",["使用开始时间开始","使用开始时间结束"]],["dateRange","use_end_t1-use_end_t2",["使用结束时间开始","使用结束时间结束"]]]),z=q([["优惠券ID","id"],["优惠券名称","name"],["优惠券备注","remark"],["满金额","limit_money"],["减金额","money"],["优惠券数量","num"],["用户限制数量","user_num"],["已使用数量","use_num"],["未使用数量","not_use_num"],["领取开始时间","get_start_at"],["领取结束时间","get_end_at"],["使用开始时间","use_start_at"],["使用结束时间","use_end_at"],["领取状态","up_status"],["状态","enabled"],["操作","operate",250,"right"]]),B=n(),E=o({getTime:[]}),N={required:!0,message:"请输入"},A=o({activeName:"Coupon",loading:!1,query:{},pagination:Y(),dataSource:[],link:"",linkDialogVisible:!1,linkImg:"",handlingId:"",showNewDialog:!1,showUpDownVisible:!1,selectedRowKeys:[],batchs:[{label:"批量发放",value:"send"}]});i((()=>{P()}));const F=e=>{"send"===e&&(console.log(A.selectedRowKeys),T.push({name:"sendCoupon",params:{id:A.selectedRowKeys.join(",")}}))},G=e=>{(async e=>{const{data:a}=await s.common.getQrcode({type:"coupon",source_id:e.id,client_type:"mp"});A.linkImg=a.qr_code,A.linkDialogVisible=!0})(e)},P=async()=>{try{A.loading=!0;const{data:e}=await s.act.coupon.list({...A.query,page:A.pagination.current,page_size:A.pagination.pageSize});1===A.pagination.current&&(A.pagination.total=+(null==e?void 0:e.count)),A.dataSource=e.items,S(j,"up_status",{10:"已上架",1:"预上架",0:"已下架"}),S(j,"enabled",{1:"启用",0:"禁用"}),S(j,"member_type",R.value.member_type),1==+A.current&&(A.count=e.count),A.loading=!1}catch(e){A.loading=!1}},Q=()=>{B.value.validate().then((async e=>{e.getTime&&e.getTime.length&&(e.get_start_at=e.getTime[0],e.get_end_at=e.getTime[1]),delete e.getTime,await s.act.coupon.upDown({id:A.handlingId,...e}),A.showUpDownVisible=!1,P()})).catch((e=>{console.log(e)}))},X=e=>{A.pagination={...A.pagination,...e},P()},J=e=>{A.query=e,A.pagination={...A.pagination,current:1},P()};return(e,a)=>{const t=v,n=l("Export"),o=l("Search"),i=U,R=I,q=l("BatchTable"),V=C,S=x,Y=D,L=_;return d(),c("div",H,[r(o,{"search-options":p(j),onOnSearch:J},{default:u((()=>[r(t,{type:"primary",plain:"",style:{"margin-right":"10px"},onClick:a[0]||(a[0]=a=>e.$router.push({name:"couponAdd"}))},{default:u((()=>[k(" 添加 ")])),_:1}),r(n,{query:p(A).query,api:p(s).act.coupon.export},null,8,["query","api"])])),_:1},8,["search-options"]),r(R,{"row-key":"id","data-source":p(A).dataSource,columns:p(z),scroll:{x:"max-content"},loading:p(A).loading,pagination:p(A).pagination,"row-selection":{selectedRowKeys:p(A).selectedRowKeys,onChange(e){p(A).selectedRowKeys=e}},onChange:X},{bodyCell:u((({column:a,record:n})=>["up_status"===a.key?(d(),c(y,{key:0},[k(b(10==+n.up_status?"已上架":1==+n.up_status?"预上架":"已下架"),1)],64)):g("",!0),"enabled"===a.key?(d(),m(i,{key:1,checked:n.enabled,"onUpdate:checked":e=>n.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{K.confirm({title:"提示",content:1===e.enabled?"该优惠券启用后，用户可以正常的领取和使用了":"该优惠券禁用后，用户将无法领取和使用",okText:"确认",cancelText:"取消",onOk:async()=>{await s.act.coupon.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1})),P()},onCancel:()=>{e.enabled=1===e.enabled?0:1}})})(n)},null,8,["checked","onUpdate:checked","onChange"])):g("",!0),"operate"===a.key?(d(),c(y,{key:2},[r(t,{type:"link",onClick:a=>e.$router.push({name:"couponEdit",params:{id:n.id}})},{default:u((()=>[k(" 编辑 ")])),_:2},1032,["onClick"]),r(t,{type:"link",onClick:a=>e.$router.push({name:"couponCopy",params:{id:n.id}})},{default:u((()=>[k(" 复制 ")])),_:2},1032,["onClick"]),r(t,{type:"link",class:"danger-color",onClick:e=>{return a=n.id,void K.confirm({title:"提示",content:"确认删除该券？",okText:"确认",cancelText:"取消",onOk:async()=>{await s.act.coupon.del({id:a}),P()}});var a}},{default:u((()=>[k(" 删除 ")])),_:2},1032,["onClick"]),r(t,{type:"link",onClick:e=>{return a=n,void T.push({name:"sendCoupon",params:{id:a.id}});var a}},{default:u((()=>[k(" 发放 ")])),_:2},1032,["onClick"]),r(t,{type:"link",onClick:e=>{return(a=n).get_start_at&&a.get_end_at?E.getTime=[a.get_start_at,a.get_end_at]:E.getTime=void 0,A.handlingId=a.id,void(A.showUpDownVisible=!0);var a}},{default:u((()=>[k(" 上下架设置 ")])),_:2},1032,["onClick"]),h(r(t,{type:"link",onClick:e=>G(n)},{default:u((()=>[k(" 分享链接 ")])),_:2},1032,["onClick"]),[[w,"Coupon"===p(A).activeName&&3==+n.coupon_type]])],64)):g("",!0)])),_:1},8,["data-source","columns","loading","pagination","row-selection"]),p(A).dataSource.length?(d(),m(q,{key:0,batchs:p(A).batchs,"selected-row-keys":p(A).selectedRowKeys,onClick:F},null,8,["batchs","selected-row-keys"])):g("",!0),r(L,{visible:p(A).showUpDownVisible,"onUpdate:visible":a[2]||(a[2]=e=>p(A).showUpDownVisible=e),visibleModifiers:{sync:!0},title:"上下架设置",width:"640px","mask-closable":!1,onOk:Q},{default:u((()=>[r(Y,{ref_key:"formRef",ref:B,model:p(E),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:15}},{default:u((()=>[r(S,{name:"getTime",label:"上下架时间",rules:N},{default:u((()=>[r(V,{value:p(E).getTime,"onUpdate:value":a[1]||(a[1]=e=>p(E).getTime=e),"show-time":{format:"HH:mm:ss"},"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:["领券开始时间","领券结束时间"]},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),r(L,{visible:p(A).linkDialogVisible,"onUpdate:visible":a[4]||(a[4]=e=>p(A).linkDialogVisible=e),title:"分享链接",footer:null,width:"400px","mask-closable":!1},{footer:u((()=>[r(t,{onClick:a[3]||(a[3]=e=>p(A).linkDialogVisible=!1)},{default:u((()=>[k(" 关 闭 ")])),_:1})])),default:u((()=>[f("div",M,[O,f("img",{style:{width:"220px"},src:p(A).linkImg},null,8,$)])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-b4e7b3b8"]]);export{z as default};
