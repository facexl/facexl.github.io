import{d as e,i as a,r as o,m as t,o as n,l,a as s,b as d,e as i,w as p,f as _,k as u,$ as r,M as c,p as g,s as h,x as m,y as w,F as v,n as f,q as k,z as b,I as y,A as j,E as x,_ as I,G as U,H as C,B as O}from"./index-c2ae2a0e.js";import{u as q,_ as D}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import{C as N}from"./index-3f0a4d2e.js";import{_ as S}from"./index-ef11d20c.js";import{u as z}from"./useSearchItems-c7d75cf3.js";import{u as B}from"./usePagination-c05046ed.js";import{_ as F}from"./index-8036da2a.js";import{_ as T}from"./index-f5618084.js";import{_ as A}from"./tool-d986b095.js";import{d as G}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./RadioButton-bc4165ed.js";import"./Upload-053b6740.js";import"./index-b1df7cdb.js";import"./index-00d344de.js";import"./DeleteOutlined-1e1ff134.js";const R=I(e({__name:"NewAgreement",props:{show:Boolean,id:Number,handlingInfo:{type:Object,default:()=>{}},show_page_1_opt:{type:Object,default:()=>{}},show_page_2_opt:{type:Object,default:()=>{}}},emits:["fresh"],setup(e,{emit:I}){const U=e,C=a(U,"show",I),O=o(),q={required:!0,message:"请输入"},D=t({loading:!1}),z=t({protocol_name:"",protocol_content:void 0,pop_up_content:void 0,is_pop_up:0,enabled:0,sort:void 0,show_page_1:[],show_page_2:[]});n((()=>{})),l(C,(e=>{e&&(O.value&&O.value.resetFields(),U.id&&(D.loading=!0,r.set.agreement.detail({id:U.id}).then((e=>{for(let a in z)void 0!==e.data[a]&&(z[a]="show_page_1"===a||"show_page_2"===a?e.data[a]?e.data[a].split(","):[]:e.data[a]);setTimeout((e=>{D.loading=!1}),50)}))))}));const B=()=>{O.value.validate().then((async e=>{e.show_page_1=e.show_page_1.join(","),e.show_page_2=e.show_page_2.join(","),await r.set.agreement[U.id?"edit":"add"]({...e,id:U.id||void 0}),C.value=!1,I("fresh")})).catch((e=>{console.log(e)}))};return(a,o)=>{const t=y,n=j,l=T,r=S,I=N,U=A,D=F,G=x,R=c;return s(),d("div",null,[i(R,{visible:_(C),"onUpdate:visible":o[8]||(o[8]=e=>u(C)?C.value=e:null),width:"1000px",title:e.id?"编辑协议":"添加协议","mask-closable":!1,onOk:B},{default:p((()=>[i(G,{ref_key:"formRef",ref:O,model:_(z),autocomplete:"off","label-col":{span:3},"wrapper-col":{span:21}},{default:p((()=>[i(n,{name:"protocol_name",label:"协议名称",rules:q},{default:p((()=>[i(t,{value:_(z).protocol_name,"onUpdate:value":o[0]||(o[0]=e=>_(z).protocol_name=e),maxlength:30,placeholder:"请输入快递名称"},null,8,["value"])])),_:1}),i(n,{name:"protocol_content",label:"协议内容",rules:q},{default:p((()=>[_(C)?(s(),g(l,{key:0,value:_(z).protocol_content,"onUpdate:value":o[1]||(o[1]=e=>_(z).protocol_content=e)},null,8,["value"])):h("",!0)])),_:1}),i(n,{name:"is_pop_up",label:"是否有弹框展示"},{default:p((()=>[i(r,{checked:_(z).is_pop_up,"onUpdate:checked":o[2]||(o[2]=e=>_(z).is_pop_up=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),m(i(n,{name:"pop_up_content",label:"弹窗内容",rules:_(z).is_pop_up?q:[]},{default:p((()=>[_(C)?(s(),g(l,{key:0,value:_(z).pop_up_content,"onUpdate:value":o[3]||(o[3]=e=>_(z).pop_up_content=e)},null,8,["value"])):h("",!0)])),_:1},8,["rules"]),[[w,_(z).is_pop_up]]),i(n,{name:"show_page_1",label:"显示终端"},{default:p((()=>[i(U,{value:_(z).show_page_1,"onUpdate:value":o[4]||(o[4]=e=>_(z).show_page_1=e)},{default:p((()=>[(s(!0),d(v,null,f(e.show_page_1_opt,((e,a)=>(s(),g(I,{key:a,value:a},{default:p((()=>[k(b(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),i(n,{name:"show_page_2",label:"特殊显示页面"},{default:p((()=>[i(U,{value:_(z).show_page_2,"onUpdate:value":o[5]||(o[5]=e=>_(z).show_page_2=e)},{default:p((()=>[(s(!0),d(v,null,f(e.show_page_2_opt,((e,a)=>(s(),g(I,{key:a,value:a},{default:p((()=>[k(b(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),i(n,{name:"sort",label:"排序",required:""},{default:p((()=>[i(D,{value:_(z).sort,"onUpdate:value":o[6]||(o[6]=e=>_(z).sort=e),style:{width:"150px"}},null,8,["value"])])),_:1}),i(n,{name:"enabled",label:"状态"},{default:p((()=>[i(r,{checked:_(z).enabled,"onUpdate:checked":o[7]||(o[7]=e=>_(z).enabled=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-a55a108e"]]),E={key:1},H=e({__name:"Agreement",setup(e){const a=z([]),o=q([["协议ID","id"],["协议名称","protocol_name"],["排序","sort"],["状态","enabled"],["操作","operate",130,"right"]]),l=t({handlingId:0,dataSource:[],loading:!1,query:{},pagination:B(),showNewDialog:!1,handlingInfo:{},show_page_1_opt:{},show_page_2_opt:{}});n((()=>{u()}));const u=()=>{l.loading=!0,r.set.agreement.list({page:l.pagination.current,page_size:l.pagination.pageSize,...l.query}).then((e=>{var a;l.loading=!1,l.dataSource=e.data.items,1===l.pagination.current&&(l.pagination.total=+(null==(a=e.data)?void 0:a.count)),l.show_page_1_opt=e.data.show_page_1,l.show_page_2_opt=e.data.show_page_2}))},c=e=>{l.pagination={...l.pagination,...e},u()},w=e=>{l.query=e,l.pagination={...l.pagination,current:1},u()};return(e,t)=>{const n=O,v=U("Search"),f=S,b=D,y=C("permission");return s(),d("div",null,[i(v,{"search-options":_(a),onOnSearch:w},{default:p((()=>[m((s(),g(n,{type:"primary",onClick:t[0]||(t[0]=e=>{_(l).handlingId=0,_(l).handlingInfo={},_(l).showNewDialog=!0})},{default:p((()=>[k(" 添加 ")])),_:1})),[[y,[_(r).set.agreement.add]]])])),_:1},8,["search-options"]),i(b,{"data-source":_(l).dataSource,columns:_(o),scroll:{x:"max-content"},loading:_(l).loading,pagination:_(l).pagination,onChange:c},{bodyCell:p((({column:e,record:a})=>["enabled"===e.key?(s(),g(f,{key:0,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await r.set.agreement.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1}))})(a)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===e.key?(s(),d("div",E,[m((s(),g(n,{type:"link",onClick:e=>{_(l).handlingId=a.id,_(l).handlingInfo=a,_(l).showNewDialog=!0}},{default:p((()=>[k(" 编辑 ")])),_:2},1032,["onClick"])),[[y,[_(r).set.agreement.edit]]]),m((s(),g(n,{type:"link",class:"danger-color",onClick:e=>{return o=a.id,void G.confirm({title:"提示",content:"确认删除该协议？",okText:"确认",cancelText:"取消",onOk:()=>{r.set.agreement.delete({id:o}).then((e=>{u()}))}});var o}},{default:p((()=>[k(" 删除 ")])),_:2},1032,["onClick"])),[[y,[_(r).set.agreement.delete]]])])):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),i(R,{id:_(l).handlingId,show:_(l).showNewDialog,"onUpdate:show":t[1]||(t[1]=e=>_(l).showNewDialog=e),"handling-info":_(l).handlingInfo,show_page_1_opt:_(l).show_page_1_opt,show_page_2_opt:_(l).show_page_2_opt,onFresh:u},null,8,["id","show","handling-info","show_page_1_opt","show_page_2_opt"])])}}});export{H as default};
