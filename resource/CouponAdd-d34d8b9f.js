import{d as e,m as a,l,o as t,$ as o,a as u,b as d,e as s,w as _,f as i,F as m,n,p as r,q as p,z as v,s as f,V as y,W as c,A as g,B as b,a5 as h,E as k,a0 as w,u as x,h as U,r as T,G as j,g as D,I as Y,X as I,_ as C}from"./index-c2ae2a0e.js";import{C as A}from"./index-3f0a4d2e.js";import{u as H,_ as O}from"./useTableColumns-dd067b4d.js";import{R as q,_ as M}from"./index-c8577ae4.js";import{_ as B}from"./index-00d344de.js";import{_ as L}from"./Upload-053b6740.js";import{_ as S}from"./index-ef11d20c.js";import{_ as J}from"./index-8036da2a.js";import{_ as N}from"./tool-d986b095.js";import"./FolderOpenOutlined-fa174baf.js";import"./RadioButton-bc4165ed.js";import"./index-b1df7cdb.js";import"./DeleteOutlined-1e1ff134.js";const R=e({__name:"ChooseGoods",props:{value:Array},emits:["update:value"],setup(e,{emit:w}){const x=e,U=H([["商品编号","id",90],["商品名称","title"],["商品图片","thumb",90],["售价(元)","shop_price",100],["成本价(元)","cost_price",110],["操作","operate",70]]),T=a({goodsData:[],chooseData:[]}),j=a({chooseIds:[],quickId:""});l((()=>x.value),(()=>{j.chooseIds=x.value,T.chooseData=T.goodsData.filter((e=>x.value.includes(e.id)))})),t((async()=>{I()}));const D=()=>{if(j.quickId){let e=j.quickId.split(","),a=JSON.parse(JSON.stringify(x.value));e.forEach((e=>{-1!==T.goodsData.map((e=>e.id)).indexOf(+e)&&-1===a.indexOf(+e)&&a.push(+e)})),w("update:value",a),j.quickId=""}},Y=e=>{w("update:value",e)},I=async()=>{const{data:e}=await o.product.goods.list({is_select:1,is_off:0,not_type:4});T.goodsData=e.items,j.chooseIds=x.value,T.chooseData=T.goodsData.filter((e=>x.value.includes(e.id)))};return(e,a)=>{const l=y,t=c,o=g,I=b,C=h,A=B,H=O,q=k;return u(),d("div",null,[s(q,{ref:"formRef",model:i(j),autocomplete:"off"},{default:_((()=>[s(o,{name:"chooseIds",label:""},{default:_((()=>[s(t,{value:i(j).chooseIds,style:{width:"600px"},mode:"multiple","max-tag-count":1,placeholder:"选择要添加的商品",onChange:Y},{default:_((()=>[(u(!0),d(m,null,n(i(T).goodsData,(e=>(u(),r(l,{key:e.id},{default:_((()=>[p(v(e.title),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1}),s(o,{name:"name",label:"输入id快速添加商品"},{default:_((()=>[s(C,{value:i(j).quickId,"onUpdate:value":a[0]||(a[0]=e=>i(j).quickId=e),placeholder:"可输入逗号隔开的商品id，快速添加商品",style:{width:"400px"},onSearch:D},{enterButton:_((()=>[s(I,{type:"primary"},{default:_((()=>[p(" 添加 ")])),_:1})])),_:1},8,["value"])])),_:1}),s(o,{name:"name",label:""},{default:_((()=>[s(H,{"row-key":"id","data-source":i(T).chooseData,columns:i(U),pagination:!1,bordered:"",scroll:{y:400}},{bodyCell:_((({column:e,record:a,index:l})=>["thumb"===e.key?(u(),r(A,{key:0,width:50,height:50,src:a.thumb},null,8,["src"])):f("",!0),"operate"===e.key?(u(),r(I,{key:1,type:"link",class:"danger-color",onClick:e=>(e=>{let a=JSON.parse(JSON.stringify(x.value));a.splice(e,1),w("update:value",a)})(l)},{default:_((()=>[p(" 删除 ")])),_:2},1032,["onClick"])):f("",!0)])),_:1},8,["data-source","columns"])])),_:1})])),_:1},8,["model"])])}}}),F={style:{"padding-top":"40px"}},G={style:{overflow:"hidden"}},V={style:{overflow:"hidden"}},E=C(e({__name:"CouponAdd",emits:["fresh"],setup(e,{emit:h}){const C=w("enums"),H=x(),O=U(),B=T(),E={required:!0,message:"请输入"},z=O.path.includes("couponCopy"),W=O.params.id,X=a({loading:!1,submitLoading:!1}),$=a({name:void 0,description:void 0,remark:void 0,num:void 0,money:void 0,is_out_limit:1,is_limit_money:0,limit_money:void 0,user_num:void 0,send_type:void 0,coupon_type:void 0,order_min:void 0,auto_send_num:void 0,order_goods_type:void 0,batch_number:void 0,home_img:void 0,recharge_money:void 0,get_platform:[],use_platform:[],member_type:[],member_features_type:[],use_goods_ids:[],order_goods_ids:[],use_goods_type:void 0,use_time_type:void 0,use_begin_day:void 0,use_end_day:void 0,getTime:void 0,useTime:void 0});t((()=>{W&&K()})),l((()=>$.use_time_type),(()=>{!0!==X.loading&&(B.value.clearValidate(["use_begin_day","use_end_day","useTime"]),$.use_begin_day=void 0,$.use_end_day=void 0,$.useTime=void 0)})),l((()=>$.is_limit_money),(()=>{!0!==X.loading&&($.limit_money=void 0,B.value.clearValidate(["limit_money"]))})),l((()=>$.send_type),(()=>{!0!==X.loading&&($.coupon_type=void 0)}));const K=async()=>{X.loading=!0;const{data:e}=await o.act.coupon.detail({id:W});e.get_platform=e.get_platform?e.get_platform.split(",").map((e=>+e)):[],e.use_platform=e.use_platform?e.use_platform.split(",").map((e=>+e)):[],e.member_type=e.member_type?e.member_type.split(",").map((e=>+e)):[],e.member_features_type=e.member_features_type?e.member_features_type.split(",").map((e=>+e)):[],e.order_goods_ids=e.order_goods_ids?e.order_goods_ids.split(",").map((e=>+e)):[],e.use_goods_ids=e.use_goods_ids?e.use_goods_ids.split(",").map((e=>+e)):[],e.is_limit_money=+e.limit_money?1:0,e.is_limit_money||(e.limit_money=void 0);for(let a in $)"getTime"===a?e.get_start_at&&e.get_end_at&&($.getTime=[e.get_start_at,e.get_end_at]):"useTime"===a?e.use_start_at&&e.use_end_at&&($.useTime=[e.use_start_at,e.use_end_at]):$[a]=e[a];setTimeout((e=>{X.loading=!1}),200)},P=()=>{B.value.validate().then((async e=>{X.submitLoading=!0;try{e.get_platform=e.get_platform?e.get_platform.join(","):"",e.use_platform=e.use_platform?e.use_platform.join(","):"",e.member_type=e.member_type?e.member_type.join(","):"",e.member_features_type=e.member_features_type?e.member_features_type.join(","):"",2===e.order_goods_type?e.order_goods_ids=e.order_goods_ids.join(","):e.order_goods_ids="",2===e.use_goods_type||3===e.use_goods_type?e.use_goods_ids=e.use_goods_ids?e.use_goods_ids.join(","):"":e.use_goods_ids="",e.getTime&&e.getTime.length&&(e.get_start_at=e.getTime[0],e.get_end_at=e.getTime[1]),e.useTime&&e.useTime.length&&(e.use_start_at=e.useTime[0],e.use_end_at=e.useTime[1]),delete e.getTime,delete e.useTime,delete e.is_limit_money,await o.act.coupon[z?"add":W?"edit":"add"]({...e,id:z?void 0:W||void 0}),X.submitLoading=!1,H.push({name:"coupon"}),h("fresh")}catch(a){console.log(a),X.submitLoading=!1}})).catch((e=>{console.log(e)}))};return(e,a)=>{const l=Y,t=g,o=J,h=S,w=q,x=M,U=I,T=y,H=c,O=L,z=R,W=A,K=N,Q=k,Z=b,ee=j("FixBottomBar");return u(),d("div",F,[s(Q,{ref_key:"formRef",ref:B,model:i($),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:_((()=>[s(t,{name:"name",label:"优惠券名称",rules:E},{default:_((()=>[s(l,{value:i($).name,"onUpdate:value":a[0]||(a[0]=e=>i($).name=e),maxlength:20,placeholder:"最多20个字",style:{width:"500px"}},null,8,["value"])])),_:1}),s(t,{name:"description",label:"优惠券描述",rules:E},{default:_((()=>[s(l,{value:i($).description,"onUpdate:value":a[1]||(a[1]=e=>i($).description=e),maxlength:20,placeholder:"将会显示在c端页面（最多20个字）",style:{width:"500px"}},null,8,["value"])])),_:1}),s(t,{name:"remark",label:"优惠券备注",rules:E},{default:_((()=>[s(l,{value:i($).remark,"onUpdate:value":a[2]||(a[2]=e=>i($).remark=e),maxlength:100,placeholder:"用于管理端备注，不会C端展示",style:{width:"500px"}},null,8,["value"])])),_:1}),s(t,{name:"num",label:"总发行量",rules:E},{default:_((()=>[s(o,{value:i($).num,"onUpdate:value":a[3]||(a[3]=e=>i($).num=e),min:1,placeholder:"只能输入整数，最小为1"},{addonAfter:_((()=>[p(" 张 ")])),_:1},8,["value"])])),_:1}),s(t,{name:"money",label:"面额",rules:E},{default:_((()=>[s(o,{value:i($).money,"onUpdate:value":a[4]||(a[4]=e=>i($).money=e),min:.01,max:1e3,placeholder:"只能在0.01 ~ 1000之间"},{addonAfter:_((()=>[p(" 元 ")])),_:1},8,["value"])])),_:1}),s(t,{name:"user_num",label:"限制数量",rules:E},{default:_((()=>[s(o,{value:i($).user_num,"onUpdate:value":a[5]||(a[5]=e=>i($).user_num=e),min:1,max:2e3,placeholder:"只能输入整数，最小为1，最大2000"},{addonAfter:_((()=>[p(" 张 ")])),_:1},8,["value"])])),_:1}),s(t,{name:"is_out_limit",label:"是否可超过限制数量"},{default:_((()=>[s(h,{checked:i($).is_out_limit,"onUpdate:checked":a[6]||(a[6]=e=>i($).is_out_limit=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),D("div",G,[s(t,{name:"is_limit_money",label:"满金额",style:{float:"left","margin-left":"15%"},"label-col":{},"wrapper-col":{}},{default:_((()=>[s(x,{value:i($).is_limit_money,"onUpdate:value":a[7]||(a[7]=e=>i($).is_limit_money=e)},{default:_((()=>[s(w,{value:0},{default:_((()=>[p(" 无限制 ")])),_:1}),s(w,{value:1},{default:_((()=>[p(" 满 ")])),_:1})])),_:1},8,["value"])])),_:1}),s(t,{name:"limit_money",label:"","label-col":{},"wrapper-col":{},rules:1===i($).is_limit_money?E:[]},{default:_((()=>[s(o,{value:i($).limit_money,"onUpdate:value":a[8]||(a[8]=e=>i($).limit_money=e)},{addonAfter:_((()=>[p(" 可用 ")])),_:1},8,["value"])])),_:1},8,["rules"])]),s(t,{name:"getTime",label:"领券时间",rules:E},{default:_((()=>[s(U,{value:i($).getTime,"onUpdate:value":a[9]||(a[9]=e=>i($).getTime=e),"show-time":{format:"HH:mm:ss"},"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:["领券开始时间","领券结束时间"]},null,8,["value"])])),_:1}),s(t,{name:"use_time_type",label:"用券时间",class:"use_time_type",rules:E},{default:_((()=>[s(x,{value:i($).use_time_type,"onUpdate:value":a[13]||(a[13]=e=>i($).use_time_type=e)},{default:_((()=>[s(w,{value:1},{default:_((()=>[p(" 固定时间 "),s(t,{name:"useTime",label:"",style:{display:"inline-block"},rules:1===i($).use_time_type?E:[],"label-col":{},"wrapper-col":{}},{default:_((()=>[s(U,{value:i($).useTime,"onUpdate:value":a[10]||(a[10]=e=>i($).useTime=e),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1},8,["rules"])])),_:1}),s(w,{value:2},{default:_((()=>[p(" 领取后 "),s(t,{name:"use_begin_day",label:"",style:{display:"inline-block"},rules:2===i($).use_time_type?E:[],"label-col":{},"wrapper-col":{}},{default:_((()=>[s(o,{value:i($).use_begin_day,"onUpdate:value":a[11]||(a[11]=e=>i($).use_begin_day=e)},null,8,["value"])])),_:1},8,["rules"]),p(" 天后生效，有效期 "),s(t,{name:"use_end_day",label:"",style:{display:"inline-block"},rules:2===i($).use_time_type?E:[],"label-col":{},"wrapper-col":{}},{default:_((()=>[s(o,{value:i($).use_end_day,"onUpdate:value":a[12]||(a[12]=e=>i($).use_end_day=e)},null,8,["value"])])),_:1},8,["rules"]),p(" 天 ")])),_:1})])),_:1},8,["value"])])),_:1}),D("div",V,[s(t,{name:"send_type",label:"发放方式",rules:E,style:{float:"left","margin-left":"15%"},"label-col":{},"wrapper-col":{}},{default:_((()=>[s(H,{value:i($).send_type,"onUpdate:value":a[14]||(a[14]=e=>i($).send_type=e),placeholder:"请选择","allow-clear":"",style:{width:"150px"}},{default:_((()=>[s(T,{value:1},{default:_((()=>[p(" 用户领取 ")])),_:1}),s(T,{value:2},{default:_((()=>[p(" 系统发放 ")])),_:1})])),_:1},8,["value"])])),_:1}),1===i($).send_type?(u(),r(t,{key:0,name:"coupon_type",label:"领取位置",rules:E,style:{float:"left","margin-left":"50px"},"label-col":{},"wrapper-col":{}},{default:_((()=>[s(H,{value:i($).coupon_type,"onUpdate:value":a[15]||(a[15]=e=>i($).coupon_type=e),placeholder:"请选择","allow-clear":"",style:{width:"150px"}},{default:_((()=>[s(T,{value:1},{default:_((()=>[p(" 领券中心 ")])),_:1}),s(T,{value:2},{default:_((()=>[p(" 首页弹窗 ")])),_:1}),s(T,{value:3},{default:_((()=>[p(" 链接领取 ")])),_:1})])),_:1},8,["value"])])),_:1})):f("",!0),2===i($).send_type?(u(),r(t,{key:1,name:"coupon_type",label:"触发条件",rules:E,style:{float:"left","margin-left":"50px"},"label-col":{},"wrapper-col":{}},{default:_((()=>[s(H,{value:i($).coupon_type,"onUpdate:value":a[16]||(a[16]=e=>i($).coupon_type=e),placeholder:"请选择","allow-clear":"",style:{width:"150px"}},{default:_((()=>[s(T,{value:10},{default:_((()=>[p(" 用户下单 ")])),_:1}),s(T,{value:11},{default:_((()=>[p(" 用户充值 ")])),_:1})])),_:1},8,["value"])])),_:1})):f("",!0)]),2===i($).coupon_type?(u(),r(t,{key:0,name:"home_img",label:"首页弹窗图",rules:E},{default:_((()=>[s(O,{filelist:i($).home_img,"onUpdate:filelist":a[17]||(a[17]=e=>i($).home_img=e),class:"long_img"},null,8,["filelist"])])),_:1})):f("",!0),2===i($).send_type?(u(),r(t,{key:1,name:"auto_send_num",label:"可同时获得",rules:E},{default:_((()=>[s(o,{value:i($).auto_send_num,"onUpdate:value":a[18]||(a[18]=e=>i($).auto_send_num=e),min:0},{addonAfter:_((()=>[p(" 张 ")])),_:1},8,["value"])])),_:1})):f("",!0),10===i($).coupon_type?(u(),r(t,{key:2,name:"order_min",label:"最低消费",rules:E},{default:_((()=>[s(o,{value:i($).order_min,"onUpdate:value":a[19]||(a[19]=e=>i($).order_min=e),min:0,placeholder:"请输入最低下单金额"},{addonAfter:_((()=>[p(" 元 ")])),_:1},8,["value"])])),_:1})):f("",!0),10===i($).coupon_type?(u(),r(t,{key:3,name:"order_goods_type",label:"下单商品",rules:E},{default:_((()=>[s(x,{value:i($).order_goods_type,"onUpdate:value":a[20]||(a[20]=e=>i($).order_goods_type=e)},{default:_((()=>[s(w,{value:1},{default:_((()=>[p(" 全场通用 ")])),_:1}),s(w,{value:2},{default:_((()=>[p(" 指定商品 ")])),_:1})])),_:1},8,["value"])])),_:1})):f("",!0),10===i($).coupon_type&&2===i($).order_goods_type?(u(),r(t,{key:4,name:"order_goods_ids",label:"指定商品",rules:E},{default:_((()=>[s(z,{value:i($).order_goods_ids,"onUpdate:value":a[21]||(a[21]=e=>i($).order_goods_ids=e)},null,8,["value"])])),_:1})):f("",!0),11===i($).coupon_type?(u(),r(t,{key:5,name:"recharge_money",label:"充值金额",rules:E},{default:_((()=>[s(o,{value:i($).recharge_money,"onUpdate:value":a[22]||(a[22]=e=>i($).recharge_money=e),min:.01,placeholder:"请输入充值金额",style:{width:"200px"}},{addonAfter:_((()=>[p(" 元 ")])),_:1},8,["value"])])),_:1})):f("",!0),11===i($).coupon_type?(u(),r(t,{key:6,name:"batch_number",label:"批次号",rules:E},{default:_((()=>[s(o,{value:i($).batch_number,"onUpdate:value":a[23]||(a[23]=e=>i($).batch_number=e),min:0,placeholder:"请输入批次号",style:{width:"200px"}},null,8,["value"])])),_:1})):f("",!0),s(t,{name:"get_platform",label:"领取平台",rules:E},{default:_((()=>[s(K,{value:i($).get_platform,"onUpdate:value":a[24]||(a[24]=e=>i($).get_platform=e)},{default:_((()=>[(u(!0),d(m,null,n(i(C).goods_platform,(e=>(u(),r(W,{key:e.value,value:e.value},{default:_((()=>[p(v(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),s(t,{name:"use_platform",label:"使用平台",rules:E},{default:_((()=>[s(K,{value:i($).use_platform,"onUpdate:value":a[25]||(a[25]=e=>i($).use_platform=e)},{default:_((()=>[(u(!0),d(m,null,n(i(C).goods_platform,(e=>(u(),r(W,{key:e.value,value:e.value},{default:_((()=>[p(v(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),s(t,{name:"member_type",label:"参与用户",rules:E},{default:_((()=>[s(K,{value:i($).member_type,"onUpdate:value":a[26]||(a[26]=e=>i($).member_type=e)},{default:_((()=>[(u(!0),d(m,null,n(i(C).member_type,(e=>(u(),r(W,{key:e.value,value:e.value},{default:_((()=>[p(v(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),s(t,{name:"member_features_type",label:"用户特征"},{default:_((()=>[s(K,{value:i($).member_features_type,"onUpdate:value":a[27]||(a[27]=e=>i($).member_features_type=e)},{default:_((()=>[s(W,{value:1},{default:_((()=>[p(" 新用户 ")])),_:1}),s(W,{value:2},{default:_((()=>[p(" 未下单 ")])),_:1})])),_:1},8,["value"])])),_:1}),s(t,{name:"use_goods_type",label:"可使用商品"},{default:_((()=>[s(x,{value:i($).use_goods_type,"onUpdate:value":a[28]||(a[28]=e=>i($).use_goods_type=e)},{default:_((()=>[s(w,{value:1},{default:_((()=>[p(" 全场通用 ")])),_:1}),s(w,{value:2},{default:_((()=>[p(" 指定商品 ")])),_:1}),s(w,{value:3},{default:_((()=>[p(" 不可用商品 ")])),_:1})])),_:1},8,["value"])])),_:1}),2===i($).use_goods_type||3===i($).use_goods_type?(u(),r(t,{key:7,name:"use_goods_ids",label:2===i($).use_goods_type?"指定商品":"不可用商品",rules:E},{default:_((()=>[s(z,{value:i($).use_goods_ids,"onUpdate:value":a[29]||(a[29]=e=>i($).use_goods_ids=e)},null,8,["value"])])),_:1},8,["label"])):f("",!0)])),_:1},8,["model"]),s(ee,null,{default:_((()=>[s(Z,{type:"primary",loading:i(X).submitLoading,onClick:P},{default:_((()=>[p(" 提交 ")])),_:1},8,["loading"])])),_:1})])}}}),[["__scopeId","data-v-ef65c37d"]]);export{E as default};
