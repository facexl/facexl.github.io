import{d as e,i as a,r as n,m as o,o as l,l as t,a as i,b as d,e as s,w as r,f as c,k as u,$ as p,M as h,q as g,I as m,A as f,E as b,_ as v,G as w,H as k,p as y,s as _,x as C,B as x}from"./index-c2ae2a0e.js";import{u as j,_ as I}from"./useTableColumns-dd067b4d.js";import{R,_ as S}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as K}from"./index-ef11d20c.js";import{u as N,a as T}from"./useSearchItems-c7d75cf3.js";import{u as U}from"./usePagination-c05046ed.js";import{d as q}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const O=v(e({__name:"NewSearch",props:{show:Boolean,id:Number},emits:["fresh"],setup(e,{emit:v}){const w=e,k=a(w,"show",v),y=n(),_={required:!0,message:"请输入"},C=o({loading:!1}),x=o({name:"",sort:"",enabled:0});l((()=>{})),t(k,(e=>{e&&(y.value&&y.value.resetFields(),w.id&&(C.loading=!0,p.productConfig.search.detail({id:w.id}).then((e=>{for(let a in x)void 0!==e.data.detail[a]&&(x[a]=e.data.detail[a]);setTimeout((e=>{C.loading=!1}),50)}))))}));const j=()=>{y.value.validate().then((async e=>{await p.productConfig.search[w.id?"edit":"add"]({...e,id:w.id||void 0}),k.value=!1,v("fresh")})).catch((e=>{console.log(e)}))};return(a,n)=>{const o=m,l=f,t=R,p=S,v=b,w=h;return i(),d("div",null,[s(w,{visible:c(k),"onUpdate:visible":n[3]||(n[3]=e=>u(k)?k.value=e:null),width:"600px",title:e.id?"编辑搜索词":"添加搜索词","mask-closable":!1,onOk:j},{default:r((()=>[s(v,{ref_key:"formRef",ref:y,model:c(x),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:r((()=>[s(l,{name:"name",label:"关键词",rules:[_]},{default:r((()=>[s(o,{value:c(x).name,"onUpdate:value":n[0]||(n[0]=e=>c(x).name=e),placeholder:"请输入关键词",maxlength:8},null,8,["value"])])),_:1},8,["rules"]),s(l,{name:"sort",label:"排序值",rules:[_]},{default:r((()=>[s(o,{value:c(x).sort,"onUpdate:value":n[1]||(n[1]=e=>c(x).sort=e),placeholder:"请输入排序值"},null,8,["value"])])),_:1},8,["rules"]),s(l,{name:"enabled",label:"是否启用"},{default:r((()=>[s(p,{value:c(x).enabled,"onUpdate:value":n[2]||(n[2]=e=>c(x).enabled=e)},{default:r((()=>[s(t,{value:1},{default:r((()=>[g(" 是 ")])),_:1}),s(t,{value:0},{default:r((()=>[g(" 否 ")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-58f715b0"]]),B={key:1},D=e({__name:"SearchManage",setup(e){const a=N([["input","name","关键词/名称"],["select","enabled","状态"]]),n=j([["编号","id"],["关键词","name"],["排序","sort"],["状态","enabled"],["操作","operate",130,"right"]]),t=o({handlingId:0,dataSource:[],loading:!1,query:{},pagination:U(),showNewDialog:!1,handlingInfo:{},selectedRowKeys:[],selectBtn:void 0,batchs:[{label:"批量删除",value:"3"},{label:"批量启用",value:"1"},{label:"批量禁用",value:"2"}]});l((()=>{u()}));const u=()=>{t.loading=!0,p.productConfig.search.list({page:t.pagination.current,page_size:t.pagination.pageSize,...t.query}).then((e=>{var n;t.loading=!1,t.dataSource=e.data.items,1===t.pagination.current&&(t.pagination.total=+(null==(n=e.data)?void 0:n.count)),T(a,"enabled",e.data.enabled_map),t.selectedRowKeys=[]}))},h=e=>{t.pagination={...t.pagination,...e},u()},m=e=>{t.query=e,t.pagination={...t.pagination,current:1},u()},f=e=>{t.selectedRowKeys=e},b=e=>{var a;3===(e=+e)?(a=t.selectedRowKeys.join(","),q.confirm({title:"提示",content:"确认删除搜索词？",okText:"确认",cancelText:"取消",onOk:()=>{p.productConfig.search.deleteAll({ids:a+""}).then((e=>{u()}))}})):v({enabled:e,id:t.selectedRowKeys.join(",")})},v=async e=>{await p.productConfig.search[1===e.enabled?"enableAll":"disableAll"]({ids:e.id+""}).catch((a=>{e.enabled=1===e.enabled?0:1})),u()};return(e,o)=>{const l=x,j=w("Search"),R=K,S=I,N=w("BatchTable"),T=k("permission");return i(),d("div",null,[s(j,{"search-options":c(a),onOnSearch:m},{default:r((()=>[C((i(),y(l,{type:"primary",onClick:o[0]||(o[0]=e=>{c(t).handlingId=0,c(t).handlingInfo={},c(t).showNewDialog=!0})},{default:r((()=>[g(" 添加 ")])),_:1})),[[T,[c(p).productConfig.search.add]]])])),_:1},8,["search-options"]),s(S,{"data-source":c(t).dataSource,columns:c(n),scroll:{x:"max-content"},loading:c(t).loading,pagination:c(t).pagination,"row-key":"id","row-selection":{selectedRowKeys:c(t).selectedRowKeys,onChange:f},onChange:h},{bodyCell:r((({column:e,record:a})=>["enabled"===e.key?(i(),y(R,{key:0,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>v(a)},null,8,["checked","onUpdate:checked","onChange"])):_("",!0),"operate"===e.key?(i(),d("div",B,[C((i(),y(l,{type:"link",onClick:e=>{c(t).handlingId=a.id,c(t).handlingInfo=a,c(t).showNewDialog=!0}},{default:r((()=>[g(" 编辑 ")])),_:2},1032,["onClick"])),[[T,[c(p).productConfig.search.edit]]]),C((i(),y(l,{type:"link",class:"danger-color",onClick:e=>{return n=a.id,void q.confirm({title:"提示",content:"确认删除搜索词？",okText:"确认",cancelText:"取消",onOk:()=>{p.productConfig.search.delete({id:n+""}).then((e=>{u()}))}});var n}},{default:r((()=>[g(" 删除 ")])),_:2},1032,["onClick"])),[[T,[c(p).productConfig.search.delete]]])])):_("",!0)])),_:1},8,["data-source","columns","loading","pagination","row-selection"]),c(t).dataSource.length?(i(),y(N,{key:0,batchs:c(t).batchs,"selected-row-keys":c(t).selectedRowKeys,onClick:b},null,8,["batchs","selected-row-keys"])):_("",!0),s(O,{id:c(t).handlingId,show:c(t).showNewDialog,"onUpdate:show":o[1]||(o[1]=e=>c(t).showNewDialog=e),"handling-info":c(t).handlingInfo,onFresh:u},null,8,["id","show","handling-info"])])}}});export{D as default};
