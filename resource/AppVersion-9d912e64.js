import{d as e,i as a,r as l,m as t,o,l as n,a as s,b as r,e as d,w as u,f as i,k as p,$ as c,M as m,F as v,n as _,p as h,q as y,z as f,I as g,A as b,V as w,W as k,a7 as x,Y as O,E as P,_ as U,G as j,H as T,s as A,x as C,B as I}from"./index-c2ae2a0e.js";import{u as V,_ as R}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as S,a as D}from"./useSearchItems-c7d75cf3.js";import{u as N}from"./usePagination-c05046ed.js";import{_ as q}from"./index-ef11d20c.js";import{d as K}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const Y=U(e({__name:"NewAppVersion",props:{show:Boolean,id:Number,typeOpt:{type:Array,default:()=>[]},subTypeOpt:{type:Array,default:()=>[]}},emits:["fresh"],setup(e,{emit:U}){const j=e,T=a(j,"show",U),A=l(),C={required:!0,message:"请输入"},I=t({loading:!1}),V=t({name:"",type:void 0,sub_type:void 0,download_url:void 0,market_url:void 0,version_number:void 0,force:0,remark:void 0,now_version:void 0,released_date:void 0,content:void 0});o((()=>{})),n(T,(e=>{e&&(A.value&&A.value.resetFields(),j.id&&(I.loading=!0,c.set.appVersion.detail({id:j.id}).then((e=>{for(let a in V)void 0!==e.data[a]&&(V[a]=e.data[a]);setTimeout((e=>{I.loading=!1}),50)}))))}));const R=()=>{A.value.validate().then((async e=>{await c.set.appVersion.save({...e,id:j.id||void 0}),T.value=!1,U("fresh")})).catch((e=>{console.log(e)}))};return(a,l)=>{const t=g,o=b,n=w,c=k,U=q,j=x,I=O,S=P,D=m;return s(),r("div",null,[d(D,{visible:i(T),"onUpdate:visible":l[11]||(l[11]=e=>p(T)?T.value=e:null),width:"600px",title:e.id?"编辑版本":"添加版本","mask-closable":!1,onOk:R},{default:u((()=>[d(S,{ref_key:"formRef",ref:A,model:i(V),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:18}},{default:u((()=>[d(o,{name:"name",label:"名称关键字",rules:[C]},{default:u((()=>[d(t,{value:i(V).name,"onUpdate:value":l[0]||(l[0]=e=>i(V).name=e),maxlength:30,placeholder:"请输入名称关键字"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"version_number",label:"版本号",rules:[C]},{default:u((()=>[d(t,{value:i(V).version_number,"onUpdate:value":l[1]||(l[1]=e=>i(V).version_number=e),maxlength:15,placeholder:"请输入版本号"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"now_version",label:"展示版本号",rules:[C]},{default:u((()=>[d(t,{value:i(V).now_version,"onUpdate:value":l[2]||(l[2]=e=>i(V).now_version=e),maxlength:15,placeholder:"请输入展示版本号"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"download_url",label:"下载地址"},{default:u((()=>[d(t,{value:i(V).download_url,"onUpdate:value":l[3]||(l[3]=e=>i(V).download_url=e),placeholder:"请输入下载地址"},null,8,["value"])])),_:1}),d(o,{name:"market_url",label:"应用市场地址"},{default:u((()=>[d(t,{value:i(V).market_url,"onUpdate:value":l[4]||(l[4]=e=>i(V).market_url=e),placeholder:"请输入应用市场地址"},null,8,["value"])])),_:1}),d(o,{name:"type",label:"类型",rules:[C]},{default:u((()=>[d(c,{value:i(V).type,"onUpdate:value":l[5]||(l[5]=e=>i(V).type=e),placeholder:"请选择类型"},{default:u((()=>[(s(!0),r(v,null,_(e.typeOpt||[],(e=>(s(),h(n,{key:e.value},{default:u((()=>[y(f(e.label),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1},8,["rules"]),d(o,{name:"sub_type",label:"子类型",rules:[C]},{default:u((()=>[d(c,{value:i(V).sub_type,"onUpdate:value":l[6]||(l[6]=e=>i(V).sub_type=e),placeholder:"请选择子类型"},{default:u((()=>[(s(!0),r(v,null,_(e.subTypeOpt||[],(e=>(s(),h(n,{key:e.value},{default:u((()=>[y(f(e.label),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1},8,["rules"]),d(o,{name:"force",label:"是否强制更新",rules:[C]},{default:u((()=>[d(U,{checked:i(V).force,"onUpdate:checked":l[7]||(l[7]=e=>i(V).force=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1},8,["rules"]),d(o,{name:"remark",label:"APP版本摘要信息",rules:[C]},{default:u((()=>[d(t,{value:i(V).remark,"onUpdate:value":l[8]||(l[8]=e=>i(V).remark=e),maxlength:60,placeholder:"请输入APP版本摘要信息"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"content",label:"APP更新内容",rules:[C]},{default:u((()=>[d(j,{value:i(V).content,"onUpdate:value":l[9]||(l[9]=e=>i(V).content=e),maxlength:200,style:{height:"90px"},placeholder:"请输入APP更新内容"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"released_date",label:"APP更新时间",rules:[C]},{default:u((()=>[d(I,{value:i(V).released_date,"onUpdate:value":l[10]||(l[10]=e=>i(V).released_date=e),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"请选择APP更新时间"},null,8,["value"])])),_:1},8,["rules"])])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-84783116"]]),B={key:0},F=e({__name:"AppVersion",setup(e){const a=S([["input","keywords","名称关键字"],["input","version_number","版本号"],["select","type","类型"],["select","sub_type","子类型"],["select","force","是否强制更新"],["dateRange","start_at-end_at",["注册时间开始","注册时间结束"]]]),l=V([["编号","id"],["名称","name"],["类型","type_name"],["子类型","sub_type_name"],["下载地址","download_url"],["应用市场地址","market_url"],["版本号","version_number"],["展示版本号","now_version"],["版本摘要信息","remark"],["更新内容","content"],["是否强制更新","force_name"],["更新时间","released_date"],["创建时间","created_at"],["操作","operate",130,"right"]]),n=t({handlingId:0,dataSource:[],loading:!1,query:{},pagination:N(),showNewDialog:!1,handlingInfo:{},typeOpt:[],subTypeOpt:[],batchs:[{label:"批量删除",value:"1"}],selectedRowKeys:[]});o((()=>{p()}));const p=()=>{n.loading=!0,c.set.appVersion.list({page:n.pagination.current,page_size:n.pagination.pageSize,...n.query}).then((e=>{var l;n.loading=!1,n.dataSource=e.data.items,1===n.pagination.current&&(n.pagination.total=+(null==(l=e.data)?void 0:l.count)),n.typeOpt=e.data.type,n.subTypeOpt=e.data.subType,D(a,"type",e.data.type),D(a,"sub_type",e.data.subType),D(a,"force",{0:"否",1:"是"})}))},m=e=>{n.pagination={...n.pagination,...e},p()},v=e=>{K.confirm({title:"提示",content:"确认删除该版本？",okText:"确认",cancelText:"取消",onOk:()=>{c.set.appVersion.delete({ids:e}).then((e=>{p()}))}})},_=e=>{n.selectedRowKeys=e},f=e=>{v(n.selectedRowKeys.join(","))},g=e=>{n.query=e,n.pagination={...n.pagination,current:1},p()};return(e,t)=>{const o=I,b=j("Search"),w=R,k=j("BatchTable"),x=T("permission");return s(),r("div",null,[d(b,{"search-options":i(a),onOnSearch:g},{default:u((()=>[C((s(),h(o,{type:"primary",onClick:t[0]||(t[0]=e=>{i(n).handlingId=0,i(n).handlingInfo={},i(n).showNewDialog=!0})},{default:u((()=>[y(" 添加 ")])),_:1})),[[x,[i(c).set.appVersion.save]]])])),_:1},8,["search-options"]),d(w,{"data-source":i(n).dataSource,columns:i(l),scroll:{x:"max-content"},loading:i(n).loading,"row-key":"id","row-selection":{selectedRowKeys:i(n).selectedRowKeys,onChange:_},pagination:i(n).pagination,onChange:m},{bodyCell:u((({column:e,record:a})=>["operate"===e.key?(s(),r("div",B,[C((s(),h(o,{type:"link",onClick:e=>{i(n).handlingId=a.id,i(n).handlingInfo=a,i(n).showNewDialog=!0}},{default:u((()=>[y(" 编辑 ")])),_:2},1032,["onClick"])),[[x,[i(c).set.appVersion.save]]]),C((s(),h(o,{type:"link",class:"danger-color",onClick:e=>v(a.id)},{default:u((()=>[y(" 删除 ")])),_:2},1032,["onClick"])),[[x,[i(c).set.appVersion.delete]]])])):A("",!0)])),_:1},8,["data-source","columns","loading","row-selection","pagination"]),i(n).dataSource.length?(s(),h(k,{key:0,batchs:i(n).batchs,"selected-row-keys":i(n).selectedRowKeys,onClick:f},null,8,["batchs","selected-row-keys"])):A("",!0),d(Y,{id:i(n).handlingId,show:i(n).showNewDialog,"onUpdate:show":t[1]||(t[1]=e=>i(n).showNewDialog=e),"type-opt":i(n).typeOpt,"sub-type-opt":i(n).subTypeOpt,onFresh:p},null,8,["id","show","type-opt","sub-type-opt"])])}}});export{F as default};
