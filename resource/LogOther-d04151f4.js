import{d as a,i as n,m as e,o,l as t,a as i,b as l,e as s,w as d,f as r,k as g,M as c,g as m,z as p,F as u,n as _,x as h,y as b,s as f,p as y,a2 as I,$ as O,S as v,_ as j,G as w}from"./index-c2ae2a0e.js";import{u as N,_ as k}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as T,a as C}from"./useSearchItems-c7d75cf3.js";import{u as x}from"./usePagination-c05046ed.js";import{L as D}from"./log-6aa04327.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const A={class:"label"},S={class:"label"},$={class:"label"},L={class:"label"},q={key:0,class:"label",style:{"margin-top":"10px"}},B={key:1,class:"label",style:{"margin-top":"10px"}},z=j(a({__name:"LogOtherDetail",props:{show:Boolean,id:Number,handlingInfo:{type:Object,default:()=>{}},ACTION_NO_BOTTOM:{type:Array,default:[]},ACTION:{type:Array,default:[]},name:String},emits:["fresh"],setup(a,{emit:j}){const w=a,T=n(w,"show",j),C=N([["字段","name"],["操作前","before",430],["操作后","behind",430]]),x=e({loading:!1,keys:{},list:[]});o((()=>{})),t(T,(a=>{if(a){x.loading=!0,O.jurisdiction.log.getKey({log_service:w.name,log_type:w.handlingInfo.log_type}).then((a=>{x.keys=a.data||{},setTimeout((a=>{x.loading=!1}),50)}));let a=w.handlingInfo,n=[];a.old_data=a.old_data||{},n.push({tableData:D.toList(a.old_data,a.new_data,w.name)}),console.log(n),x.list=n}}));const z=a=>{for(let n=0;n<w.ACTION.length;n++)if(w.ACTION[n].value==a)return w.ACTION[n].label};return(n,e)=>{const o=k,t=v,O=c;return i(),l("div",null,[s(O,{visible:r(T),"onUpdate:visible":e[0]||(e[0]=a=>g(T)?T.value=a:null),width:"1100px",title:"操作记录","mask-closable":!1,footer:null,onOk:n.handleOk},{default:d((()=>[s(t,{spinning:r(x).loading},{default:d((()=>[m("div",A," 操作对象："+p(`${a.handlingInfo.object_name}(id:${a.handlingInfo.object_id})`),1),m("div",S," 操作名："+p(z(a.handlingInfo.log_type)),1),m("div",$," 操作人："+p(a.handlingInfo.admin_name),1),m("div",L," 操作时间："+p(a.handlingInfo.handle_time),1),(i(!0),l(u,null,_(r(x).list,((n,e)=>h((i(),l("div",{key:e},[n.data_name&&"类目规格"!==n.data_name?(i(),l("div",q," 【"+p(n.data_name)+"】： ",1)):f("",!0),n.data_name&&"类目规格"===n.data_name?(i(),l("div",B,p(n.data_name1),1)):f("",!0),n.tableData&&n.tableData.length?(i(),y(o,{key:2,"data-source":n.tableData,columns:r(C),scroll:{x:"max-content"},loading:r(x).loading,pagination:!1},{bodyCell:d((({column:a,record:n})=>["name"===a.key?(i(),l("span",{key:0,style:I({color:n.before===n.behind?"#000000":"red"})},p(r(x).keys[n.name]||n.name),5)):f("",!0)])),_:2},1032,["data-source","columns","loading"])):f("",!0)])),[[b,!a.ACTION_NO_BOTTOM.includes(a.handlingInfo.log_type)]]))),128))])),_:1},8,["spinning"])])),_:1},8,["visible","onOk"])])}}}),[["__scopeId","data-v-77b0ca52"]]),F=["onClick"],M="other",J=j(a({__name:"LogOther",setup(a){const n=[],t=T([["input","admin_id","操作者ID"],["dateRange","start_time-end_time",["开始时间","结束时间"]],["select","log_type","动作"],["input","object_id","目标ID"]]),g=N([["操作者","admin_name"],["操作者ID","admin_id"],["操作时间","handle_time"],["模块","log_type"],["操作名","handle_name"],["操作对象","object_name",340],["操作记录","operate"]]),c=e({handlingId:0,dataSource:[],loading:!1,query:{},pagination:x(),showNewDialog:!1,handlingInfo:{},ACTION:[]});o((()=>{m(),u()}));const m=()=>{c.loading=!0,O.jurisdiction.log.otherList({page:c.pagination.current,page_size:c.pagination.pageSize,...c.query}).then((a=>{var n;c.loading=!1,a.data.items.forEach((a=>{a.new_data=a.new_data?JSON.parse(a.new_data):{},a.old_data=a.old_data?JSON.parse(a.old_data):{}})),c.dataSource=a.data.items,1===c.pagination.current&&(c.pagination.total=+(null==(n=a.data)?void 0:n.count))}))},u=async()=>{try{const{data:a}=await O.jurisdiction.log.getType({log_service:M});let n=[];for(let e in a)n.push({label:a[e],value:+e});c.ACTION=n,C(t,"log_type",n)}catch(a){}},_=a=>{c.pagination={...c.pagination,...a},m()},h=a=>{c.query=a,c.pagination={...c.pagination,current:1},m()};return(a,e)=>{const o=w("Search"),u=k;return i(),l("div",null,[s(o,{"search-options":r(t),onOnSearch:h},null,8,["search-options"]),s(u,{"data-source":r(c).dataSource,columns:r(g),scroll:{x:"max-content"},loading:r(c).loading,pagination:r(c).pagination,onChange:_},{bodyCell:d((({column:a,record:n})=>["operate"===a.key?(i(),l("a",{key:0,class:"cell",href:"javascript:;",onClick:a=>{r(c).handlingId=n.id,r(c).handlingInfo=n,r(c).showNewDialog=!0}},p(`操作对象：${n.object_name}(id:${n.object_id})，操作名：`)+" "+p(n.handle_name)+" "+p(`，操作人：${n.admin_name}，操作时间：`)+" "+p(n.handle_time),9,F)):f("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),s(z,{id:r(c).handlingId,show:r(c).showNewDialog,"onUpdate:show":e[0]||(e[0]=a=>r(c).showNewDialog=a),"handling-info":r(c).handlingInfo,"a-c-t-i-o-n":r(c).ACTION,"a-c-t-i-o-n-n-o-b-o-t-t-o-m":n,name:M,onFresh:m},null,8,["id","show","handling-info","a-c-t-i-o-n"])])}}}),[["__scopeId","data-v-bbf7084b"]]);export{J as default};
