import{d as a,i as t,l as e,m as o,o as n,G as i,H as s,a as r,p as d,w as l,f as u,k as p,e as c,x as m,$ as g,s as _,a0 as h,b as y,g as x,q as b,z as w,B as k}from"./index-c2ae2a0e.js";import{u as S,_ as q}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as f}from"./index-00d344de.js";import{u as v,a as j}from"./useSearchItems-c7d75cf3.js";import{u as D}from"./usePagination-c05046ed.js";import{d as C,e as I}from"./useRequest-34a5e624.js";import{_ as R}from"./index-975d3375.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const z=a({__name:"ProductStaDetail",props:{show:Boolean,id:String},emits:[],setup(a,{emit:h}){const y=a,x=t(y,"show",h),b=v([["dateRange","start_time-end_time",["开始时间","结束时间"]],["input","team_id","团队长ID"]]);e(x,(a=>{a&&j()}));const w=S([["团队长ID","id"],["团队长","username"],["商品名称","title"],["下单数量","order_num"],["商品数量","goods_num"],["下单金额","order_money"]]),k=o({dataSource:[],loading:!1,pagination:D(),query:{}});n((()=>{}));const j=()=>{k.loading=!0,g.sta.product.buyList({page:k.pagination.current,page_size:k.pagination.pageSize,...k.query,goods_id:y.id}).then((a=>{var t;k.loading=!1,k.dataSource=a.data.items,1===k.pagination.current&&(k.pagination.total=+(null==(t=a.data)?void 0:t.count))}))},C=a=>{k.pagination={...k.pagination,...a},j()},I=a=>{k.query=a,k.pagination={...k.pagination,current:1},j()};return(a,t)=>{const e=i("Export"),o=i("Search"),n=f,h=q,S=R,v=s("permission");return r(),d(S,{visible:u(x),"onUpdate:visible":t[0]||(t[0]=a=>p(x)?x.value=a:null),title:"团队购买力",placement:"right",width:"80%"},{default:l((()=>[c(o,{"search-options":u(b),onOnSearch:I},{default:l((()=>[m(c(e,{api:u(g).sta.product.buyExport,query:{...u(k).query,goods_id:y.id}},null,8,["api","query"]),[[v,[u(g).sta.product.buyExport]]])])),_:1},8,["search-options"]),c(h,{"row-key":"id","data-source":u(k).dataSource,columns:u(w),scroll:{x:"max-content"},loading:u(k).loading,pagination:u(k).pagination,onChange:C},{bodyCell:l((({column:a,record:t})=>["useravatar"===a.key?(r(),d(n,{key:0,width:50,src:t.useravatar},null,8,["src"])):_("",!0),"goods_thumb"===a.key?(r(),d(n,{key:1,width:50,src:t.goods_thumb},null,8,["src"])):_("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])),_:1},8,["visible"])}}}),B={class:"table-pandect"},E=a({__name:"ProductSta",setup(a){h("enums");const t=v([["input","goods_id","商品编号"],["input","goods_title","商品名称"],["select","status","上架状态"],["cascader","cat_id","商品分类"],["dateRange","start_time-end_time",["开始时间","结束时间"]],["input","max_num","销量最小值"],["input","min_num","销量最大值"],["select","supplier_id","商家"],["dateRange","start_at-end_at",["上架时间开始","上架时间结束"]]]),p=S([["商品编号","goods_id"],["商品名称","title"],["商品缩略图","thumb",120],["分类名称","cat_name"],["状态","status"],["商家","supplier_name"],["销售总量","sale_num"],["订单总数","order_num"],["销售总额","sale_money"],["商品单价","market_price"],["操作","operate",160,"right"]]),R=C(),E=I(!0);e(R,(a=>{j(t,"cat_id",a)})),e(E,(a=>{j(t,"supplier_id",a)})),j(t,"status",{0:"下架",1:"预上架",10:"上架"});const O=o({handlingId:"",showDetail:!1,handlingRow:{},dataSource:[],loading:!1,query:{},pagination:D(),calculate:{}});e((()=>O.tab_status),(()=>{P()})),n((()=>{P()}));const P=()=>{O.loading=!0,g.sta.product.list({page:O.pagination.current,page_size:O.pagination.pageSize,...O.query}).then((a=>{var e;O.loading=!1,O.dataSource=a.data.items,O.calculate={total_sale:a.data.total_sale,total_order:a.data.total_order},1===O.pagination.current&&(O.pagination.total=+(null==(e=a.data)?void 0:e.count)),j(t,"client_type",a.data.client_type_map),j(t,"cate_id",a.data.categories_map)}))},L=a=>{O.query=a,O.pagination={...O.pagination,current:1},P()},U=a=>{O.pagination={...O.pagination,...a},P()};return(a,e)=>{const o=i("Export"),n=i("Search"),h=f,S=k,v=q,j=s("permission");return r(),y("div",null,[c(n,{"search-options":u(t),onOnSearch:L},{default:l((()=>[m(c(o,{api:u(g).sta.product.export,query:{...u(O).query}},null,8,["api","query"]),[[j,[u(g).sta.product.export]]])])),_:1},8,["search-options"]),x("div",B,[b(" 商品总销量 "),x("span",null,w(u(O).calculate.total_sale),1),b(" 个，订单总数 "),x("span",null,w(u(O).calculate.total_order),1),b(" 笔 ")]),c(v,{"row-key":"order_id","data-source":u(O).dataSource,columns:u(p),scroll:{x:"max-content"},loading:u(O).loading,pagination:u(O).pagination,onChange:U},{bodyCell:l((({column:a,record:t})=>["thumb"===a.key?(r(),d(h,{key:0,width:50,src:t.thumb},null,8,["src"])):_("",!0),"operate"===a.key?m((r(),d(S,{key:1,type:"link",onClick:a=>{u(O).handlingId=t.goods_id,u(O).showDetail=!0}},{default:l((()=>[b(" 团队购买力排行 ")])),_:2},1032,["onClick"])),[[j,[u(g).order.orderList.detail]]]):_("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),c(z,{id:u(O).handlingId,show:u(O).showDetail,"onUpdate:show":e[0]||(e[0]=a=>u(O).showDetail=a)},null,8,["id","show"])])}}});export{E as default};
