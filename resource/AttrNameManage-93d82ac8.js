import{d as a,i as e,r as t,m as n,o as i,l as o,a as l,b as d,e as s,w as r,f as u,k as c,$ as p,M as m,p as g,s as h,q as f,I as v,A as _,E as k,a3 as y,a4 as b,g as I,_ as C,u as w,G as N,H as x,x as U,B as j}from"./index-c2ae2a0e.js";import{u as S,_ as q}from"./useTableColumns-dd067b4d.js";import{R as O,_ as D}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as R}from"./index-ef11d20c.js";import{u as T,a as A}from"./useSearchItems-c7d75cf3.js";import{u as B}from"./usePagination-c05046ed.js";import{d as F}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const K=a=>(y("data-v-059e0074"),a=a(),b(),a),M=K((()=>I("div",{class:"tips"},' 多个规格值请用","分开 ',-1))),z=K((()=>I("div",{class:"danger-color tips"}," 说明：一个规格类目只能有一个启用的可“设置SKU图”的规格 ",-1))),V=C(a({__name:"NewAttrName",props:{show:Boolean,id:Number,attrId:String,handlingInfo:{type:Object,default:()=>{}}},emits:["fresh"],setup(a,{emit:y}){const b=a,I=e(b,"show",y),C=t(),w={required:!0,message:"请输入"},N=n({type:"add"}),x=n({name:"",attr_value:"",is_img:0,sort:void 0});i((()=>{})),o(I,(a=>{if(a){C.value&&C.value.resetFields();let a="add";b.id&&(a="edit"),N.type=a,setTimeout((a=>{for(let e in x)void 0!==b.handlingInfo[e]&&(x[e]=b.handlingInfo[e])}),200)}}));const U=()=>{C.value.validate().then((async a=>{await p.productConfig.attrName[N.type]({...a,id:b.id||void 0,type_id:b.attrId||void 0}),I.value=!1,y("fresh")})).catch((a=>{console.log(a)}))};return(a,e)=>{const t=v,n=_,i=O,o=D,p=k,y=m;return l(),d("div",null,[s(y,{visible:u(I),"onUpdate:visible":e[4]||(e[4]=a=>c(I)?I.value=a:null),width:"550px",title:"edit"===u(N).type?"编辑规格名":"添加规格名","mask-closable":!1,onOk:U},{default:r((()=>[s(p,{ref_key:"formRef",ref:C,model:u(x),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:r((()=>[s(n,{name:"name",label:"规格名称",rules:[w]},{default:r((()=>[s(t,{value:u(x).name,"onUpdate:value":e[0]||(e[0]=a=>u(x).name=a)},null,8,["value"])])),_:1},8,["rules"]),"edit"!==u(N).type?(l(),g(n,{key:0,name:"attr_value",label:"规格值"},{default:r((()=>[s(t,{value:u(x).attr_value,"onUpdate:value":e[1]||(e[1]=a=>u(x).attr_value=a)},null,8,["value"]),M])),_:1})):h("",!0),s(n,{name:"is_img",label:"可设置SKU图"},{default:r((()=>[s(o,{value:u(x).is_img,"onUpdate:value":e[2]||(e[2]=a=>u(x).is_img=a),style:{margin:"6px 0 0 10px"}},{default:r((()=>[s(i,{value:1},{default:r((()=>[f(" 是 ")])),_:1}),s(i,{value:0},{default:r((()=>[f(" 否 ")])),_:1})])),_:1},8,["value"]),z])),_:1}),s(n,{name:"sort",label:"排序"},{default:r((()=>[s(t,{value:u(x).sort,"onUpdate:value":e[3]||(e[3]=a=>u(x).sort=a)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-059e0074"]]),$={key:2},E=a({__name:"AttrNameManage",setup(a){const e=T([["input","name","规格名称"],["select","enabled","状态"]]),t=S([["编号","id"],["规格名称","name"],["规格值","values"],["可设置SKU图","is_img"],["排序","sort"],["状态","enabled"],["操作","operate",185,"right"]]),o=n({handlingId:0,dataSource:[],loading:!1,query:{},pagination:B(),showNewDialog:!1,handlingInfo:{},attrId:""});i((()=>{const a=w();o.attrId=String(a.currentRoute.value.params.attrId),c()}));const c=()=>{o.loading=!0,p.productConfig.attrName.list({page:o.pagination.current,page_size:o.pagination.pageSize,...o.query,type_id:o.attrId}).then((a=>{var t;o.loading=!1,o.dataSource=a.data.items,1===o.pagination.current&&(o.pagination.total=+(null==(t=a.data)?void 0:t.count)),A(e,"enabled",a.data.enabled_map)}))},m=a=>{o.pagination={...o.pagination,...a},c()},v=a=>{o.query=a,o.pagination={...o.pagination,current:1},c()};return(a,n)=>{const i=j,_=N("Search"),k=R,y=q,b=x("permission");return l(),d("div",null,[s(_,{"search-options":u(e),onOnSearch:v},{default:r((()=>[U((l(),g(i,{type:"primary",onClick:n[0]||(n[0]=a=>{u(o).handlingId=0,u(o).handlingInfo={},u(o).showNewDialog=!0})},{default:r((()=>[f(" 添加 ")])),_:1})),[[b,[u(p).productConfig.attrName.add]]])])),_:1},8,["search-options"]),s(y,{"data-source":u(o).dataSource,columns:u(t),scroll:{x:"max-content"},loading:u(o).loading,pagination:u(o).pagination,onChange:m},{bodyCell:r((({column:e,record:t})=>["is_img"===e.key?(l(),g(k,{key:0,checked:t.is_img,"onUpdate:checked":a=>t.is_img=a,"un-checked-value":0,"checked-value":1,onChange:a=>(async a=>{await p.productConfig.attrName.setImg({attr_id:a.id,enabled:a.is_img,type_id:a.type_id}).catch((e=>{a.is_img=1===a.is_img?0:1}))})(t)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"enabled"===e.key?(l(),g(k,{key:1,checked:t.enabled,"onUpdate:checked":a=>t.enabled=a,"un-checked-value":0,"checked-value":1,onChange:a=>(async a=>{await p.productConfig.attrName.status({attr_id:a.id,enabled:a.enabled}).catch((e=>{a.enabled=1===a.enabled?0:1}))})(t)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===e.key?(l(),d("div",$,[U((l(),g(i,{type:"link",onClick:e=>a.$router.push({name:"attrValueManage",params:{attrId:t.type_id,attrNameId:t.id}})},{default:r((()=>[f(" 规格值 ")])),_:2},1032,["onClick"])),[[b,[u(p).productConfig.attrValue.list]]]),U((l(),g(i,{type:"link",onClick:a=>(a=>{o.handlingId=a.id,o.handlingInfo={...a,attr_value:a.values},o.showNewDialog=!0})(t)},{default:r((()=>[f(" 编辑 ")])),_:2},1032,["onClick"])),[[b,[u(p).productConfig.attrName.edit]]]),U((l(),g(i,{type:"link",class:"danger-color",onClick:a=>{return e=t.id,void F.confirm({title:"提示",content:"确认删除该规格名？",okText:"确认",cancelText:"取消",onOk:()=>{p.productConfig.attrName.delete({id:e}).then((a=>{c()}))}});var e}},{default:r((()=>[f(" 删除 ")])),_:2},1032,["onClick"])),[[b,[u(p).productConfig.attrName.delete]]])])):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),s(V,{id:u(o).handlingId,show:u(o).showNewDialog,"onUpdate:show":n[1]||(n[1]=a=>u(o).showNewDialog=a),"attr-id":u(o).attrId,"handling-info":u(o).handlingInfo,onFresh:c},null,8,["id","show","attr-id","handling-info"])])}}});export{E as default};
