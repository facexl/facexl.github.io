import{d as a,i as e,r as t,m as n,o,l as i,a as d,b as l,e as r,w as s,f as u,k as p,$ as c,M as g,I as m,A as h,E as f,_ as v,u as I,G as _,H as y,x as b,p as k,q as w,s as C,B as N}from"./index-c2ae2a0e.js";import{u as x,_ as j}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as S}from"./index-ef11d20c.js";import{u as V,a as q}from"./useSearchItems-c7d75cf3.js";import{u as O}from"./usePagination-c05046ed.js";import{d as U}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const D=v(a({__name:"NewAttrValue",props:{show:Boolean,id:Number,attrId:String,attrNameId:String,handlingInfo:{type:Object,default:()=>{}}},emits:["fresh"],setup(a,{emit:v}){const I=a,_=e(I,"show",v),y=t(),b={required:!0,message:"请输入"},k=n({type:"add"}),w=n({value:"",sort:""});o((()=>{})),i(_,(a=>{if(a){y.value&&y.value.resetFields();let a="add";I.id&&(a="edit"),k.type=a,setTimeout((a=>{for(let e in w)void 0!==I.handlingInfo[e]&&(w[e]=I.handlingInfo[e])}),200)}}));const C=()=>{y.value.validate().then((async a=>{await c.productConfig.attrValue[k.type]({...a,id:I.id||void 0,type_id:"add"===k.type?I.attrId:void 0,attr_id:"add"===k.type?I.attrNameId:void 0}),_.value=!1,v("fresh")})).catch((a=>{console.log(a)}))};return(a,e)=>{const t=m,n=h,o=f,i=g;return d(),l("div",null,[r(i,{visible:u(_),"onUpdate:visible":e[2]||(e[2]=a=>p(_)?_.value=a:null),width:"550px",title:"edit"===u(k).type?"编辑规格值":"添加规格值","mask-closable":!1,onOk:C},{default:s((()=>[r(o,{ref_key:"formRef",ref:y,model:u(w),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:s((()=>[r(n,{name:"value",label:"规格值",rules:[b]},{default:s((()=>[r(t,{value:u(w).value,"onUpdate:value":e[0]||(e[0]=a=>u(w).value=a)},null,8,["value"])])),_:1},8,["rules"]),r(n,{name:"sort",label:"排序"},{default:s((()=>[r(t,{value:u(w).sort,"onUpdate:value":e[1]||(e[1]=a=>u(w).sort=a)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-d7646882"]]),R={key:1},T=a({__name:"AttrValueManage",setup(a){const e=V([["input","value","规格值"],["select","enabled","状态"]]),t=x([["编号","id"],["规格名称","attr_name"],["规格值","value"],["排序","sort"],["状态","enabled"],["操作","operate",140,"right"]]),i=n({handlingId:0,dataSource:[],loading:!1,query:{},pagination:O(),showNewDialog:!1,handlingInfo:{},attrId:"",attrNameId:""});o((()=>{const a=I();i.attrId=String(a.currentRoute.value.params.attrId),i.attrNameId=String(a.currentRoute.value.params.attrNameId),p()}));const p=()=>{i.loading=!0,c.productConfig.attrValue.list({page:i.pagination.current,page_size:i.pagination.pageSize,...i.query,type_id:i.attrId,attr_id:i.attrNameId}).then((a=>{var t;i.loading=!1,i.dataSource=a.data.items,1===i.pagination.current&&(i.pagination.total=+(null==(t=a.data)?void 0:t.count)),q(e,"enabled",a.data.enabled_map)}))},g=a=>{i.pagination={...i.pagination,...a},p()},m=a=>{i.query=a,i.pagination={...i.pagination,current:1},p()};return(a,n)=>{const o=N,h=_("Search"),f=S,v=j,I=y("permission");return d(),l("div",null,[r(h,{"search-options":u(e),onOnSearch:m},{default:s((()=>[b((d(),k(o,{type:"primary",onClick:n[0]||(n[0]=a=>{u(i).handlingId=0,u(i).handlingInfo={},u(i).showNewDialog=!0})},{default:s((()=>[w(" 添加 ")])),_:1})),[[I,[u(c).productConfig.attrValue.add]]])])),_:1},8,["search-options"]),r(v,{"data-source":u(i).dataSource,columns:u(t),scroll:{x:"max-content"},loading:u(i).loading,pagination:u(i).pagination,onChange:g},{bodyCell:s((({column:a,record:e})=>["enabled"===a.key?(d(),k(f,{key:0,checked:e.enabled,"onUpdate:checked":a=>e.enabled=a,"un-checked-value":0,"checked-value":1,onChange:a=>(async a=>{await c.productConfig.attrValue.status({value_id:a.id,enabled:a.enabled}).catch((e=>{a.enabled=1===a.enabled?0:1}))})(e)},null,8,["checked","onUpdate:checked","onChange"])):C("",!0),"operate"===a.key?(d(),l("div",R,[b((d(),k(o,{type:"link",onClick:a=>(a=>{i.handlingId=a.id,i.handlingInfo=a,i.showNewDialog=!0})(e)},{default:s((()=>[w(" 编辑 ")])),_:2},1032,["onClick"])),[[I,[u(c).productConfig.attrValue.edit]]]),b((d(),k(o,{type:"link",class:"danger-color",onClick:a=>{return t=e.id,void U.confirm({title:"提示",content:"确认删除该规格值？",okText:"确认",cancelText:"取消",onOk:()=>{c.productConfig.attrValue.delete({id:t}).then((a=>{p()}))}});var t}},{default:s((()=>[w(" 删除 ")])),_:2},1032,["onClick"])),[[I,[u(c).productConfig.attrValue.delete]]])])):C("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),r(D,{id:u(i).handlingId,show:u(i).showNewDialog,"onUpdate:show":n[1]||(n[1]=a=>u(i).showNewDialog=a),"attr-id":u(i).attrId,"attr-name-id":u(i).attrNameId,"handling-info":u(i).handlingInfo,onFresh:p},null,8,["id","show","attr-id","attr-name-id","handling-info"])])}}});export{T as default};
