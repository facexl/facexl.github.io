import{_ as e}from"./SetLinkDialog-fe061a29.js";import{d as a,a0 as l,u as o,h as i,r as t,m as n,o as u,l as s,$ as d,G as m,a as p,b as r,e as _,w as v,f as c,E as f,F as g,n as y,p as h,q as b,z as k,g as w,s as j,Z as x,I as U,A as C,B as D,V as M,W as Y,X as O,_ as V}from"./index-c2ae2a0e.js";import{u as H,_ as L}from"./useTableColumns-dd067b4d.js";import{R as B,_ as q}from"./index-c8577ae4.js";import{C as R}from"./index-3f0a4d2e.js";import{_ as S}from"./index-8036da2a.js";import{_ as T}from"./Upload-053b6740.js";import{p as F,a as I}from"./useRequest-34a5e624.js";import{_ as J}from"./tool-d986b095.js";import"./usePagination-c05046ed.js";import"./FolderOpenOutlined-fa174baf.js";import"./RadioButton-bc4165ed.js";import"./index-b1df7cdb.js";import"./index-00d344de.js";import"./DeleteOutlined-1e1ff134.js";const N={style:{"padding-top":"40px"}},A=V(a({__name:"DialogManageAdd",emits:["fresh"],setup(a,{emit:V}){const A=l("enums"),E=o(),G=i(),z=t(),P={required:!0,message:"请输入"},W=G.params.id,X=n({loading:!1,submitLoading:!1,linkVisible:!1,coupon_ids:[],coupons:[]}),Z=n({name:void 0,platform:void 0,show_position:void 0,status:void 0,show_type:void 0,link_desc:void 0,link_type:void 0,link_params:void 0,receive_value:void 0,receive_type:void 0,feature:void 0,show_img:void 0,time:void 0,coupon:[]}),$=H([["优惠券编号","coupon_id"],["优惠券名称","name"],["优惠券数量","num"],["操作","operate",180,"right"]]);u((async()=>{X.coupons=await F(I),W&&Q()})),s((()=>X.coupon_ids),(e=>{if(e&&e.length>0){const a=X.coupons.filter((a=>e.includes(a.id))),l=[];a.forEach((e=>{const a=Z.coupon.find((a=>a.coupon_id===e.id));a?l.push({...e,...a}):(e.num="1",l.push({...e,coupon_id:e.id}))})),Z.coupon=JSON.parse(JSON.stringify(l))}else Z.coupon=[]})),s((()=>Z.use_time_type),(()=>{!0!==X.loading&&(z.value.clearValidate(["use_begin_day","use_end_day","useTime"]),Z.use_begin_day=void 0,Z.use_end_day=void 0,Z.useTime=void 0)})),s((()=>Z.is_limit_money),(()=>{!0!==X.loading&&(Z.limit_money=void 0,z.value.clearValidate(["limit_money"]))})),s((()=>Z.send_type),(()=>{!0!==X.loading&&(Z.coupon_type=void 0)}));const K=e=>{Z.link_type=e.link_type,Z.link_params=e.link_params,Z.link_desc=e.link_desc},Q=async()=>{X.loading=!0;const{data:e}=await d.act.dialogManage.detail({id:W});for(let a in Z)"time"===a?e.show_start&&e.show_end&&(Z[a]=[e.show_start,e.show_end]):Z[a]="receive_value"===a||"feature"===a||"platform"===a?e[a]?e[a].split(",").map((e=>+e)):[]:e[a];e.coupon&&(Z.coupon=e.coupon,X.coupon_ids=e.coupon.map((e=>e.coupon_id))),setTimeout((e=>{X.loading=!1}),200)},ee=()=>{z.value.validate().then((async e=>{try{if(e.time&&e.time.length&&(e.show_start=e.time[0],e.show_end=e.time[1]),e.platform=e.platform.join(","),e.receive_value=e.receive_value.join(","),e.feature=e.feature?e.feature.join(","):"",delete e.time,Z.coupon.length){for(let e=0;e<Z.coupon.length;e++)if(!+Z.coupon[e].num)return x.error("请填写优惠券数量！");e.coupon=JSON.stringify(Z.coupon.map((e=>({coupon_id:e.coupon_id,num:e.num}))))}else e.coupon="";X.submitLoading=!0,await d.act.dialogManage[W?"edit":"add"]({...e,id:W||void 0,receive_type:1}),X.submitLoading=!1,E.push({name:"dialogManage"}),V("fresh")}catch(a){console.log(a),X.submitLoading=!1}})).catch((e=>{console.log(e)}))};return(a,l)=>{const o=U,i=C,t=R,n=J,u=T,s=B,d=q,x=D,V=M,H=Y,F=S,I=L,E=O,G=f,W=m("FixBottomBar"),Q=e;return p(),r("div",N,[_(G,{ref_key:"formRef",ref:z,model:c(Z),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:v((()=>[_(i,{name:"name",label:"弹窗名称",rules:P},{default:v((()=>[_(o,{value:c(Z).name,"onUpdate:value":l[0]||(l[0]=e=>c(Z).name=e),maxlength:20,placeholder:"请输入弹窗名称",style:{width:"500px"}},null,8,["value"])])),_:1}),_(i,{name:"platform",label:"接收终端",rules:P},{default:v((()=>[_(n,{value:c(Z).platform,"onUpdate:value":l[1]||(l[1]=e=>c(Z).platform=e)},{default:v((()=>[(p(!0),r(g,null,y(c(A).goods_platform,(e=>(p(),h(t,{key:e.value,value:e.value},{default:v((()=>[b(k(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),_(i,{name:"receive_value",label:"接收对象",rules:P},{default:v((()=>[_(n,{value:c(Z).receive_value,"onUpdate:value":l[2]||(l[2]=e=>c(Z).receive_value=e)},{default:v((()=>[(p(!0),r(g,null,y(c(A).member_type,(e=>(p(),h(t,{key:e.value,value:e.value},{default:v((()=>[b(k(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),_(i,{name:"feature",label:"用户特征"},{default:v((()=>[_(n,{value:c(Z).feature,"onUpdate:value":l[3]||(l[3]=e=>c(Z).feature=e)},{default:v((()=>[_(t,{value:1},{default:v((()=>[b(" 新用户 ")])),_:1}),_(t,{value:2},{default:v((()=>[b(" 未下单 ")])),_:1})])),_:1},8,["value"])])),_:1}),_(i,{name:"show_img",label:"弹窗内容",rules:P},{default:v((()=>[_(u,{filelist:c(Z).show_img,"onUpdate:filelist":l[4]||(l[4]=e=>c(Z).show_img=e),class:"long_img",limit:.5},null,8,["filelist"])])),_:1}),_(i,{name:"show_position",label:"弹窗位置",rules:P},{default:v((()=>[_(d,{value:c(Z).show_position,"onUpdate:value":l[5]||(l[5]=e=>c(Z).show_position=e)},{default:v((()=>[_(s,{value:1},{default:v((()=>[b(" 首页 ")])),_:1}),_(s,{value:3},{default:v((()=>[b(" 店铺 ")])),_:1}),_(s,{value:4},{default:v((()=>[b(" 个人中心 ")])),_:1})])),_:1},8,["value"])])),_:1}),_(i,{label:"弹窗跳转",name:"link_type"},{default:v((()=>[_(x,{onClick:l[6]||(l[6]=e=>c(X).linkVisible=!0)},{default:v((()=>[b(" 设置跳转链接 ")])),_:1}),w("div",null,k(c(Z).link_desc),1),_(i,{label:"",name:"link_params",style:{display:"none"}}),_(i,{label:"",name:"link_desc",style:{display:"none"}})])),_:1}),_(i,{label:"送优惠券"},{default:v((()=>[_(H,{value:c(X).coupon_ids,"onUpdate:value":l[7]||(l[7]=e=>c(X).coupon_ids=e),placeholder:"请选择",mode:"multiple"},{default:v((()=>[(p(!0),r(g,null,y(c(X).coupons,(e=>(p(),h(V,{key:e.id,value:e.id},{default:v((()=>[b(k(e.name)+"--id:"+k(e.id),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),c(Z).coupon.length?(p(),h(i,{key:0,label:" ",colon:!1},{default:v((()=>[_(I,{"data-source":c(Z).coupon,columns:c($),scroll:{x:"max-content"},loading:c(X).loading,pagination:!1},{bodyCell:v((({column:e,record:a})=>["num"===e.key?(p(),h(F,{key:0,value:a.num,"onUpdate:value":e=>a.num=e,placeholder:"请输入",min:0,precision:0},null,8,["value","onUpdate:value"])):j("",!0),"operate"===e.key?(p(),h(x,{key:1,type:"link",danger:"",onClick:e=>{return l=a.coupon_id,void(X.coupon_ids=X.coupon_ids.filter((e=>e!==l)));var l}},{default:v((()=>[b(" 删除 ")])),_:2},1032,["onClick"])):j("",!0)])),_:1},8,["data-source","columns","loading"])])),_:1})):j("",!0),_(i,{label:"弹窗时段",name:"time",rules:P},{default:v((()=>[_(E,{value:c(Z).time,"onUpdate:value":l[8]||(l[8]=e=>c(Z).time=e),"show-time":{format:"HH:mm:ss"},"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1}),_(i,{name:"show_type",label:"弹窗频率",rules:P},{default:v((()=>[_(d,{value:c(Z).show_type,"onUpdate:value":l[9]||(l[9]=e=>c(Z).show_type=e)},{default:v((()=>[_(s,{value:1},{default:v((()=>[b(" 仅一次 ")])),_:1}),_(s,{value:2},{default:v((()=>[b(" 每日一次 ")])),_:1})])),_:1},8,["value"])])),_:1}),_(i,{name:"status",label:"是否开启",rules:P},{default:v((()=>[_(d,{value:c(Z).status,"onUpdate:value":l[10]||(l[10]=e=>c(Z).status=e)},{default:v((()=>[_(s,{value:10},{default:v((()=>[b(" 开启 ")])),_:1}),_(s,{value:0},{default:v((()=>[b(" 关闭 ")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"]),_(W,null,{default:v((()=>[_(x,{type:"primary",loading:c(X).submitLoading,onClick:ee},{default:v((()=>[b(" 提交 ")])),_:1},8,["loading"])])),_:1}),_(Q,{show:c(X).linkVisible,"onUpdate:show":l[11]||(l[11]=e=>c(X).linkVisible=e),"form-data":c(Z),onOnChange:K},null,8,["show","form-data"])])}}}),[["__scopeId","data-v-53e30a1e"]]);export{A as default};
