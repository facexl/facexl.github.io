import{d as e,i as a,r as o,m as n,o as t,l as i,a as l,b as d,e as s,w as r,f as c,k as u,$ as p,M as h,p as g,s as m,I as v,A as f,E as w,_ as k,G as b,H as _,x as y,q as x,B as j}from"./index-c2ae2a0e.js";import{u as N,_ as I}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as C}from"./index-ef11d20c.js";import{u as S,a as U}from"./useSearchItems-c7d75cf3.js";import{u as D}from"./usePagination-c05046ed.js";import{_ as q}from"./index-f5618084.js";import{d as O}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";import"./Upload-053b6740.js";import"./index-b1df7cdb.js";import"./index-00d344de.js";import"./DeleteOutlined-1e1ff134.js";const B=k(e({__name:"NewNotice",props:{show:Boolean,id:Number},emits:["fresh"],setup(e,{emit:k}){const b=e,_=a(b,"show",k),y=o(),x={required:!0,message:"请输入"},j=n({loading:!1}),N=n({title:void 0,content:void 0,tag:void 0});t((()=>{})),i(_,(e=>{e&&(y.value&&y.value.resetFields(),b.id&&(j.loading=!0,p.act.shopNotice.detail({id:b.id}).then((e=>{for(let a in N)void 0!==e.data[a]&&(N[a]=e.data[a]);setTimeout((e=>{j.loading=!1}),50)}))))}));const I=()=>{y.value.validate().then((async e=>{await p.act.shopNotice[b.id?"edit":"add"]({...e,id:b.id||void 0}),_.value=!1,k("fresh")})).catch((e=>{console.log(e)}))};return(a,o)=>{const n=v,t=f,i=q,p=w,k=h;return l(),d("div",null,[s(k,{visible:c(_),"onUpdate:visible":o[3]||(o[3]=e=>u(_)?_.value=e:null),width:"1100px",title:e.id?"编辑搜索词":"添加搜索词","mask-closable":!1,onOk:I},{default:r((()=>[s(p,{ref_key:"formRef",ref:y,model:c(N),autocomplete:"off","label-col":{span:3},"wrapper-col":{span:19}},{default:r((()=>[s(t,{name:"title",label:"菜单标题",rules:[x]},{default:r((()=>[s(n,{value:c(N).title,"onUpdate:value":o[0]||(o[0]=e=>c(N).title=e),placeholder:"请输入菜单标题",maxlength:4,"show-count":""},null,8,["value"])])),_:1},8,["rules"]),s(t,{name:"content",label:"内容",rules:[x]},{default:r((()=>[c(_)?(l(),g(i,{key:0,value:c(N).content,"onUpdate:value":o[1]||(o[1]=e=>c(N).content=e)},null,8,["value"])):m("",!0)])),_:1},8,["rules"]),s(t,{name:"tag",label:"菜单角标"},{default:r((()=>[s(n,{value:c(N).tag,"onUpdate:value":o[2]||(o[2]=e=>c(N).tag=e),placeholder:"请输入菜单角标",maxlength:4,"show-count":""},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-b8825bac"]]),R={key:1},T=e({__name:"ShopNotice",setup(e){const a=S([]),o=N([["ID","id"],["菜单标题","title"],["开关","enabled"],["创建时间","created_at"],["操作","operate",200,"right"]]),i=n({handlingId:0,dataSource:[],loading:!1,query:{},pagination:D(),showNewDialog:!1,handlingInfo:{},selectedRowKeys:[],selectBtn:void 0});t((()=>{u()}));const u=()=>{i.loading=!0,p.act.shopNotice.list({page:i.pagination.current,page_size:i.pagination.pageSize,...i.query}).then((e=>{var o;i.loading=!1,i.dataSource=e.data.items,1===i.pagination.current&&(i.pagination.total=+(null==(o=e.data)?void 0:o.count)),U(a,"enabled",e.data.enabled_map),i.selectedRowKeys=[]}))},h=e=>{i.pagination={...i.pagination,...e},u()},v=e=>{i.query=e,i.pagination={...i.pagination,current:1},u()};return(e,n)=>{const t=j,f=b("Search"),w=C,k=I,N=_("permission");return l(),d("div",null,[s(f,{"search-options":c(a),onOnSearch:v},{default:r((()=>[y((l(),g(t,{type:"primary",onClick:n[0]||(n[0]=e=>{c(i).handlingId=0,c(i).handlingInfo={},c(i).showNewDialog=!0})},{default:r((()=>[x(" 新建 ")])),_:1})),[[N,[c(p).act.shopNotice.add]]])])),_:1},8,["search-options"]),s(k,{"data-source":c(i).dataSource,columns:c(o),scroll:{x:"max-content"},loading:c(i).loading,pagination:c(i).pagination,"row-key":"id",onChange:h},{bodyCell:r((({column:e,record:a})=>["enabled"===e.key?(l(),g(w,{key:0,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await p.act.shopNotice.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1})),u()})(a)},null,8,["checked","onUpdate:checked","onChange"])):m("",!0),"operate"===e.key?(l(),d("div",R,[s(t,{type:"link",onClick:e=>{c(i).handlingId=a.id,c(i).handlingInfo=a,c(i).showNewDialog=!0}},{default:r((()=>[x(" 编辑 ")])),_:2},1032,["onClick"]),s(t,{type:"link",class:"danger-color",onClick:e=>{return o=a.id,void O.confirm({title:"提示",content:"确认删除？",okText:"确认",cancelText:"取消",onOk:()=>{p.act.shopNotice.del({id:o+""}).then((e=>{u()}))}});var o}},{default:r((()=>[x(" 删除 ")])),_:2},1032,["onClick"])])):m("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),s(B,{id:c(i).handlingId,show:c(i).showNewDialog,"onUpdate:show":n[1]||(n[1]=e=>c(i).showNewDialog=e),"handling-info":c(i).handlingInfo,onFresh:u},null,8,["id","show","handling-info"])])}}});export{T as default};
