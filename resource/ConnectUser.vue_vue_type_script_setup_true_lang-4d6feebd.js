import{d as e,m as s,l as o,o as a,$ as i,G as n,a as t,b as l,e as d,w as r,g as c,f as p,q as u,B as m,D as g,_ as h,F as w,n as y,p as b,z as v,K as S,s as _,c8 as f}from"./index-c2ae2a0e.js";import{_ as x}from"./index-975d3375.js";import{u as R,_ as C}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as j,a as k}from"./useSearchItems-c7d75cf3.js";import{u as K}from"./usePagination-c05046ed.js";const q=h(e({__name:"ConnectUserTable",props:{choosed:Array,show:Boolean},emits:["submit","update:show"],setup(e,{emit:h}){var w;const y=e,b=j([["input","uid","用户ID"],["select","type","用户类型"]]),v=R([["用户ID","id"],["用户名称","username"],["所属桔掌柜","store_name"],["用户类型","type_name"],["注册时间","created_at",180]]),S=s({visible:!0,dataSource:[],loading:!1,query:{},pagination:K(),originSelectedRows:[],handlingSelectedRowKeys:[]});o((()=>S.visible),(e=>{h("update:show",e)})),S.originSelectedRows=null==(w=y.choosed)?void 0:w.slice(0),a((()=>{_()}));const _=()=>{S.originSelectedRows=f(),S.loading=!0,i.user.userList({page:S.pagination.current,page_size:S.pagination.pageSize,...S.query}).then((e=>{var s;S.loading=!1,S.dataSource=e.data.items,1===S.pagination.current&&(S.pagination.total=+(null==(s=e.data)?void 0:s.count)),k(b,"type",e.data.type_map),q()}))},f=()=>{const e=[];return S.dataSource.forEach((s=>{S.handlingSelectedRowKeys.includes(s.id)&&e.push(s)})),S.originSelectedRows.concat(e)},q=()=>{const e=S.dataSource.map((e=>e.id)),s=[];S.originSelectedRows=S.originSelectedRows.filter((o=>!e.includes(o.id)||(s.push(o.id),!1))),S.handlingSelectedRowKeys=s},I=()=>{h("submit",f()),S.visible=!1},U=e=>{S.pagination={...S.pagination,...e},_()},z=e=>{S.query=e,S.pagination={...S.pagination,current:1},_()};return(e,s)=>{const o=n("Search"),a=C,i=m,h=g,w=x;return t(),l("div",null,[d(w,{visible:p(S).visible,"onUpdate:visible":s[1]||(s[1]=e=>p(S).visible=e),title:"选择用户",placement:"right",width:"50%"},{default:r((()=>[c("div",null,[d(o,{"search-options":p(b),onOnSearch:z},null,8,["search-options"]),d(a,{"row-key":"id","data-source":p(S).dataSource,columns:p(v),scroll:{x:"max-content"},loading:p(S).loading,"row-selection":{selectedRowKeys:p(S).handlingSelectedRowKeys,onChange(e){p(S).handlingSelectedRowKeys=e}},pagination:p(S).pagination,onChange:U},null,8,["data-source","columns","loading","row-selection","pagination"]),d(h,{class:"flex-center drawer-btns"},{default:r((()=>[d(i,{type:"primary",class:"mr16px",onClick:I},{default:r((()=>[u(" 确定 ")])),_:1}),d(i,{type:"default",onClick:s[0]||(s[0]=e=>p(S).visible=!1)},{default:r((()=>[u(" 取消 ")])),_:1})])),_:1})])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-6e7aec4b"]]),I={key:0,class:"mt8px"},U=c("span",{class:"mr8px"},"已选择:",-1),z=e({__name:"ConnectUser",props:{uids:String,showName:{type:String,default:"username"}},emits:["update:uids"],setup(e,{expose:i,emit:n}){const c=e,g=s({visible:!1,choosed:[]});a((()=>{c.uids&&(g.choosed=c.uids.split(",").map((e=>({id:+e}))))})),o((()=>g.choosed),(e=>{n("update:uids",e.map((e=>e.id)).join(","))}),{deep:!0});i({getRes:()=>({ids:g.choosed.map((e=>e.id)),choosed:g.choosed})});const h=()=>{g.visible=!0},x=e=>{g.choosed=e};return(s,o)=>{const a=m,i=f,n=q;return t(),l("div",null,[d(a,{type:"primary",onClick:h},{default:r((()=>[u(" 选择用户 ")])),_:1}),p(g).choosed.length?(t(),l("div",I,[U,(t(!0),l(w,null,y(p(g).choosed,((s,o)=>(t(),b(i,{key:s.id,closable:"",color:"green",style:{"margin-bottom":"8px"},onClose:S((e=>(e=>{g.choosed.splice(e,1)})(o)),["prevent"])},{default:r((()=>[u(v(s[e.showName]||s.id),1)])),_:2},1032,["onClose"])))),128))])):_("",!0),p(g).visible?(t(),b(n,{key:1,show:p(g).visible,"onUpdate:show":o[0]||(o[0]=e=>p(g).visible=e),choosed:p(g).choosed,onSubmit:x},null,8,["show","choosed"])):_("",!0)])}}});export{z as _};
