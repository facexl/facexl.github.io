import{d as a,i as e,r as n,m as t,o,l as i,a as l,b as d,e as s,w as r,f as u,k as p,$ as c,M as g,p as m,s as h,I as f,A as k,E as y,_ as v,G as w,H as b,x as C,q as _,B as I}from"./index-c2ae2a0e.js";import{u as x,_ as j}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as N}from"./index-ef11d20c.js";import{u as S,a as q}from"./useSearchItems-c7d75cf3.js";import{u as D}from"./usePagination-c05046ed.js";import{d as O}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const U=v(a({__name:"NewAttr",props:{show:Boolean,id:Number,handlingInfo:{type:Object,default:()=>{}}},emits:["fresh"],setup(a,{emit:v}){const w=a,b=e(w,"show",v),C=n(),_={required:!0,message:"请输入"},I=t({type:"add"}),x=t({name:"",sort:""});o((()=>{})),i(b,(a=>{if(a){C.value&&C.value.resetFields();let a="add";w.id&&(a=w.handlingInfo.id?"edit":"copy"),I.type=a,setTimeout((a=>{for(let e in x)void 0!==w.handlingInfo[e]&&(x[e]=w.handlingInfo[e])}),200)}}));const j=()=>{C.value.validate().then((async a=>{await c.productConfig.attr[I.type]({...a,id:w.id||void 0}),b.value=!1,v("fresh")})).catch((a=>{console.log(a)}))};return(a,e)=>{const n=f,t=k,o=y,i=g;return l(),d("div",null,[s(i,{visible:u(b),"onUpdate:visible":e[2]||(e[2]=a=>p(b)?b.value=a:null),width:"550px",title:"edit"===u(I).type?"编辑规格":"add"===u(I).type?"添加规格":"复制规格","mask-closable":!1,onOk:j},{default:r((()=>[s(o,{ref_key:"formRef",ref:C,model:u(x),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:14}},{default:r((()=>[s(t,{name:"name",label:"规格类目",rules:[_]},{default:r((()=>[s(n,{value:u(x).name,"onUpdate:value":e[0]||(e[0]=a=>u(x).name=a)},null,8,["value"])])),_:1},8,["rules"]),"copy"!==u(I).type?(l(),m(t,{key:0,name:"sort",label:"排序"},{default:r((()=>[s(n,{value:u(x).sort,"onUpdate:value":e[1]||(e[1]=a=>u(x).sort=a)},null,8,["value"])])),_:1})):h("",!0)])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-73065570"]]),T={key:1},A=a({__name:"AttrManage",setup(a){const e=S([["input","keywords","规格类目"],["select","enabled","状态"]]),n=x([["编号","id",120],["规格类目","name",150],["规格名称","attr"],["排序","sort",120],["状态","enabled",120],["操作","operate",220,"right"]]),i=t({handlingId:0,dataSource:[],loading:!1,query:{},pagination:D(),showNewDialog:!1,handlingInfo:{}});o((()=>{p()}));const p=()=>{i.loading=!0,c.productConfig.attr.list({page:i.pagination.current,page_size:i.pagination.pageSize,...i.query}).then((a=>{var n;i.loading=!1,i.dataSource=a.data.items,1===i.pagination.current&&(i.pagination.total=+(null==(n=a.data)?void 0:n.count)),q(e,"enabled",a.data.enabled_map)}))},g=a=>{i.pagination={...i.pagination,...a},p()},f=a=>{i.query=a,i.pagination={...i.pagination,current:1},p()};return(a,t)=>{const o=I,k=w("Search"),y=N,v=j,x=b("permission");return l(),d("div",null,[s(k,{"search-options":u(e),onOnSearch:f},{default:r((()=>[C((l(),m(o,{type:"primary",onClick:t[0]||(t[0]=a=>{u(i).handlingId=0,u(i).handlingInfo={},u(i).showNewDialog=!0})},{default:r((()=>[_(" 添加 ")])),_:1})),[[x,[u(c).productConfig.attr.add]]])])),_:1},8,["search-options"]),s(v,{"data-source":u(i).dataSource,columns:u(n),scroll:{x:"max-content"},loading:u(i).loading,pagination:u(i).pagination,onChange:g},{bodyCell:r((({column:e,record:n})=>["enabled"===e.key?(l(),m(y,{key:0,checked:n.enabled,"onUpdate:checked":a=>n.enabled=a,"un-checked-value":0,"checked-value":1,onChange:a=>(async a=>{await c.productConfig.attr.status({id:a.id,enabled:a.enabled}).catch((e=>{a.enabled=1===a.enabled?0:1}))})(n)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===e.key?(l(),d("div",T,[C((l(),m(o,{type:"link",onClick:e=>a.$router.push({name:"attrNameManage",params:{attrId:n.id}})},{default:r((()=>[_(" 规格 ")])),_:2},1032,["onClick"])),[[x,[u(c).productConfig.attrName.list]]]),C((l(),m(o,{type:"link",onClick:a=>{u(i).handlingId=n.id,u(i).handlingInfo={},u(i).showNewDialog=!0}},{default:r((()=>[_(" 复制 ")])),_:2},1032,["onClick"])),[[x,[u(c).productConfig.attr.copy]]]),C((l(),m(o,{type:"link",onClick:a=>{u(i).handlingId=n.id,u(i).handlingInfo=n,u(i).showNewDialog=!0}},{default:r((()=>[_(" 编辑 ")])),_:2},1032,["onClick"])),[[x,[u(c).productConfig.attr.edit]]]),C((l(),m(o,{type:"link",class:"danger-color",onClick:a=>{return e=n.id,void O.confirm({title:"提示",content:"确认删除该规格？",okText:"确认",cancelText:"取消",onOk:()=>{c.productConfig.attr.delete({id:e}).then((a=>{p()}))}});var e}},{default:r((()=>[_(" 删除 ")])),_:2},1032,["onClick"])),[[x,[u(c).productConfig.attr.delete]]])])):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),s(U,{id:u(i).handlingId,show:u(i).showNewDialog,"onUpdate:show":t[1]||(t[1]=a=>u(i).showNewDialog=a),"handling-info":u(i).handlingInfo,onFresh:p},null,8,["id","show","handling-info"])])}}});export{A as default};
