import{d as a,a0 as t,i as e,l as n,m as o,o as i,G as s,H as r,a as d,p as l,w as u,f as c,k as p,e as g,x as m,$ as _,s as h,u as y,b as k,q as w,z as x,F as f,B as v,_ as C}from"./index-c2ae2a0e.js";import{u as S,_ as b}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as j}from"./index-ef11d20c.js";import{u as q}from"./useSearchItems-c7d75cf3.js";import{u as M}from"./usePagination-c05046ed.js";import{d as D}from"./index-a09a23de.js";import{_ as I}from"./index-975d3375.js";import{_ as z}from"./index-00d344de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const O=a({__name:"DialogManageSta",props:{show:Boolean,id:String},emits:[],setup(a,{emit:y}){const k=a,w=t("enums"),x=e(k,"show",y),f=q([["input","uid","用户ID"],["input","username","用户名"],["input","phone","手机号"],["select","type","等级",w.value.member_type]]);n(x,(a=>{a&&j()}));const v=S([["用户ID","uid"],["用户名","username"],["手机号","phone"],["等级","type_name"],["苹果APP查看时间","ios_at"],["安卓APP查看时间","android_at"],["小程序查看时间","mp_at"],["公众号查看时间","wechat_at"]]),C=o({dataSource:[],loading:!1,pagination:M(),query:{}});i((()=>{}));const j=()=>{C.loading=!0,_.act.dialogManage.staList({page:C.pagination.current,page_size:C.pagination.pageSize,...C.query,popup_id:k.id}).then((a=>{var t;C.loading=!1,C.dataSource=a.data.items,1===C.pagination.current&&(C.pagination.total=+(null==(t=a.data)?void 0:t.count))}))},D=a=>{C.pagination={...C.pagination,...a},j()},O=a=>{C.query=a,C.pagination={...C.pagination,current:1},j()};return(a,t)=>{const e=s("Export"),n=s("Search"),o=z,i=b,y=I,w=r("permission");return d(),l(y,{visible:c(x),"onUpdate:visible":t[0]||(t[0]=a=>p(x)?x.value=a:null),title:"弹窗统计",placement:"right",width:"80%"},{default:u((()=>[g(n,{"search-options":c(f),onOnSearch:O},{default:u((()=>[m(g(e,{api:c(_).act.dialogManage.staExport,query:{...c(C).query,popup_id:k.id}},null,8,["api","query"]),[[w,[c(_).act.dialogManage.staExport]]])])),_:1},8,["search-options"]),g(i,{"row-key":"id","data-source":c(C).dataSource,columns:c(v),scroll:{x:"max-content"},loading:c(C).loading,pagination:c(C).pagination,onChange:D},{bodyCell:u((({column:a,record:t})=>["useravatar"===a.key?(d(),l(o,{key:0,width:50,src:t.useravatar},null,8,["src"])):h("",!0),"goods_thumb"===a.key?(d(),l(o,{key:1,width:50,src:t.goods_thumb},null,8,["src"])):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])),_:1},8,["visible"])}}}),P={class:"coupon-record"},B=C(a({__name:"DialogManage",setup(a){y();const t=q([["input","name","弹窗名称"],["dateRange","create_start_time-create_end_time",["创建时间开始","创建时间结束"]],["dateRange","edit_start_time-edit_end_time",["编辑时间开始","编辑时间结束"]]]),e=S([["弹窗名称","name"],["弹窗位置","position_name"],["弹窗时段","show_start"],["弹窗统计","number_times"],["启用/禁用","status"],["创建时间","created_at"],["编辑时间","updated_at"],["操作","operate",140,"right"]]),n=o({activeName:"Coupon",loading:!1,pagination:M(),query:{},dataSource:[],handlingId:"",showDetail:!1});i((()=>{p()}));const p=async()=>{try{n.loading=!0;const{data:a}=await _.act.dialogManage.list({...n.query,page:n.pagination.current,page_size:n.pagination.pageSize});1===n.pagination.current&&(n.pagination.total=+(null==a?void 0:a.count)),n.dataSource=a.items,n.loading=!1}catch(a){n.loading=!1}},C=a=>{n.pagination={...n.pagination,...a},p()},I=a=>{n.query=a,n.pagination={...n.pagination,current:1},p()};return(a,o)=>{const i=v,y=s("Search"),S=j,q=b,M=r("permission");return d(),k("div",P,[g(y,{"search-options":c(t),onOnSearch:I},{default:u((()=>[g(i,{type:"primary",plain:"",onClick:o[0]||(o[0]=t=>a.$router.push({name:"dialogManageAdd"}))},{default:u((()=>[w(" 添加 ")])),_:1})])),_:1},8,["search-options"]),g(q,{"row-key":"order_id","data-source":c(n).dataSource,columns:c(e),scroll:{x:"max-content"},loading:c(n).loading,pagination:c(n).pagination,onChange:C},{bodyCell:u((({column:t,record:e})=>["number_times"===t.key?m((d(),l(i,{key:0,type:"link",onClick:a=>{c(n).handlingId=e.id,c(n).showDetail=!0}},{default:u((()=>[w(x(e.number_times),1)])),_:2},1032,["onClick"])),[[M,[c(_).order.orderList.detail]]]):h("",!0),"show_start"===t.key?(d(),k(f,{key:1},[w(x(e.show_start)+" - "+x(e.show_end),1)],64)):h("",!0),"status"===t.key?(d(),l(S,{key:2,checked:e.status,"onUpdate:checked":a=>e.status=a,"un-checked-value":0,"checked-value":10,onChange:a=>(async a=>{await _.act.dialogManage.status({id:a.id,status:a.status}).catch((t=>{a.status=10===a.status?0:10})),p()})(e)},null,8,["checked","onUpdate:checked","onChange"])):h("",!0),"operate"===t.key?(d(),k(f,{key:3},[g(i,{type:"link",onClick:t=>a.$router.push({name:"dialogManageEdit",params:{id:e.id}})},{default:u((()=>[w(" 编辑 ")])),_:2},1032,["onClick"]),g(i,{type:"link",class:"danger-color",onClick:a=>{return t=e.id,void D.confirm({title:"提示",content:"确认删除？删除后相当于用户没有领取该优惠券，可以重新领取",okText:"确认",cancelText:"取消",onOk:async()=>{await _.act.dialogManage.del({id:t}),p()}});var t}},{default:u((()=>[w(" 删除 ")])),_:2},1032,["onClick"])],64)):h("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),g(O,{id:c(n).handlingId,show:c(n).showDetail,"onUpdate:show":o[1]||(o[1]=a=>c(n).showDetail=a)},null,8,["id","show"])])}}}),[["__scopeId","data-v-3da88d0e"]]);export{B as default};
