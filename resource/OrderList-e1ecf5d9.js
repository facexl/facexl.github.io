import{d as e,a0 as a,r as t,i as s,l,m as o,a as i,b as n,e as r,w as d,f as u,k as c,Z as p,$ as _,M as m,p as y,s as g,F as f,n as h,q as v,z as k,g as b,A as w,C as R,D as x,V as C,W as j,a7 as I,E as O,S,o as D,G as U,H as K,T as q,x as T,y as B,v as L,B as F,I as V}from"./index-c2ae2a0e.js";import{u as $,_ as E}from"./useTableColumns-dd067b4d.js";import{R as z,_ as A}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as G,a as J}from"./useSearchItems-c7d75cf3.js";import{u as N}from"./usePagination-c05046ed.js";import{_ as H}from"./RemarkOrder.vue_vue_type_script_setup_true_lang-d3464674.js";import{_ as M}from"./UploadVideo-3da04ded.js";import{_ as P}from"./Upload-053b6740.js";import{_ as W}from"./index-8036da2a.js";import{_ as Z}from"./index-00d344de.js";import{d as Q}from"./dtool-b3945d0c.js";import{c as X}from"./useRequest-34a5e624.js";import{d as Y}from"./index-a09a23de.js";import{_ as ee}from"./Transport.vue_vue_type_script_setup_true_lang-724b9997.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";import"./index-b1df7cdb.js";import"./DeleteOutlined-1e1ff134.js";import"./index-923a8554.js";const ae=b("p",{class:"ant-required"}," 请选择需要处理的商品 ",-1),te=b("div",{class:"tips"}," 最多可以上传5个凭证 ",-1),se=e({__name:"CreateAfterSale",props:{type:{type:String,default:""},show:Boolean,order_id:Number},emits:["fresh"],setup(e,{emit:b}){const D=e,U=a("enums"),K=t(),q=s(D,"show",b,!1),T=X(),B=$([["商品ID","goods_id"],["商品图片","sku_thumb"],["商品名称","goods_title",150],["商品规格","sku_name",150],["商品价格","price"],["七天无理由退换","is_no_reason_name"],["可售后数量","can_return_nums"],["售后数量","apply_nums",180]]);l(q,(async e=>{e&&(K.value&&K.value.resetFields(),F.imgs=[],F.video=[],F.is_confirm=0,D.type?F.type=D.type:F.type="",V())}));const L=o({loading:!1,selectedRowKeys:[],dataSource:[]}),F=o({type:"",reason_id:void 0,description:"",media:[],return_sku_items:[],is_confirm:0,imgs:[],video:[]}),V=async()=>{const e=await _.afterSale.sale.canApplyGoods({order_id:D.order_id});e.data.items.forEach((e=>{e.apply_nums=""})),L.dataSource=e.data.items},G=()=>{K.value.validate().then((async e=>{const a={...F,order_id:D.order_id};a.media=a.imgs.map((e=>({src:e.url,type:"image"}))).concat(a.video.map((e=>({src:e.url,type:"video"})))),delete a.imgs,delete a.video;const t=L.dataSource.filter((e=>L.selectedRowKeys.includes(e.id)));if(!t.length)return void p.error("请选择商品");for(let i=0;i<t.length;i++)if(!t[i].apply_nums)return void p.error("请输入商品售后数量");a.return_sku_items=t.map((e=>({id:e.id,apply_nums:e.apply_nums})));const s=Q(a).toJSON(["media","return_sku_items"]).end(),l=()=>{p.success("创建成功"),L.loading=!1,q.value=!1,b("fresh")};try{L.loading=!0;const e=await _.afterSale.sale.create(s,{success:!1});1===e.data.is_need_confirm?Y.confirm({title:"提示",content:e.data.msg,okText:"确认",cancelText:"取消",async onOk(){s.is_confirm=1,await _.afterSale.sale.create(s),l()},onCancel(){L.loading=!1}}):l()}catch(o){L.loading=!1}}))};return(e,a)=>{const t=Z,s=W,l=E,o=z,p=A,_=w,b=R,V=x,$=C,J=j,N=I,H=P,Q=M,X=O,Y=S,ee=m;return i(),n("div",null,[r(ee,{visible:u(q),"onUpdate:visible":a[6]||(a[6]=e=>c(q)?q.value=e:null),width:"950px",title:"创建工单",onOk:G},{default:d((()=>[r(Y,{spinning:u(L).loading,"onUpdate:spinning":a[5]||(a[5]=e=>u(L).loading=e)},{default:d((()=>[r(X,{ref_key:"formRef",ref:K,model:u(F),"label-col":{span:6},"wrapper-col":{span:18}},{default:d((()=>[ae,r(l,{"row-key":"id","data-source":u(L).dataSource,columns:u(B),scroll:{x:"max-content"},"row-selection":{selectedRowKeys:u(L).selectedRowKeys,onChange(e){u(L).selectedRowKeys=e}},pagination:!1},{bodyCell:d((({column:e,record:a})=>["sku_thumb"===e.key?(i(),y(t,{key:0,width:50,height:50,src:a.sku_thumb},null,8,["src"])):g("",!0),"apply_nums"===e.key?(i(),y(s,{key:1,value:a.apply_nums,"onUpdate:value":e=>a.apply_nums=e,min:0,precision:0,max:a.can_return_nums},null,8,["value","onUpdate:value","max"])):g("",!0)])),_:1},8,["data-source","columns","row-selection"]),r(V,{class:"mt8px"},{default:d((()=>[r(b,{span:18},{default:d((()=>[r(_,{name:"type",label:"售后类型",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:d((()=>[r(p,{value:u(F).type,"onUpdate:value":a[0]||(a[0]=e=>u(F).type=e)},{default:d((()=>[(i(!0),n(f,null,h(u(U).sale_type,(e=>(i(),y(o,{key:e.value,disabled:!!D.type,value:e.value},{default:d((()=>[v(k(e.label),1)])),_:2},1032,["disabled","value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),r(V,null,{default:d((()=>[r(b,{span:12},{default:d((()=>[r(_,{name:"reason_id",label:"原因",required:""},{default:d((()=>[r(J,{value:u(F).reason_id,"onUpdate:value":a[1]||(a[1]=e=>u(F).reason_id=e),placeholder:"请选择"},{default:d((()=>[(i(!0),n(f,null,h(u(T),(e=>(i(),y($,{key:e.id,value:e.id},{default:d((()=>[v(k(e.reason),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),r(V,null,{default:d((()=>[r(b,{span:12},{default:d((()=>[r(_,{name:"description",label:"申请描述",required:""},{default:d((()=>[r(N,{value:u(F).description,"onUpdate:value":a[2]||(a[2]=e=>u(F).description=e)},null,8,["value"])])),_:1})])),_:1})])),_:1}),r(V,null,{default:d((()=>[r(b,{span:12},{default:d((()=>[r(_,{name:"media",label:"凭证图片"},{default:d((()=>[r(H,{filelist:u(F).imgs,"onUpdate:filelist":a[3]||(a[3]=e=>u(F).imgs=e),"max-count":4,multiple:""},null,8,["filelist"]),r(Q,{list:u(F).video,"onUpdate:list":a[4]||(a[4]=e=>u(F).video=e),style:{"margin-top":"5px"}},null,8,["list"]),te])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["spinning"])])),_:1},8,["visible"])])}}}),le={class:"table-pandect"},oe={key:0},ie={key:0},ne=e({__name:"OrderList",setup(e){a("enums");const s=G([["input","order_sn","订单编号"],["input","order_id","订单ID"],["select","type","订单类型"],["input","goods_id","商品ID"],["input","goods_title","商品标题"],["select","cate_id","商品分类"],["input","supplier_name","供应商"],["select","client_type","来源"],["input","uid","下单人ID"],["dateRange","time_start-time_end",["下单时间开始","下单时间结束"]],["select","close_style","关闭方式"],["select","pay_type","支付方式"]]),c=G([["input","order_sn","订单编号"],["input","order_id","订单ID"],["select","type","订单类型"],["input","goods_id","商品ID"],["input","goods_title","商品标题"],["select","cate_id","商品分类"],["input","supplier_name","供应商"],["select","client_type","来源"],["input","uid","下单人ID"],["dateRange","time_start-time_end",["下单时间开始","下单时间结束"]],["input","logistics_sn","物流单号"],["select","logistics_status","物流状态",[["全部",-1],["无状态",10],["已揽收",20],["已停滞",21]]],["select","close_style","关闭方式"],["select","pay_type","支付方式"]]),p=$([["订单编号","order_sn"],["订单ID","order_id"],["订单类型","type_name"],["订单状态","status_name"],["商品ID","goods_id"],["商品标题","goods_title"],["规格","skus"],["商品分类","cate_name"],["供应商","supplier_name"],["供应商编码","supplier_full_code"],["来源","client_type"],["数量","nums"],["下单人ID","uid"],["收货人姓名","receiver_name"],["实付金额","actual_fee"],["邮费","freight_fee"],["下单时间","created_at"],["支付时间","pay_at"],["支付方式","pay_type"],["关闭方式","close_style_name"],["用户备注","user_remark"],["操作","operate",210,"right"]]),R=$([["订单编号","order_sn"],["订单ID","order_id"],["订单类型","type_name"],["订单状态","status_name"],["商品ID","goods_id"],["商品标题","goods_title"],["规格","skus"],["商品分类","cate_name"],["物流单号","logistics_sn"],["物流状态","logistics_status_name"],["供应商","supplier_name"],["供应商编码","supplier_full_code"],["来源","client_type"],["数量","nums"],["下单人ID","uid"],["收货人姓名","receiver_name"],["实付金额","actual_fee"],["邮费","freight_fee"],["下单时间","created_at"],["支付时间","pay_at"],["支付方式","pay_type"],["关闭方式","close_style_name"],["用户备注","user_remark"],["操作","operate",210,"right"]]),x=t(),C=o({password:""}),j=o({tabs:[{key:"count-1",label:"全部",value:-1,count:0},{key:"count1",label:"待支付",value:1,count:0},{key:"count2",label:"待发货",value:2,count:0},{key:"count3",label:"已发货",value:3,count:0},{key:"count5",label:"已完成",value:5,count:0},{key:"count7",label:"已关闭",value:7,count:0},{key:"count200",label:"无物流轨迹",value:200,count:0}],tab_status:2,handlingId:"",handlingRow:{},dataSource:[],showTransoprt:!1,loading:!1,query:{},pagination:N(),selectedRowKeys:[],calculate:{},showCreate:!1,showRemarkOrder:!1,order_id:"",closeOrderVisible:!1,batchs:[{label:"批量备注",value:"bacth"}],isBatch:!1}),I=e=>{"bacth"===e&&(j.isBatch=!0,j.handlingId=j.selectedRowKeys.join(","),j.showRemarkOrder=!0)};l((()=>j.tab_status),(()=>{j.pagination={...j.pagination,current:1},S()})),D((()=>{S()}));const S=()=>{j.loading=!0,_.order.orderList.list({page:j.pagination.current,page_size:j.pagination.pageSize,status:j.tab_status,...j.query}).then((e=>{var a;j.loading=!1,j.dataSource=e.data.items,j.calculate=e.data.calculate,j.tabs.forEach((a=>{var t;a.key===`count${j.tab_status}`&&(a.count=+(null==(t=e.data)?void 0:t.count))})),1===j.pagination.current&&(j.pagination.total=+(null==(a=e.data)?void 0:a.count)),j.selectedRowKeys=[],J(s,"client_type",e.data.client_type_map),J(s,"cate_id",e.data.categories_map),J(s,"type",e.data.order_type_map),J(s,"close_style",e.data.close_style_map),J(s,"pay_type",e.data.pay_type_map),J(c,"client_type",e.data.client_type_map),J(c,"cate_id",e.data.categories_map),J(c,"type",e.data.order_type_map),J(c,"close_style",e.data.close_style_map),J(c,"pay_type",e.data.pay_type_map)}))},z=()=>{x.value.validate().then((async e=>{await _.order.orderList.close({order_id:j.order_id,...C}),S(),j.closeOrderVisible=!1})).catch((e=>{console.log(e)}))},A=e=>{j.pagination={...j.pagination,...e},S()},M=e=>{j.query=e,j.pagination={...j.pagination,current:1},S()};return(e,a)=>{const t=L,l=q,o=U("Export"),D=U("Search"),$=F,G=E,J=U("BatchTable"),N=V,P=w,W=O,Z=m,Q=K("permission");return i(),n("div",null,[r(l,{activeKey:u(j).tab_status,"onUpdate:activeKey":a[0]||(a[0]=e=>u(j).tab_status=e)},{default:d((()=>[(i(!0),n(f,null,h(u(j).tabs,(e=>(i(),y(t,{key:e.value,tab:`${e.label}(${e.count})`},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),r(D,{"search-options":200!=+u(j).tab_status?u(s):u(c),onOnSearch:M},{default:d((()=>[T(r(o,{api:u(_).order.orderList.export,query:{...u(j).query,status:u(j).tab_status}},null,8,["api","query"]),[[Q,[u(_).order.orderList.export]]])])),_:1},8,["search-options"]),b("div",le,[v(" 符合搜索条件的数据共 "),b("span",null,k(u(j).calculate.total_count),1),v(" 个 总价 "),b("span",null,k(u(j).calculate.total_fee),1),v(" 元 商品 "),b("span",null,k(u(j).calculate.total_num),1),v(" 件 ")]),r(G,{"row-key":"order_id","data-source":u(j).dataSource,columns:200!=+u(j).tab_status?u(p):u(R),scroll:{x:"max-content"},loading:u(j).loading,pagination:u(j).pagination,"row-selection":{selectedRowKeys:u(j).selectedRowKeys,onChange(e){u(j).selectedRowKeys=e}},onChange:A},{bodyCell:d((({column:a,record:t})=>["logistics_sn"===a.key?(i(),n("div",oe,[b("div",null,k(t.logistics_sn),1),t.logistics_sn?(i(),n("div",ie,[r($,{type:"link",onClick:e=>{u(j).showTransoprt=!0,u(j).handlingRow=t}},{default:d((()=>[v(" 查看物流 ")])),_:2},1032,["onClick"])])):g("",!0)])):g("",!0),"operate"===a.key?(i(),n(f,{key:1},[T((i(),y($,{type:"link",onClick:a=>e.$router.push({name:"orderDetail",params:{id:t.order_id}})},{default:d((()=>[v(" 查看 ")])),_:2},1032,["onClick"])),[[Q,[u(_).order.orderList.detail]]]),T((i(),y($,{type:"link",class:"danger-color",onClick:e=>{u(j).order_id=t.order_id,u(j).closeOrderVisible=!0}},{default:d((()=>[v(" 关闭 ")])),_:2},1032,["onClick"])),[[B,7!==t.status&&8!==t.status],[Q,[u(_).order.orderList.close]]]),T((i(),y($,{type:"link",onClick:e=>{u(j).handlingId=t.order_id+"",u(j).isBatch=!1,u(j).showRemarkOrder=!0}},{default:d((()=>[v(" 备注订单 ")])),_:2},1032,["onClick"])),[[Q,[u(_).order.orderList.addRemark]]]),5!==t.status&&3!==t.status||2===t.type?g("",!0):T((i(),y($,{key:0,type:"link",onClick:e=>{u(j).handlingId=t.order_id+"",u(j).showCreate=!0}},{default:d((()=>[v(" 创建工单 ")])),_:2},1032,["onClick"])),[[Q,[u(_).afterSale.sale.create]]])],64)):g("",!0)])),_:1},8,["data-source","columns","loading","pagination","row-selection"]),u(j).dataSource.length?(i(),y(J,{key:0,batchs:u(j).batchs,"selected-row-keys":u(j).selectedRowKeys,onClick:I},null,8,["batchs","selected-row-keys"])):g("",!0),r(H,{id:u(j).handlingId,show:u(j).showRemarkOrder,"onUpdate:show":a[1]||(a[1]=e=>u(j).showRemarkOrder=e),"is-batch":u(j).isBatch,onFresh:a[2]||(a[2]=e=>S())},null,8,["id","show","is-batch"]),r(se,{show:u(j).showCreate,"onUpdate:show":a[3]||(a[3]=e=>u(j).showCreate=e),order_id:u(j).handlingId,onFresh:a[4]||(a[4]=e=>S())},null,8,["show","order_id"]),r(Z,{ref:"modalRef",visible:u(j).closeOrderVisible,"onUpdate:visible":a[6]||(a[6]=e=>u(j).closeOrderVisible=e),width:"500px",title:"关闭订单","mask-closable":!1,onOk:z},{default:d((()=>[r(W,{ref_key:"closeFormRef",ref:x,model:u(C),ausymbolcomplete:"off","label-col":{span:6},"wrapper-col":{span:14}},{default:d((()=>[r(P,{label:"密码",name:"password",rules:e.rules},{default:d((()=>[r(N,{value:u(C).password,"onUpdate:value":a[5]||(a[5]=e=>u(C).password=e),type:"password",placeholder:"请输入密码"},null,8,["value"])])),_:1},8,["rules"])])),_:1},8,["model"])])),_:1},8,["visible"]),r(ee,{show:u(j).showTransoprt,"onUpdate:show":a[7]||(a[7]=e=>u(j).showTransoprt=e),row:u(j).handlingRow},null,8,["show","row"])])}}});export{ne as default};
