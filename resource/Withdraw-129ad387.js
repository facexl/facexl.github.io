import{d as a,c as e,r as t,i as n,l as s,m as o,a as i,b as l,e as r,w as d,f as u,k as c,$ as p,M as _,p as m,F as y,n as w,q as g,z as h,s as f,a1 as v,A as k,a7 as b,C as x,D as j,E as C,S as R,a0 as S,o as q,G as A,B as I}from"./index-c2ae2a0e.js";import{u as K,_ as L}from"./useTableColumns-dd067b4d.js";import{R as O,_ as U}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as B,a as D}from"./useSearchItems-c7d75cf3.js";import{u as F}from"./usePagination-c05046ed.js";import{D as z,_ as E}from"./index-923a8554.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const M=a({__name:"AuditModal",props:{show:Boolean,id:String,row:Object},emits:["fresh"],setup(a,{emit:S}){const q=a,A=e((()=>Array.isArray(q.id))),I=t(),K=n(q,"show",S),L=[["提现单号","withdraw_sn"],["提现金额(元)","money"],["手续费比例(%)","tax_rate"],["实际提现(元)","real_money"],["纳税额(元)","tax_fee"],["服务费(元)","service_fee"],["提现支付类型","pay_type_name"],["银行卡号/账户名","account_no"],["真实姓名","real_name"],["创建时间","created_at"],["提现状态","status_name"],["备注","remark"]];s(K,(async a=>{a&&(I.value&&I.value.resetFields(),q.row&&v((()=>{B.row=q.row})))}));const B=o({loading:!1,confirmLoading:!1,row:{}}),D=o({status:1,remark:""}),F=()=>{I.value.validate().then((async a=>{var e;B.confirmLoading=!0;try{await p.finance.withdraw.audit({...D,ids:A.value?null==(e=null==q?void 0:q.id)?void 0:e.join(","):String(q.id)}),B.confirmLoading=!1,K.value=!1,S("fresh")}catch(t){console.log(t),B.confirmLoading=!1}}))};return(e,t)=>{const n=z,s=E,o=O,p=U,v=k,S=b,q=x,M=j,P=C,T=R,G=_;return i(),l("div",null,[r(G,{visible:u(K),"onUpdate:visible":t[3]||(t[3]=a=>c(K)?K.value=a:null),width:"650px",title:"提现审核","confirm-loading":u(B).confirmLoading,onOk:F},{default:d((()=>[r(T,{spinning:u(B).loading,"onUpdate:spinning":t[2]||(t[2]=a=>u(B).loading=a)},{default:d((()=>[u(A)?f("",!0):(i(),m(s,{key:0,column:1,bordered:""},{default:d((()=>[(i(),l(y,null,w(L,((a,e)=>r(n,{key:e,label:a[0]},{default:d((()=>[g(h(u(B).row[a[1]]),1)])),_:2},1032,["label"]))),64))])),_:1})),0!==a.id?(i(),m(P,{key:1,ref_key:"formRef",ref:I,model:u(D),"label-col":{span:6},"wrapper-col":{span:18}},{default:d((()=>[r(M,{class:"mt16px"},{default:d((()=>[r(q,{span:18},{default:d((()=>[r(v,{name:"deduct_fee",label:"是否同意"},{default:d((()=>[r(p,{value:u(D).status,"onUpdate:value":t[0]||(t[0]=a=>u(D).status=a)},{default:d((()=>[(i(),l(y,null,w([{value:1,label:"同意"},{value:3,label:"拒绝"}],(a=>r(o,{key:a.value,value:a.value},{default:d((()=>[g(h(a.label),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),r(v,{name:"remark",label:"备注",required:3===u(D).status},{default:d((()=>[r(S,{value:u(D).remark,"onUpdate:value":t[1]||(t[1]=a=>u(D).remark=a)},null,8,["value"])])),_:1},8,["required"])])),_:1})])),_:1})])),_:1},8,["model"])):f("",!0)])),_:1},8,["spinning"])])),_:1},8,["visible","confirm-loading"])])}}}),P=a({__name:"Withdraw",setup(a){const e=S("enums"),t=B([["input","withdraw_sn","提现单号"],["input","uid","用户ID"],["select","user_type","身份",e.value.member_type],["input","nickname","用户昵称"],["select","pay_type","提现支付类型"],["input","pay_sn","交易单号"],["input","account_no","提现账号"],["select","client_type","渠道"],["dateRange","pay_at_start-pay_at_end",["发放时间","结束时间"]],["input","real_name","真实姓名"],["dateRange","created_at_start-created_at_end",["创建时间","结束时间"]],["select","status","提现状态"]]),n=K([["提现单号","withdraw_sn"],["用户ID","uid"],["身份","user_type_name"],["用户昵称","nickname"],["提现金额(元)","money"],["实际提现(元)","real_money"],["纳税额(元)",""],["服务费(元)",""],["提现支付类型","pay_type_name"],["交易单号","pay_sn"],["提现账号","account_no"],["渠道","client_type_name"],["发放时间","pay_at"],["真实姓名","real_name"],["创建时间","created_at"],["提现状态","status_name"],["操作","operate",180,"right"]]),s=o({handlingId:0,dataSource:[],loading:!1,query:{},pagination:F(),selectedRowKeys:[],showAudit:!1,batchs:[{label:"批量审核",value:"audit"}],row:{}}),c=a=>{"audit"===a&&(s.showAudit=!0,s.handlingId=s.selectedRowKeys)};q((()=>{_()}));const _=()=>{s.loading=!0,p.finance.withdraw.list({page:s.pagination.current,page_size:s.pagination.pageSize,...s.query}).then((a=>{var e;s.loading=!1,s.dataSource=a.data.items,1===s.pagination.current&&(s.pagination.total=+(null==(e=a.data)?void 0:e.count),D(t,"pay_type",a.data.pay_type_map),D(t,"status",a.data.status_map),D(t,"client_type",a.data.client_type_map))}))},w=a=>{s.pagination={...s.pagination,...a},_()},h=a=>{s.query=a,s.pagination={...s.pagination,current:1},_()};return(a,e)=>{const o=A("Export"),v=A("Search"),k=I,b=L,x=A("BatchTable");return i(),l("div",null,[r(v,{"search-options":u(t),onOnSearch:h},{default:d((()=>[r(o,{api:u(p).finance.withdraw.export,query:u(s).query},null,8,["api","query"])])),_:1},8,["search-options"]),r(b,{"row-key":"id","data-source":u(s).dataSource,columns:u(n),scroll:{x:"max-content"},loading:u(s).loading,pagination:u(s).pagination,"row-selection":{selectedRowKeys:u(s).selectedRowKeys,getCheckboxProps:a=>({disabled:0!==a.status}),onChange(a){u(s).selectedRowKeys=a}},onChange:w},{bodyCell:d((({column:a,record:e})=>["operate"===a.key?(i(),l(y,{key:0},[0===e.status?(i(),m(k,{key:0,type:"link",onClick:a=>{u(s).handlingId=e.id,u(s).showAudit=!0,u(s).row=e}},{default:d((()=>[g(" 审核 ")])),_:2},1032,["onClick"])):(i(),m(k,{key:1,type:"link",onClick:a=>{u(s).handlingId=0,u(s).showAudit=!0,u(s).row=e}},{default:d((()=>[g(" 查看 ")])),_:2},1032,["onClick"]))],64)):f("",!0)])),_:1},8,["data-source","columns","loading","pagination","row-selection"]),r(M,{id:u(s).handlingId,show:u(s).showAudit,"onUpdate:show":e[0]||(e[0]=a=>u(s).showAudit=a),row:u(s).row,onFresh:_},null,8,["id","show","row"]),u(s).dataSource.length?(i(),m(x,{key:0,batchs:u(s).batchs,"selected-row-keys":u(s).selectedRowKeys,onClick:c},null,8,["batchs","selected-row-keys"])):f("",!0)])}}});export{P as default};
