import{d as e,m as a,o as t,$ as n,G as o,a as s,b as i,e as d,w as l,f as r,p as c,s as u,F as p,q as k,B as m}from"./index-c2ae2a0e.js";import{u as g,_ as y}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as h}from"./index-ef11d20c.js";import{u as b}from"./useSearchItems-c7d75cf3.js";import{u as w}from"./usePagination-c05046ed.js";import{d as C}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const f=["href"],x=e({__name:"TaskCenter",setup(e){b([["input","keywords","ID"]]);const x=g([["文件名称","task_name"],["创建人","admin_name"],["创建时间","created_at"],["状态","status_name"],["备注","remark"],["操作","operate"]]),_=a({handlingId:0,dataSource:[],loading:!1,query:{},pagination:w(),selectedRowKeys:[],batchs:[{label:"批量删除",value:"del"}]}),j=e=>{"del"===e&&R(_.selectedRowKeys)};t((()=>{v()}));const v=()=>{_.loading=!0,n.sta.taskCenter.list({page:_.pagination.current,page_size:_.pagination.pageSize,..._.query}).then((e=>{var a;_.loading=!1,_.dataSource=e.data.items,1===_.pagination.current&&(_.pagination.total=+(null==(a=e.data)?void 0:a.count))}))},R=async e=>{C.confirm({title:"提示",content:"确认删除所选任务?",okText:"确认",cancelText:"取消",async onOk(){const a=Array.isArray(e)?e.join(","):String(e);await n.sta.taskCenter.del({ids:a}),v()},onCancel(){}})},S=e=>{_.pagination={..._.pagination,...e},v()};return(e,a)=>{const t=h,g=m,b=y,w=o("BatchTable");return s(),i("div",null,[d(b,{"row-key":"id","data-source":r(_).dataSource,columns:r(x),scroll:{x:"max-content"},loading:r(_).loading,"row-selection":{selectedRowKeys:r(_).selectedRowKeys,onChange(e){r(_).selectedRowKeys=e}},pagination:r(_).pagination,onChange:S},{bodyCell:l((({column:e,record:a})=>["enabled"===e.key?(s(),c(t,{key:0,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await n.product.material.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=0===e.enabled?1:0}))})(a)},null,8,["checked","onUpdate:checked","onChange"])):u("",!0),"operate"===e.key?(s(),i(p,{key:1},[2===a.status?(s(),i("a",{key:0,href:"/v1/export-task/download?id="+a.id,target:"_blank"}," 下载 ",8,f)):u("",!0),0===a.status?(s(),c(g,{key:1,type:"link",onClick:e=>{return t=a.id,void n.sta.taskCenter.exec({id:t});var t}},{default:l((()=>[k(" 手动触发 ")])),_:2},1032,["onClick"])):u("",!0),d(g,{type:"link",danger:"",onClick:e=>R(a.id)},{default:l((()=>[k(" 删除 ")])),_:2},1032,["onClick"])],64)):u("",!0)])),_:1},8,["data-source","columns","loading","row-selection","pagination"]),r(_).dataSource.length?(s(),c(w,{key:0,batchs:r(_).batchs,"selected-row-keys":r(_).selectedRowKeys,onClick:j},null,8,["batchs","selected-row-keys"])):u("",!0)])}}});export{x as default};
