import{d as a,i as e,r as i,m as t,l as o,o as n,$ as l,G as s,a as d,p as r,w as c,e as p,f as m,s as u,q as y,k as g,Z as k,I as _,v,T as f,M as h,_ as b}from"./index-c2ae2a0e.js";import{R as T,_ as w}from"./index-c8577ae4.js";import{u as R,_ as x}from"./useTableColumns-dd067b4d.js";import"./index-3f0a4d2e.js";import{u as N}from"./usePagination-c05046ed.js";const S=b(a({__name:"SetLinkDialog",props:{show:Boolean,id:{symbol:[String,Number],default:""},formData:{type:Object,default:null}},emits:["fresh","onChange"],setup(a,{emit:b}){const S=a,U=[{type:"input",key:"keywords",placeholder:"商品ID/商品名称"}],A=[{type:"input",key:"keywords",placeholder:"页面ID/页面名称"}],C=R([["页面名称","name",200],["页面参数","params"],["操作","operate",70]]),O=R([["商品ID","id",100],["商品名称","title"],["操作","operate",70]]),$=R([["ID","id",100],["页面名称","name"],["状态","status_name"],["创建时间","created_at"],["更新时间","updated_at"],["操作","operate",70]]),q=e(S,"show",b),D=i(),I=i(),j=t({catSelect:void 0}),L=t({hrefUrl:void 0}),z={1:"order",2:"coupon",3:"collect",4:"customize",5:"1",6:"detail",7:"category",8:"otherLink",9:"luckdraw",10:"weiwei_home",11:"index",12:"service",13:"shopCart",14:"home",15:"myCoupon",16:"supplierIn",17:"memberUp",18:"liveplay",19:"supplierDetail",20:"kandian",22:"balance",23:"goodsRank",24:"storeAct",25:"goldAct",27:"sign"};let K=[{id:1,name:"首页",linkType:z[11],params:""},{id:2,name:"领券中心",linkType:z[2],params:""},{id:5,name:"购物车",linkType:z[13],params:""},{id:5,name:"店铺",linkType:z[26],params:""},{id:6,name:"个人中心",linkType:z[14],params:""},{id:9,name:"我的优惠券",linkType:z[15],params:""},{id:11,name:"我的订单",linkType:z[1],params:""},{id:12,name:"抽奖",linkType:z[9],params:""},{id:15,name:"充值",linkType:z[22],params:""},{id:19,name:"签到活动",linkType:z[27]}].filter((a=>![8].includes(a.id)));const F=t({query2:{},query3:{},pagination2:N(),pagination3:N(),activeName:"1",systemTable:K,goodsTable:[],category:[],actTable:[],loading:!1,btnLoading:!1,goods:[],simpleRule:{required:!0,message:"必填项",trigger:"change"},systemRadio:"",goodsRadio:"",chooseAct:{id:"",name:""},catSelect:"",hrefUrl:""});o((()=>F.activeName),(a=>{F.query2={},F.query3={},2==+a&&E(),3==+a&&G(),4==+a&&M()})),n((()=>{M()})),o((()=>F.chooseAct.id),(a=>{if(!F.loading){let e=F.actTable.filter((e=>a===e.id));F.chooseAct.name=e[0]?e[0].name:""}})),o(q,(a=>{if(a){D.value&&D.value.resetFields(),I.value&&I.value.resetFields();let e=S.formData;if(a&&e&&e.link_desc)if(-1!==e.link_desc.indexOf("已选择系统页面")){if(F.systemRadio=e.link_type,e.link_params){let a=JSON.parse(JSON.stringify(F.systemTable));a.forEach((a=>{a.linkType===e.link_type&&(a.params=e.link_params)})),F.systemTable=a}F.activeName="1"}else-1!==e.link_desc.indexOf("已选择商品详情")?(F.goodsRadio=+e.link_params,F.activeName="2"):-1!==e.link_desc.indexOf("已选择商品分类")?(F.catSelect=e.link_params,F.activeName="3"):-1!==e.link_desc.indexOf("已选择自定义页面")?(F.chooseAct={name:e.link_desc.split("（")[0].split("：")[2],id:+e.link_params},F.activeName="4"):-1!==e.link_desc.indexOf("已选择内部链接")&&(F.hrefUrl=e.link_params,F.activeName="5")}}));const J=(a,e)=>{F[`pagination${e}`]={...F[`pagination${e}`],...a},B()},P=(a,e)=>{F[`query${e}`]=a,F[`pagination${e}`]={...F[`pagination${e}`],current:1},B()},B=()=>{2==+F.activeName&&E(),4==+F.activeName&&M()},E=async()=>{var a;F.loading=!0;const{data:e}=await l.product.goods.list({...F.query2,page:F.pagination2.current,page_size:10,show_type:5,not_type:4});F.loading=!1,F.goodsTable=e.items,F.pagination2.total=+(null==e?void 0:e.count)>0?+(null==e?void 0:e.count):+(null==(a=null==F?void 0:F.pagination2)?void 0:a.total)},G=async()=>{F.loading=!0;const{data:a}=await l.productConfig.category.tree({});F.category=a.categories,F.loading=!1},M=async()=>{var a;F.loading=!0;const{data:e}=await l.set.startSetting.actPageList({...F.query3,page_type_id:2,page:F.pagination3.current,page_size:10});F.pagination3.total=+(null==e?void 0:e.count)>0?+(null==e?void 0:e.count):+(null==(a=null==F?void 0:F.pagination3)?void 0:a.total),F.actTable=e.items,F.loading=!1};return(a,e)=>{const i=_,t=T,o=x,n=w,l=v,R=s("Search"),N=f,S=h;return d(),r(S,{visible:m(q),"onUpdate:visible":e[8]||(e[8]=a=>g(q)?q.value=a:null),title:"跳转设置",width:"1000px","mask-closable":!1,onOk:e[9]||(e[9]=a=>(()=>{let a={link_type:"",link_params:"",link_desc:""};switch(+F.activeName){case 1:if(F.systemRadio){let e=F.systemTable.filter((a=>F.systemRadio===a.linkType));if("luckdraw"===F.systemRadio&&!e[0].params)return k.error("抽奖的页面参数为必填");a.link_params=e[0].params,a.link_type=F.systemRadio,a.link_desc=`已选择系统页面：${e[0].name}`}break;case 2:F.goodsRadio&&(a.link_type=z[6],a.link_params=F.goodsRadio,a.link_desc=`已选择商品详情（商品id：${F.goodsRadio}）`);break;case 3:if(j.catSelect){a.link_type=z[7],a.link_params=j.catSelect;let e=F.category.filter((a=>j.catSelect===a.id));a.link_desc=`已选择商品分类：${e[0].name}`}break;case 4:F.chooseAct.name&&(a.link_type=z[4],a.link_params=F.chooseAct.id,a.link_desc=`已选择自定义页面：${F.chooseAct.name}（页面id：${F.chooseAct.id}）`);break;case 5:L.hrefUrl&&(a.link_type=z[8],a.link_params=L.hrefUrl,a.link_desc="已选择内部链接")}b("onChange",a),q.value=!1})())},{default:c((()=>[p(N,{activeKey:m(F).activeName,"onUpdate:activeKey":e[7]||(e[7]=a=>m(F).activeName=a),style:{"padding-left":"15px","min-height":"450px"}},{default:c((()=>[p(l,{key:"1",tab:"功能页面"},{default:c((()=>[p(n,{value:m(F).systemRadio,"onUpdate:value":e[0]||(e[0]=a=>m(F).systemRadio=a)},{default:c((()=>[p(o,{"row-key":"id","data-source":m(F).systemTable,columns:m(C),pagination:!1,scroll:{y:450}},{bodyCell:c((({column:a,record:e,index:o})=>["params"===a.key?(d(),r(i,{key:0,value:e.params,"onUpdate:value":a=>e.params=a,style:{width:"450px"}},null,8,["value","onUpdate:value"])):u("",!0),"operate"===a.key?(d(),r(t,{key:1,value:e.linkType},{default:c((()=>[y("   ")])),_:2},1032,["value"])):u("",!0)])),_:1},8,["data-source","columns"])])),_:1},8,["value"])])),_:1}),p(l,{key:"2",tab:"商品详情"},{default:c((()=>[p(R,{"search-options":U,onOnSearch:e[1]||(e[1]=a=>{P(a,2)})}),p(n,{value:m(F).goodsRadio,"onUpdate:value":e[3]||(e[3]=a=>m(F).goodsRadio=a)},{default:c((()=>[p(o,{"row-key":"id","data-source":m(F).goodsTable,columns:m(O),loading:m(F).loading,pagination:m(F).pagination2,scroll:{y:450},onChange:e[2]||(e[2]=a=>{J(a,2)})},{bodyCell:c((({column:a,record:e,index:i})=>["operate"===a.key?(d(),r(t,{key:0,value:e.id},{default:c((()=>[y("   ")])),_:2},1032,["value"])):u("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])),_:1},8,["value"])])),_:1}),p(l,{key:"4",tab:"自定义页面"},{default:c((()=>[p(R,{"search-options":A,onOnSearch:e[4]||(e[4]=a=>{P(a,3)})}),p(n,{value:m(F).chooseAct.id,"onUpdate:value":e[6]||(e[6]=a=>m(F).chooseAct.id=a)},{default:c((()=>[p(o,{"row-key":"id","data-source":m(F).actTable,columns:m($),loading:m(F).loading,pagination:m(F).pagination3,scroll:{y:400},onChange:e[5]||(e[5]=a=>{J(a,3)})},{bodyCell:c((({column:a,record:e,index:i})=>["operate"===a.key?(d(),r(t,{key:0,value:e.id},{default:c((()=>[y("   ")])),_:2},1032,["value"])):u("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])),_:1},8,["value"])])),_:1})])),_:1},8,["activeKey"])])),_:1},8,["visible"])}}}),[["__scopeId","data-v-24e46bc0"]]);export{S as _};
