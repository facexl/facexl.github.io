import{d as e,i as a,r as l,l as o,m as n,cJ as t,a as i,p as s,w as r,f as d,k as u,$ as c,M as p,e as m,b as g,n as v,q as h,z as _,F as f,I as y,A as w,V as b,W as k,cI as C,E as j,o as D,G as M,K as x,s as O,B as q,a3 as S,a4 as U,g as A,_ as L}from"./index-c2ae2a0e.js";import{u as z,_ as F}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as I}from"./useSearchItems-c7d75cf3.js";import{u as B}from"./usePagination-c05046ed.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const R=e({__name:"MemberModal",props:{show:Boolean,content:Object},emits:["fresh","update:show"],setup(e,{emit:D}){const M=e,x=a(M,"show",D),O=l();o(x,(e=>{e&&(O.value&&O.value.resetFields(),Object.keys(S).forEach((e=>{S[e]=M.content[e]})),q.action=Object.keys((null==M?void 0:M.content)||{}).length>0?"modify":"create",U())}));const q=n({loading:!1,roleList:[],action:"create"}),S=n({id:"",username:"",role_id:"",password:"",service_type:void 0}),U=async()=>{try{q.loading=!0;const{data:e}=await c.jurisdiction.getRoleList({page:1,page_size:1e3});q.roleList=(null==e?void 0:e.items)||[]}catch(e){}finally{q.loading=!1}},A=t((async()=>{try{await O.value.validate(),q.loading=!0;const{id:e,username:a,password:l,role_id:o,service_type:n}=S;"create"===q.action?await c.jurisdiction.createAdmin({username:a,password:l,role_id:o,service_type:n}):await c.jurisdiction.editAdmin({username:a,password:l,role_id:o,uid:e,service_type:n}),x.value=!1,D("fresh")}catch(e){}finally{q.loading=!1}}),1e3,!1);return(e,a)=>{const l=y,o=w,n=b,t=k,c=C,D=j,M=p;return i(),s(M,{visible:d(x),"onUpdate:visible":a[4]||(a[4]=e=>u(x)?x.value=e:null),width:"400px",title:"create"===d(q).action?"添加成员":"编辑成员","confirm-loading":d(q).loading,"destroy-on-close":"",onOk:d(A)},{default:r((()=>[m(D,{ref_key:"formRef",ref:O,model:d(S),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:18}},{default:r((()=>[m(o,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}]},{default:r((()=>[m(l,{value:d(S).username,"onUpdate:value":a[0]||(a[0]=e=>d(S).username=e),"max-length":50,placeholder:"请输入角色名称"},null,8,["value"])])),_:1}),m(o,{name:"role_id",label:"对应角色",rules:[{required:!0,message:"请选择对应角色"}]},{default:r((()=>[m(t,{value:d(S).role_id,"onUpdate:value":a[1]||(a[1]=e=>d(S).role_id=e),placeholder:"请选择对应角色"},{default:r((()=>[(i(!0),g(f,null,v(d(q).roleList,(e=>(i(),s(n,{key:e.id,value:e.id},{default:r((()=>[h(_(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),m(o,{name:"service_type",label:"客服人员"},{default:r((()=>[m(t,{value:d(S).service_type,"onUpdate:value":a[2]||(a[2]=e=>d(S).service_type=e),placeholder:"请选择是否是客服"},{default:r((()=>[(i(),g(f,null,v([{value:0,label:"否"},{value:1,label:"是"}],(e=>m(n,{key:e.value,value:e.value},{default:r((()=>[h(_(e.label),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),m(o,{name:"password",label:"create"===d(q).action?"登录密码":"重置密码",rules:[{required:"create"===d(q).action,message:"请输入登录密码"}]},{default:r((()=>[m(c,{value:d(S).password,"onUpdate:value":a[3]||(a[3]=e=>d(S).password=e),autocomplete:"new-password","max-length":20,placeholder:"create"===d(q).action?"请设置密码":"输入后将重置用户密码"},null,8,["value","placeholder"])])),_:1},8,["label","rules"])])),_:1},8,["model"])])),_:1},8,["visible","title","confirm-loading","onOk"])}}}),E={key:0},G=(e=>(S("data-v-956b1646"),e=e(),U(),e))((()=>A("p",null,"确认删除？",-1))),J=L(e({__name:"Member",setup(e){const a=I([["input","username_like","请输入用户名"]]),l=z([["用户名","username"],["对应角色","role_name"],["最后登录","last_login_at"],["操作","operate",200,"right"]]),o=n({dataSource:[],loading:!1,query:{},pagination:B(),showMemberMadalDialog:!1,handlingContent:{},showDelConfirmDialog:!1});D((()=>{u()}));const s=e=>{o.query=e,o.pagination={...o.pagination,current:1},u()},u=async()=>{try{o.loading=!0,o.handlingContent={};const{data:e}=await c.jurisdiction.getAdminList({page:o.pagination.current,page_size:o.pagination.pageSize,...o.query});o.dataSource=(null==e?void 0:e.items)??[],1===o.pagination.current&&(o.pagination.total=+(null==e?void 0:e.count))}catch(e){}finally{o.loading=!1}},v=e=>{o.pagination=e,u()},_=t((async()=>{var e;try{o.loading=!0;const{data:a}=await c.jurisdiction.delAdmin({uid:(null==(e=null==o?void 0:o.handlingContent)?void 0:e.id)??null});o.showDelConfirmDialog=!1,u()}catch(a){}finally{o.loading=!1}}),1e3,!1);return(e,n)=>{var t;const c=q,f=M("Search"),y=F,w=p;return i(),g("div",null,[m(f,{"search-options":d(a),onOnSearch:s},{default:r((()=>[m(c,{class:"add-btn",type:"primary",onClick:n[0]||(n[0]=x((e=>{d(o).handlingContent={},d(o).showMemberMadalDialog=!0}),["stop"]))},{default:r((()=>[h(" 添加 ")])),_:1})])),_:1},8,["search-options"]),m(y,{"data-source":d(o).dataSource,columns:d(l),bordered:"",scroll:{y:1e3},loading:d(o).loading,pagination:d(o).pagination,onChange:v},{bodyCell:r((({column:e,record:a})=>["operate"===e.key?(i(),g("div",E,[m(c,{type:"link",onClick:x((e=>{d(o).handlingContent=a,d(o).showMemberMadalDialog=!0}),["stop"])},{default:r((()=>[h(" 编辑 ")])),_:2},1032,["onClick"]),m(c,{type:"link",onClick:x((e=>{d(o).handlingContent=a,d(o).showDelConfirmDialog=!0}),["stop"])},{default:r((()=>[h(" 删除 ")])),_:2},1032,["onClick"])])):O("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),m(R,{show:d(o).showMemberMadalDialog,"onUpdate:show":n[1]||(n[1]=e=>d(o).showMemberMadalDialog=e),content:(null==(t=d(o))?void 0:t.handlingContent)??{},onFresh:n[2]||(n[2]=e=>{d(o).handlingContent={},u()})},null,8,["show","content"]),m(w,{visible:d(o).showDelConfirmDialog,"onUpdate:visible":n[3]||(n[3]=e=>d(o).showDelConfirmDialog=e),width:"400px",title:"提示","cancel-text":"关闭","ok-text":"删除","ok-type":"danger","confirm-loading":d(o).loading,onOk:d(_)},{default:r((()=>[G])),_:1},8,["visible","confirm-loading","onOk"])])}}}),[["__scopeId","data-v-956b1646"]]);export{J as default};
