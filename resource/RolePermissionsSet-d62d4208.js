import{d as e,i as a,r as i,l,m as s,a as t,b as n,e as d,w as o,f as c,k as r,$ as u,M as p,q as h,a1 as k,I as m,A as f,E as _,h as v,o as y,G as w,g,B as C,S as E,F as x,n as P,z as j,p as U,cK as b,_ as S}from"./index-c2ae2a0e.js";import{C as B}from"./index-3f0a4d2e.js";import{_ as R}from"./index-36c6d0ec.js";import{_ as F}from"./index-c8577ae4.js";import{_ as O}from"./RadioButton-bc4165ed.js";import{d as A}from"./index-a09a23de.js";const q=e({__name:"PermissionEdit",props:{show:Boolean,state:Object,isEdit:Boolean},emits:["fresh"],setup(e,{emit:v}){const y=e,w=a(y,"show",v),g=i();l(w,(e=>{e&&(g.value&&g.value.resetFields(),k((()=>{y.isEdit&&Object.keys(C).forEach((e=>{C[e]=y.state[e]}))})))}));const C=s({name:"",sort:"",type:2,key:"",rule:"",desc:""}),E=()=>{g.value.validate().then((async e=>{y.isEdit?await u.jurisdiction.editPermission({...C,id:y.state.id,pid:y.state.pid}):await u.jurisdiction.createPermission({...C,pid:y.state.id||void 0}),w.value=!1,v("fresh")})).catch((e=>{console.log(e)}))};return(a,i)=>{const l=m,s=f,u=O,k=F,v=_,y=p;return t(),n("div",null,[d(y,{visible:c(w),"onUpdate:visible":i[5]||(i[5]=e=>r(w)?w.value=e:null),width:"500px",title:e.isEdit?"编辑权限":"创建权限",onOk:E},{default:o((()=>[d(v,{ref_key:"formRef",ref:g,model:c(C),autocomplete:"off","label-col":{span:6},"wrapper-col":{span:18}},{default:o((()=>[d(s,{name:"name",label:"权限名称",rules:[{required:!0,message:"请输入"}]},{default:o((()=>[d(l,{value:c(C).name,"onUpdate:value":i[0]||(i[0]=e=>c(C).name=e),placeholder:"请输入"},null,8,["value"])])),_:1}),d(s,{name:"key",label:"标识"},{default:o((()=>[d(l,{value:c(C).key,"onUpdate:value":i[1]||(i[1]=e=>c(C).key=e),placeholder:"请输入"},null,8,["value"])])),_:1}),d(s,{name:"type",label:"类型"},{default:o((()=>[d(k,{value:c(C).type,"onUpdate:value":i[2]||(i[2]=e=>c(C).type=e)},{default:o((()=>[d(u,{value:1},{default:o((()=>[h(" 菜单 ")])),_:1}),d(u,{value:2},{default:o((()=>[h(" 按钮 ")])),_:1})])),_:1},8,["value"])])),_:1}),d(s,{name:"rule",label:"api路由"},{default:o((()=>[d(l,{value:c(C).rule,"onUpdate:value":i[3]||(i[3]=e=>c(C).rule=e),placeholder:"请输入api路由"},null,8,["value"])])),_:1}),d(s,{name:"sort",label:"排序"},{default:o((()=>[d(l,{value:c(C).sort,"onUpdate:value":i[4]||(i[4]=e=>c(C).sort=e),placeholder:"请输入"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),I={class:"flex"},M={class:"card-container"},T={class:"row-title"},z={class:"row-left"},G={class:"row-right"},K=S(e({__name:"RolePermissionsSet",setup(e){const a=v(),i=s({permissions:[],level:"",handlingState:{},showPermissionEdit:!1,isEdit:!1,loading:!1}),l=e=>{e.child&&k(e.child,3,e.checked)};y((async()=>{p()}));const r=async()=>{const e=k(i.permissions,2);await u.jurisdiction.setRoleAuth({permission_arr:e,id:a.params.id})},p=async()=>{i.loading=!0;const e=await u.jurisdiction.getRoleAuth({id:a.params.id}),l=k(e.data.items,1);i.permissions=l,i.loading=!1},k=(e,a,i)=>{const l=[],s=(e,a=1)=>{e.forEach((e=>{1===a&&(e.checked=!!e.is_selected),2===a&&e.checked&&l.push(e.id),3===a&&(e.checked=i),4===a&&(e.checked=!0),5===a&&(e.checked=!1),e.child&&s(e.child,a)}))};return s(e,a),1===a?e:l},m=async e=>{A.confirm({title:"提示",icon:d(b),content:"确认删除这个权限?",okText:"确认",cancelText:"取消",onOk:async()=>(await u.jurisdiction.delPermission({id:e.id}),await p()),onCancel(){}})};return(e,a)=>{const s=C,u=R,f=B,_=E,v=w("FixBottomBar");return t(),n("div",null,[g("div",I,[d(s,{type:"primary",onClick:a[0]||(a[0]=e=>{c(i).showPermissionEdit=!0,c(i).handlingState={},c(i).isEdit=!1})},{default:o((()=>[h(" 添加菜单 ")])),_:1}),d(s,{class:"ml8px",onClick:a[1]||(a[1]=e=>k(c(i).permissions,4))},{default:o((()=>[h(" 全选 ")])),_:1}),d(s,{class:"ml8px",onClick:a[2]||(a[2]=e=>k(c(i).permissions,5))},{default:o((()=>[h(" 全部取消 ")])),_:1})]),d(_,{spinning:c(i).loading},{default:o((()=>[g("div",M,[(t(!0),n(x,null,P(c(i).permissions,((e,a)=>(t(),n("div",{key:a,class:"card"},[g("div",T,[d(f,{checked:e.checked,"onUpdate:checked":a=>e.checked=a,onChange:a=>l(e)},{default:o((()=>[d(u,null,{content:o((()=>[g("p",null,[d(s,{type:"link",onClick:a=>{c(i).showPermissionEdit=!0,c(i).handlingState=e,c(i).isEdit=!0}},{default:o((()=>[h(" 编辑 ")])),_:2},1032,["onClick"]),d(s,{danger:"",type:"link",onClick:a=>m(e)},{default:o((()=>[h(" 删除 ")])),_:2},1032,["onClick"])])])),default:o((()=>[h(" "+j(e.name),1)])),_:2},1024)])),_:2},1032,["checked","onUpdate:checked","onChange"]),d(s,{type:"link",onClick:a=>{c(i).showPermissionEdit=!0,c(i).handlingState=e,c(i).isEdit=!1}},{default:o((()=>[h(" 添加子菜单 ")])),_:2},1032,["onClick"])]),(t(!0),n(x,null,P(e.child,((e,a)=>(t(),n("div",{key:a,class:"row"},[g("div",z,[d(f,{checked:e.checked,"onUpdate:checked":a=>e.checked=a,onChange:a=>l(e)},{default:o((()=>[d(u,null,{content:o((()=>[g("p",null,[d(s,{type:"link",onClick:a=>{c(i).showPermissionEdit=!0,c(i).handlingState=e,c(i).isEdit=!0}},{default:o((()=>[h(" 编辑 ")])),_:2},1032,["onClick"]),d(s,{danger:"",type:"link",onClick:a=>m(e)},{default:o((()=>[h(" 删除 ")])),_:2},1032,["onClick"])])])),default:o((()=>[h(" "+j(e.name),1)])),_:2},1024)])),_:2},1032,["checked","onUpdate:checked","onChange"])]),g("div",G,[(t(!0),n(x,null,P(e.child,(e=>(t(),n("span",{key:e.key},[g("div",null,[(t(),U(f,{key:e.key,checked:e.checked,"onUpdate:checked":a=>e.checked=a,value:e.key},{default:o((()=>[d(u,null,{content:o((()=>[g("p",null,[d(s,{type:"link",onClick:a=>{c(i).showPermissionEdit=!0,c(i).handlingState=e,c(i).isEdit=!0}},{default:o((()=>[h("编辑")])),_:2},1032,["onClick"]),d(s,{danger:"",type:"link",onClick:a=>m(e)},{default:o((()=>[h("删除")])),_:2},1032,["onClick"])])])),default:o((()=>[h(" "+j(e.name),1)])),_:2},1024)])),_:2},1032,["checked","onUpdate:checked","value"]))])])))),128)),d(s,{type:"link",class:"ml8px",onClick:a=>{c(i).showPermissionEdit=!0,c(i).handlingState=e,c(i).isEdit=!1}},{default:o((()=>[h(" 添加按钮权限 ")])),_:2},1032,["onClick"])])])))),128))])))),128))])])),_:1},8,["spinning"]),d(q,{show:c(i).showPermissionEdit,"onUpdate:show":a[3]||(a[3]=e=>c(i).showPermissionEdit=e),state:c(i).handlingState,"is-edit":c(i).isEdit,onFresh:p},null,8,["show","state","is-edit"]),d(v,null,{default:o((()=>[d(s,{type:"primary",onClick:r},{default:o((()=>[h(" 保存 ")])),_:1})])),_:1})])}}}),[["__scopeId","data-v-630e183e"]]);export{K as default};
