import{d as e,i as a,r as n,m as l,o,l as t,a as i,b as s,e as d,w as r,f as u,k as c,$ as p,M as m,q as h,I as g,A as f,E as v,_ as b,G as _,H as k,x as y,p as I,s as w,B as x}from"./index-c2ae2a0e.js";import{u as j,_ as C}from"./useTableColumns-dd067b4d.js";import{R as U,_ as N}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as S}from"./index-ef11d20c.js";import{u as q,a as O}from"./useSearchItems-c7d75cf3.js";import{u as D}from"./usePagination-c05046ed.js";import{_ as F}from"./index-8036da2a.js";import{d as T}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const B=b(e({__name:"NewFreightInsurance",props:{show:Boolean,id:Number,handlingInfo:{type:Object,default:()=>{}}},emits:["fresh"],setup(e,{emit:b}){const _=e,k=a(_,"show",b),y=n(),I={required:!0,message:"请输入"},w=l({loading:!1}),x=l({name:"",money:"",compensate:"",enabled:0});o((()=>{})),t(k,(e=>{e&&(y.value&&y.value.resetFields(),_.id&&(w.loading=!0,setTimeout((e=>{for(let a in x)void 0!==_.handlingInfo[a]&&(x[a]=_.handlingInfo[a])}),200)))}));const j=()=>{y.value.validate().then((async e=>{await p.set.freightInsurance[_.id?"edit":"add"]({...e,id:_.id||void 0}),k.value=!1,b("fresh")})).catch((e=>{console.log(e)}))};return(a,n)=>{const l=g,o=f,t=F,p=U,b=N,_=v,w=m;return i(),s("div",null,[d(w,{visible:u(k),"onUpdate:visible":n[4]||(n[4]=e=>c(k)?k.value=e:null),width:"600px",title:e.id?"编辑运费险":"添加运费险","mask-closable":!1,onOk:j},{default:r((()=>[d(_,{ref_key:"formRef",ref:y,model:u(x),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18}},{default:r((()=>[d(o,{name:"name",label:"运费险名称",rules:[I]},{default:r((()=>[d(l,{value:u(x).name,"onUpdate:value":n[0]||(n[0]=e=>u(x).name=e),placeholder:"请输入运费险名称"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"money",label:"运费险",rules:[I]},{default:r((()=>[d(t,{value:u(x).money,"onUpdate:value":n[1]||(n[1]=e=>u(x).money=e),placeholder:"请输入运费险"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"compensate",label:"赔付金额",rules:[I]},{default:r((()=>[d(t,{value:u(x).compensate,"onUpdate:value":n[2]||(n[2]=e=>u(x).compensate=e),placeholder:"请输入赔付金额"},null,8,["value"])])),_:1},8,["rules"]),d(o,{name:"enabled",label:"是否启用"},{default:r((()=>[d(b,{value:u(x).enabled,"onUpdate:value":n[3]||(n[3]=e=>u(x).enabled=e)},{default:r((()=>[d(p,{value:1},{default:r((()=>[h(" 是 ")])),_:1}),d(p,{value:0},{default:r((()=>[h(" 否 ")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-3b48d83e"]]),R=["src"],z={key:2},A=e({__name:"FreightInsurance",setup(e){const a=q([]),n=j([["编号","id"],["模板名称","name"],["运费险","money"],["赔付金额","compensate"],["状态","enabled"],["操作","operate",130,"right"]]),t=l({handlingId:0,dataSource:[],loading:!1,query:{},pagination:D(),showNewDialog:!1,handlingInfo:{}});o((()=>{c()}));const c=()=>{t.loading=!0,p.set.freightInsurance.list({page:t.pagination.current,page_size:t.pagination.pageSize,...t.query}).then((e=>{var n;t.loading=!1,t.dataSource=e.data.items,1===t.pagination.current&&(t.pagination.total=+(null==(n=e.data)?void 0:n.count)),O(a,"enabled",e.data.enabled_map)}))},m=e=>{t.pagination={...t.pagination,...e},c()},g=e=>{t.query=e,t.pagination={...t.pagination,current:1},c()};return(e,l)=>{const o=x,f=_("Search"),v=S,b=C,j=k("permission");return i(),s("div",null,[d(f,{"search-options":u(a),onOnSearch:g},{default:r((()=>[y((i(),I(o,{type:"primary",onClick:l[0]||(l[0]=e=>{u(t).handlingId=0,u(t).handlingInfo={},u(t).showNewDialog=!0})},{default:r((()=>[h(" 添加 ")])),_:1})),[[j,[u(p).set.freightInsurance.add]]])])),_:1},8,["search-options"]),d(b,{"data-source":u(t).dataSource,columns:u(n),scroll:{x:"max-content"},loading:u(t).loading,pagination:u(t).pagination,onChange:m},{bodyCell:r((({column:e,record:a})=>["icon"===e.key?(i(),s("img",{key:0,style:{width:"70px"},src:a.icon},null,8,R)):w("",!0),"enabled"===e.key?(i(),I(v,{key:1,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await p.set.freightInsurance.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=1===e.enabled?0:1}))})(a)},null,8,["checked","onUpdate:checked","onChange"])):w("",!0),"operate"===e.key?(i(),s("div",z,[y((i(),I(o,{type:"link",onClick:e=>{u(t).handlingId=a.id,u(t).handlingInfo=a,u(t).showNewDialog=!0}},{default:r((()=>[h(" 编辑 ")])),_:2},1032,["onClick"])),[[j,[u(p).set.freightInsurance.edit]]]),y((i(),I(o,{type:"link",class:"danger-color",onClick:e=>{return n=a,void T.confirm({title:"提示",content:"确认删除该运费险？",okText:"确认",cancelText:"取消",onOk:()=>{p.set.freightInsurance.delete({id:n.id+"",enabled:n.enabled}).then((e=>{c()}))}});var n}},{default:r((()=>[h(" 删除 ")])),_:2},1032,["onClick"])),[[j,[u(p).set.freightInsurance.delete]]])])):w("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),d(B,{id:u(t).handlingId,show:u(t).showNewDialog,"onUpdate:show":l[1]||(l[1]=e=>u(t).showNewDialog=e),"handling-info":u(t).handlingInfo,onFresh:c},null,8,["id","show","handling-info"])])}}});export{A as default};
