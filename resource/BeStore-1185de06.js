import{d as e,r as a,i as o,l as t,m as n,a as s,b as r,e as i,w as l,f as d,k as u,$ as c,M as p,g as m,z as _,q as h,A as g,E as f,p as w,s as v,X as y,C as b,D as k,S,o as B,G as j,F as C,B as x}from"./index-c2ae2a0e.js";import{u as q,_ as L}from"./useTableColumns-dd067b4d.js";import{R,_ as U}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as D}from"./index-ef11d20c.js";import{_ as Y}from"./index-00d344de.js";import{u as F,a as A}from"./useSearchItems-c7d75cf3.js";import{u as H}from"./usePagination-c05046ed.js";import{d as O}from"./dtool-b3945d0c.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const M=e({__name:"BeStoreAudit",props:{show:Boolean,row:Object},emits:["fresh"],setup(e,{emit:w}){const v=e,y=a(),b=o(v,"show",w);t(b,(async e=>{e&&y.value&&y.value.resetFields()}));const k=n({loading:!1,confirmLoading:!1}),S=n({is_agree:1}),B=()=>{y.value.validate().then((async e=>{k.confirmLoading=!0;try{await c.user.beStore.audit({...S,apply_id:v.row.id}),k.confirmLoading=!1,b.value=!1,w("fresh")}catch(a){console.log(a),k.confirmLoading=!1}}))};return(a,o)=>{const t=g,n=R,c=U,w=f,v=p;return s(),r("div",null,[i(v,{visible:d(b),"onUpdate:visible":o[1]||(o[1]=e=>u(b)?b.value=e:null),width:"650px",title:"审核","confirm-loading":d(k).confirmLoading,onOk:B},{default:l((()=>[i(w,{ref_key:"formRef",ref:y,model:d(S),"label-col":{span:6},"wrapper-col":{span:18}},{default:l((()=>[i(t,null,{default:l((()=>[m("span",null,"请确认对"+_(e.row.username)+"("+_(e.row.uid)+")的掌柜申请",1)])),_:1}),i(t,{name:"is_agree",label:"是否通过",required:""},{default:l((()=>[i(c,{value:d(S).is_agree,"onUpdate:value":o[0]||(o[0]=e=>d(S).is_agree=e)},{default:l((()=>[i(n,{value:1},{default:l((()=>[h(" 通过 ")])),_:1}),i(n,{value:2},{default:l((()=>[h(" 不通过 ")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","confirm-loading"])])}}}),z=e({__name:"BeStoreControl",props:{show:Boolean,id:String},emits:["fresh"],setup(e,{emit:m}){const _=e,B=a(),j=o(_,"show",m);t(j,(async e=>{if(e&&(B.value&&B.value.resetFields(),e)){const e=await c.user.beStore.list({page:1,page_size:1});O(e.data.control_conf).combinDayjs(["start_at","end_at"]).toNumber(["show_store"]).insertForm(x)}}));const C=n({loading:!1,confirmLoading:!1}),x=n({show_store:1,"start_at-end_at":[]}),q=()=>{B.value.validate().then((async e=>{C.confirmLoading=!0;try{await c.user.beStore.save({...O(x).splitDayjs(["start_at","end_at"],"YYYY-MM-DD HH:mm:ss").end()}),C.confirmLoading=!1,j.value=!1,m("fresh")}catch(a){console.log(a),C.confirmLoading=!1}}))};return(e,a)=>{const o=R,t=U,n=g,c=y,m=b,_=k,L=f,D=S,Y=p;return s(),r("div",null,[i(Y,{visible:d(j),"onUpdate:visible":a[3]||(a[3]=e=>u(j)?j.value=e:null),width:"650px",title:"招募控制","confirm-loading":d(C).confirmLoading,onOk:q},{default:l((()=>[i(D,{spinning:d(C).loading,"onUpdate:spinning":a[2]||(a[2]=e=>d(C).loading=e)},{default:l((()=>[i(L,{ref_key:"formRef",ref:B,model:d(x),"label-col":{span:6},"wrapper-col":{span:18}},{default:l((()=>[i(_,null,{default:l((()=>[i(m,{span:18},{default:l((()=>[i(n,{name:"show_store",label:"状态",required:""},{default:l((()=>[i(t,{value:d(x).show_store,"onUpdate:value":a[0]||(a[0]=e=>d(x).show_store=e)},{default:l((()=>[i(o,{value:1},{default:l((()=>[h(" 开启 ")])),_:1}),i(o,{value:0},{default:l((()=>[h(" 关闭 ")])),_:1})])),_:1},8,["value"])])),_:1}),1==d(x).show_store?(s(),w(n,{key:0,name:"start_at-end_at",label:"开启时间",required:""},{default:l((()=>[i(c,{value:d(x)["start_at-end_at"],"onUpdate:value":a[1]||(a[1]=e=>d(x)["start_at-end_at"]=e),"show-time":{format:"HH:mm:ss"},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"]},null,8,["value"])])),_:1})):v("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["spinning"])])),_:1},8,["visible","confirm-loading"])])}}}),I=e({__name:"BeStore",setup(e){const a=F([["input","uid","用户ID"],["input","username","姓名"],["input","phone","手机号"],["input","superior_username","审核责任人"],["select","status","审核状态"],["dateTimeRange","time_start-time_end",["申请时间开始","结束时间"]],["dateTimeRange","verify_at_start-verify_at_end",["审核时间开始","结束时间"]]]),o=q([["用户ID","uid"],["姓名","username"],["手机号","phone"],["所在省份","province"],["所在市州","city"],["社群截图","screenshot"],["申请理由","reason",180],["申请时间","created_at"],["审核责任人","superior_username",180],["审核状态","status_name"],["审核时间","verify_at"],["备注","remark",200],["操作","operate",180,"right"]]),t=n({handlingId:0,handlingRow:{},showBeStoreAudit:!1,showBeStoreControl:!1,dataSource:[],loading:!1,query:{},pagination:H(),selectedRowKeys:[],batchs:[{label:"批量",value:""}]});B((()=>{u()}));const u=()=>{t.loading=!0,c.user.beStore.list({page:t.pagination.current,page_size:t.pagination.pageSize,...t.query}).then((e=>{var o;t.loading=!1,t.dataSource=e.data.items,1===t.pagination.current&&(t.pagination.total=+(null==(o=e.data)?void 0:o.count),A(a,"status",e.data.status_map))}))},p=e=>{t.pagination={...t.pagination,...e},u()},m=e=>{t.query=e,t.pagination={...t.pagination,current:1},u()};return(e,n)=>{const _=j("Export"),g=x,f=j("Search"),y=Y,b=D,k=L;return s(),r("div",null,[i(f,{"search-options":d(a),onOnSearch:m},{default:l((()=>[i(_,{api:d(c).user.beStore.export,query:d(t).query},null,8,["api","query"]),i(g,{type:"primary",onClick:n[0]||(n[0]=e=>d(t).showBeStoreControl=!0)},{default:l((()=>[h(" 招募控制 ")])),_:1})])),_:1},8,["search-options"]),i(k,{"row-key":"id","data-source":d(t).dataSource,columns:d(o),scroll:{x:"max-content"},loading:d(t).loading,pagination:d(t).pagination,onChange:p},{bodyCell:l((({column:e,record:a})=>["screenshot"===e.key?(s(),w(y,{key:0,width:50,height:50,src:a.screenshot},null,8,["src"])):v("",!0),"enabled"===e.key?(s(),w(b,{key:1,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await c.product.material.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=0===e.enabled?1:0}))})(a)},null,8,["checked","onUpdate:checked","onChange"])):v("",!0),"operate"===e.key?(s(),r(C,{key:2},[0===a.status?(s(),w(g,{key:0,type:"link",onClick:e=>{d(t).handlingRow=a,d(t).showBeStoreAudit=!0}},{default:l((()=>[h(" 审核 ")])),_:2},1032,["onClick"])):v("",!0)],64)):v("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),i(M,{show:d(t).showBeStoreAudit,"onUpdate:show":n[1]||(n[1]=e=>d(t).showBeStoreAudit=e),row:d(t).handlingRow,onFresh:u},null,8,["show","row"]),i(z,{show:d(t).showBeStoreControl,"onUpdate:show":n[2]||(n[2]=e=>d(t).showBeStoreControl=e)},null,8,["show"])])}}});export{I as default};
