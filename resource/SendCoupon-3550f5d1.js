import{d as e,u as a,h as s,r as t,m as l,o as n,l as o,a as i,b as u,e as d,w as p,f as r,p as m,s as c,T as _,E as f,q as v,g as y,$ as x,Z as b,v as g,A as h,I as j,B as k,a3 as w,a4 as C,_ as N}from"./index-c2ae2a0e.js";import{R as U,_ as F}from"./index-c8577ae4.js";import{_ as I}from"./ConnectUser.vue_vue_type_script_setup_true_lang-4d6feebd.js";import{_ as R}from"./index-8036da2a.js";import"./index-975d3375.js";import"./useTableColumns-dd067b4d.js";import"./FolderOpenOutlined-fa174baf.js";import"./index-3f0a4d2e.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";import"./useSearchItems-c7d75cf3.js";import"./usePagination-c05046ed.js";const $=(e=>(w("data-v-75bc7f02"),e=e(),C(),e))((()=>y("div",{class:"tips"}," 关联后，订单取消或者售后将会回收优惠券 ",-1))),q=N(e({__name:"SendCoupon",emits:["fresh"],setup(e,{emit:w}){const C=a(),N=s(),q=t(),K=t(),L={required:!0,message:"请输入"},S=N.params.id,B=l({submitLoading:!1,activeName:"sys",is_union_order:0}),O=l({num:void 0,uids:"",order_sn:void 0});n((()=>{})),o((()=>B.activeName),(()=>{}));const T=()=>{q.value.validate().then((async e=>{B.submitLoading=!0,await x.act.coupon.sendSys({...e,coupon_id:S||void 0}),B.submitLoading=!1,C.push({name:"coupon"})})).catch((e=>{console.log(e)}))},A=async()=>{try{var e=K.value.files[0],a=new FormData;a.append("file",e),a.append("coupon_id",S),a.append("is_union_order",B.is_union_order);const{data:s}=await x.act.coupon.sendFile(a,{success:!1});b.info(`成功导入${s.num}条${s.msg?"，"+s.msg:""}`),K.value=""}catch(s){K.value=""}},D=()=>{window.open(`${x.act.coupon.template.url}`)};return(e,a)=>{const s=g,t=_,l=R,n=h,o=I,x=j,b=k,w=f,C=U,N=F;return i(),u("div",null,[d(t,{activeKey:r(B).activeName,"onUpdate:activeKey":a[0]||(a[0]=e=>r(B).activeName=e)},{default:p((()=>[d(s,{key:"sys",tab:"发放系统券"}),d(s,{key:"by-file",tab:"发放订单券"})])),_:1},8,["activeKey"]),"sys"===r(B).activeName?(i(),m(w,{key:0,ref_key:"formRef",ref:q,model:r(O),autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18},style:{"padding-top":"40px",width:"1000px"}},{default:p((()=>[d(n,{name:"num",label:"每个用户发放数量",rules:L},{default:p((()=>[d(l,{value:r(O).num,"onUpdate:value":a[1]||(a[1]=e=>r(O).num=e),maxlength:10,min:1,style:{width:"300px"}},null,8,["value"])])),_:1}),d(n,{label:"发放用户",name:"uids",rules:L},{default:p((()=>[d(o,{uids:r(O).uids,"onUpdate:uids":a[2]||(a[2]=e=>r(O).uids=e)},null,8,["uids"])])),_:1}),d(n,{name:"order_sn",label:"关联订单号"},{default:p((()=>[d(x,{value:r(O).order_sn,"onUpdate:value":a[3]||(a[3]=e=>r(O).order_sn=e),maxlength:100,placeholder:"为空则视为不关联",style:{width:"300px"}},null,8,["value"])])),_:1}),d(n,{name:"",label:" ",colon:!1},{default:p((()=>[d(b,{type:"primary",onClick:T},{default:p((()=>[v(" 立即发放 ")])),_:1})])),_:1})])),_:1},8,["model"])):c("",!0),"by-file"===r(B).activeName?(i(),m(w,{key:1,autocomplete:"off","label-col":{span:5},"wrapper-col":{span:18},style:{"padding-top":"40px",width:"1000px"}},{default:p((()=>[d(n,{name:"is_union_order",label:"是否关联订单"},{default:p((()=>[d(N,{value:r(B).is_union_order,"onUpdate:value":a[4]||(a[4]=e=>r(B).is_union_order=e),style:{margin:"6px"}},{default:p((()=>[d(C,{value:1},{default:p((()=>[v(" 是 ")])),_:1}),d(C,{value:0},{default:p((()=>[v(" 否 ")])),_:1})])),_:1},8,["value"]),$])),_:1}),d(n,{name:"",label:" ",colon:!1},{default:p((()=>[d(b,{type:"primary",onClick:a[5]||(a[5]=e=>r(K).click())},{default:p((()=>[v(" 导表发放 ")])),_:1}),d(b,{type:"link",style:{"margin-left":"10px"},onClick:D},{default:p((()=>[v(" 表格模板 ")])),_:1}),y("input",{ref_key:"importFileInputRef",ref:K,type:"file",style:{display:"none"},accept:".xls, .xlsx, .csv, .pdf",onChange:A},null,544)])),_:1})])),_:1})):c("",!0)])}}}),[["__scopeId","data-v-75bc7f02"]]);export{q as default};
