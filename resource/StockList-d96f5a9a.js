import{d as a,c as e,r as o,i as s,m as t,a as n,b as l,e as i,w as d,f as c,k as r,$ as u,M as p,F as h,n as g,p as m,q as _,z as k,A as y,C as f,D as w,E as v,o as b,G as S,H as I,s as j,x,B}from"./index-c2ae2a0e.js";import{u as R,_ as C}from"./useTableColumns-dd067b4d.js";import{R as q,_ as K}from"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as G}from"./useSearchItems-c7d75cf3.js";import{u as D}from"./usePagination-c05046ed.js";import{_ as O}from"./index-8036da2a.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const U=a({__name:"BatchStock",props:{show:Boolean,id:String,goodsId:Number},emits:["fresh"],setup(a,{emit:b}){const S=a,I=e((()=>Array.isArray(S.id))),j=o(),x=s(S,"show",b),B=t({chg_types:[{value:1,label:"增加"},{value:2,label:"减少"},{value:3,label:"重置"}]}),R=t({chg_type:1,stock_num:""}),C=()=>{j.value.validate().then((async a=>{if(I.value){const e=S.id.map(((e,o)=>({...a,id:e,goods_id:S.goodsId[o]})));await u.product.stock.batchMod({items:e,from_sku_list:1})}else await u.product.goods.setStock({...a,goods_id:S.goodsId,id:S.id});x.value=!1,b("fresh")}))};return(a,e)=>{const o=q,s=K,t=y,u=f,b=w,S=O,G=v,D=p;return n(),l("div",null,[i(D,{visible:c(x),"onUpdate:visible":e[2]||(e[2]=a=>r(x)?x.value=a:null),width:"650px",title:c(I)?"批量调整库存":"库存调整",onOk:C},{default:d((()=>[i(G,{ref_key:"formRef",ref:j,model:c(R),"label-col":{span:6},"wrapper-col":{span:18}},{default:d((()=>[i(b,null,{default:d((()=>[i(u,{span:18},{default:d((()=>[i(t,{name:"chg_type",label:"修改方式"},{default:d((()=>[i(s,{value:c(R).chg_type,"onUpdate:value":e[0]||(e[0]=a=>c(R).chg_type=a)},{default:d((()=>[(n(!0),l(h,null,g(c(B).chg_types,(a=>(n(),m(o,{key:a.value,value:a.value},{default:d((()=>[_(k(a.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),i(b,null,{default:d((()=>[i(u,{span:18},{default:d((()=>[i(t,{label:"库存",name:"stock_num",rules:[{required:!0,message:"请输入"}]},{default:d((()=>[i(S,{value:c(R).stock_num,"onUpdate:value":e[1]||(e[1]=a=>c(R).stock_num=a),style:{width:"100%"},min:0,precision:0},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),z=a({__name:"StockList",setup(a){const e=G([["input","keywords","商品ID/商品名称"]]),o=R([["商品ID","goods_id"],["商品名称","title"],["属性ID","id"],["属性","properties_name"],["商品库存","stock_num"],["销量","sale_num"],["操作","operate",180,"right"]]),s=t({handlingId:0,handlingGoodsId:[],showBatchStock:!1,dataSource:[],loading:!1,query:{},pagination:D(),selectedRowKeys:[],batchs:[{label:"批量调整库存",value:"stock"}]}),r=a=>{if("stock"===a){s.showBatchStock=!0,s.handlingId=s.selectedRowKeys;const a=[];s.handlingId.forEach((e=>{const o=s.dataSource.find((a=>a.id===e));a.push(o.goods_id)})),s.handlingGoodsId=a}};b((()=>{p()}));const p=()=>{s.loading=!0,u.product.stock.list({page:s.pagination.current,page_size:s.pagination.pageSize,...s.query}).then((a=>{var e;s.loading=!1,s.dataSource=a.data.items,1===s.pagination.current&&(s.pagination.total=+(null==(e=a.data)?void 0:e.count))}))},h=a=>{s.pagination={...s.pagination,...a},p()},g=a=>{s.query=a,s.pagination={...s.pagination,current:1},p()};return(a,t)=>{const k=S("Search"),y=B,f=C,w=S("BatchTable"),v=I("permission");return n(),l("div",null,[i(k,{"search-options":c(e),onOnSearch:g},null,8,["search-options"]),i(f,{"row-key":"id","data-source":c(s).dataSource,columns:c(o),scroll:{x:"max-content"},loading:c(s).loading,"row-selection":{selectedRowKeys:c(s).selectedRowKeys,onChange(a){c(s).selectedRowKeys=a}},pagination:c(s).pagination,onChange:h},{bodyCell:d((({column:a,record:e})=>["operate"===a.key?x((n(),m(y,{key:0,type:"link",onClick:a=>{c(s).handlingId=e.id,c(s).handlingGoodsId=e.goods_id,c(s).showBatchStock=!0}},{default:d((()=>[_(" 调整库存 ")])),_:2},1032,["onClick"])),[[v,[c(u).product.stock.batchMod]]]):j("",!0)])),_:1},8,["data-source","columns","loading","row-selection","pagination"]),c(s).dataSource.length?(n(),m(w,{key:0,batchs:c(s).batchs,"selected-row-keys":c(s).selectedRowKeys,onClick:r},null,8,["batchs","selected-row-keys"])):j("",!0),i(U,{id:c(s).handlingId,show:c(s).showBatchStock,"onUpdate:show":t[0]||(t[0]=a=>c(s).showBatchStock=a),"goods-id":c(s).handlingGoodsId,onFresh:p},null,8,["id","show","goods-id"])])}}});export{z as default};
