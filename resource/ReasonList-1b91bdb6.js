import{d as e,r as a,i as n,l as t,m as l,a as o,b as s,e as d,w as i,f as r,k as c,$ as u,M as p,F as h,n as m,p as f,q as y,z as k,a7 as v,A as g,V as b,W as _,I as w,C as S,D as x,E as j,a0 as C,o as A,G as R,H as U,s as q,x as F,B as I}from"./index-c2ae2a0e.js";import{u as K,_ as O}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{_ as B}from"./index-ef11d20c.js";import{_ as T}from"./index-8036da2a.js";import{d as z}from"./dtool-b3945d0c.js";import{u as D}from"./useSearchItems-c7d75cf3.js";import{u as E}from"./usePagination-c05046ed.js";import{d as G}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const H=e({__name:"AddReason",props:{show:Boolean,id:String,types:Array},emits:["fresh"],setup(e,{emit:C}){const A=e,R=a(),U=n(A,"show",C);t(U,(async e=>{if(e&&(R.value&&R.value.resetFields(),A.id)){const e=await u.afterSale.reason.detail({id:A.id});z(e.data).insertForm(q)}}));const q=l({reason:"",enabled:0,type:void 0,sort:void 0,need_proof:0,tip:""}),F=()=>{R.value.validate().then((async e=>{A.id?await u.afterSale.reason.edit({...q,id:A.id}):await u.afterSale.reason.add({...q}),U.value=!1,C("fresh")}))};return(a,n)=>{const t=v,l=g,u=b,C=_,A=T,I=B,K=w,O=S,z=x,D=j,E=p;return o(),s("div",null,[d(E,{visible:r(U),"onUpdate:visible":n[6]||(n[6]=e=>c(U)?U.value=e:null),width:"650px",title:"添加",onOk:F},{default:i((()=>[d(D,{ref_key:"formRef",ref:R,model:r(q),"label-col":{span:6},"wrapper-col":{span:18}},{default:i((()=>[d(z,null,{default:i((()=>[d(O,{span:18},{default:i((()=>[d(l,{name:"reason",label:"原因",required:""},{default:i((()=>[d(t,{value:r(q).reason,"onUpdate:value":n[0]||(n[0]=e=>r(q).reason=e),"show-count":"",maxlength:255},null,8,["value"])])),_:1}),d(l,{name:"type",label:"类型",required:""},{default:i((()=>[d(C,{value:r(q).type,"onUpdate:value":n[1]||(n[1]=e=>r(q).type=e),placeholder:"请选择"},{default:i((()=>[(o(!0),s(h,null,m(e.types,(e=>(o(),f(u,{key:e[1],value:e[1]},{default:i((()=>[y(k(e[0]),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),d(l,{name:"sort",label:"排序",required:""},{default:i((()=>[d(A,{value:r(q).sort,"onUpdate:value":n[2]||(n[2]=e=>r(q).sort=e)},null,8,["value"])])),_:1}),d(l,{name:"need_proof",label:"是否需要填写售后凭证"},{default:i((()=>[d(I,{checked:r(q).need_proof,"onUpdate:checked":n[3]||(n[3]=e=>r(q).need_proof=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1}),d(l,{name:"tip",label:"温馨提示"},{default:i((()=>[d(K,{value:r(q).tip,"onUpdate:value":n[4]||(n[4]=e=>r(q).tip=e)},null,8,["value"])])),_:1}),d(l,{name:"enabled",label:"是否启用"},{default:i((()=>[d(I,{checked:r(q).enabled,"onUpdate:checked":n[5]||(n[5]=e=>r(q).enabled=e),"un-checked-value":0,"checked-value":1},null,8,["checked"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}}),L=e({__name:"ReasonList",setup(e){const a=[["取消订单",1],["申请售后",2]],n=C("enums"),t=D([["input","reason","原因"],["select","type","类型",[["全部",0],...a]],["select","enabled","状态",n.value.enabled]]),c=K([["编号","id"],["原因","reason",300],["类型","type_name"],["排序","sort"],["温馨提示","tip"],["是否需要填写售后凭证","need_proof_name"],["是否启用","enabled"],["添加时间","created_at",180],["操作","operate",180,"right"]]),p=l({handlingId:0,dataSource:[],loading:!1,showAdd:!1,query:{},pagination:E(),selectedRowKeys:[],batchs:[{label:"批量删除",value:"del"}]}),m=e=>{"del"===e&&v(p.selectedRowKeys)};A((()=>{k()}));const k=()=>{p.loading=!0,u.afterSale.reason.list({page:p.pagination.current,page_size:p.pagination.pageSize,...p.query}).then((e=>{var a;p.loading=!1,p.dataSource=e.data.items,1===p.pagination.current&&(p.pagination.total=+(null==(a=e.data)?void 0:a.count))}))},v=async e=>{G.confirm({title:"提示",content:"确认删除?",okText:"确认",cancelText:"取消",async onOk(){Array.isArray(e)?await u.afterSale.reason.batchDel({ids:e.join(",")}):await u.afterSale.reason.del({id:e}),k()},onCancel(){}})},g=e=>{p.pagination={...p.pagination,...e},k()},b=e=>{p.query=e,p.pagination={...p.pagination,current:1},k()};return(e,n)=>{const l=I,_=R("Search"),w=B,S=O,x=R("BatchTable"),j=U("permission");return o(),s("div",null,[d(_,{"search-options":r(t),onOnSearch:b},{default:i((()=>[F((o(),f(l,{type:"primary",onClick:n[0]||(n[0]=e=>{r(p).showAdd=!0,r(p).handlingId=0})},{default:i((()=>[y(" 添加 ")])),_:1})),[[j,[r(u).afterSale.reason.add]]])])),_:1},8,["search-options"]),d(S,{"row-key":"id","data-source":r(p).dataSource,columns:r(c),scroll:{x:"max-content"},loading:r(p).loading,"row-selection":{selectedRowKeys:r(p).selectedRowKeys,onChange(e){r(p).selectedRowKeys=e}},pagination:r(p).pagination,onChange:g},{bodyCell:i((({column:e,record:a})=>["enabled"===e.key?(o(),f(w,{key:0,checked:a.enabled,"onUpdate:checked":e=>a.enabled=e,"un-checked-value":0,"checked-value":1,onChange:e=>(async e=>{await u.afterSale.reason.status({id:e.id,enabled:e.enabled}).catch((a=>{e.enabled=0===e.enabled?1:0}))})(a)},null,8,["checked","onUpdate:checked","onChange"])):q("",!0),"operate"===e.key?(o(),s(h,{key:1},[F((o(),f(l,{type:"link",onClick:e=>{r(p).handlingId=a.id,r(p).showAdd=!0}},{default:i((()=>[y(" 编辑 ")])),_:2},1032,["onClick"])),[[j,[r(u).afterSale.reason.edit]]]),F((o(),f(l,{type:"link",danger:"",onClick:e=>v(a.id)},{default:i((()=>[y(" 删除 ")])),_:2},1032,["onClick"])),[[j,[r(u).afterSale.reason.del]]])],64)):q("",!0)])),_:1},8,["data-source","columns","loading","row-selection","pagination"]),r(p).dataSource.length?(o(),f(x,{key:0,batchs:r(p).batchs,"selected-row-keys":r(p).selectedRowKeys,onClick:m},null,8,["batchs","selected-row-keys"])):q("",!0),d(H,{id:r(p).handlingId,show:r(p).showAdd,"onUpdate:show":n[1]||(n[1]=e=>r(p).showAdd=e),types:a,onFresh:k},null,8,["id","show"])])}}});export{L as default};
