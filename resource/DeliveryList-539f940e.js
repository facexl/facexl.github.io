import{e,as as t,d as a,a0 as n,m as o,o as i,$ as r,G as s,H as l,a as c,b as d,w as u,f as p,g as m,x as g,p as v,Z as f,cO as y,B as _,q as h,F as b,n as O,z as j,s as x,V as w,W as I,I as k,_ as S}from"./index-c2ae2a0e.js";import{u as L,_ as D}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as C,a as F}from"./useSearchItems-c7d75cf3.js";import{u as P}from"./usePagination-c05046ed.js";import{d as q}from"./index-a09a23de.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){B(e,t,a[t])}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var E=function(a,n){var o=M({},a,n.attrs);return e(t,M({},o,{icon:z}),null)};E.displayName="ToTopOutlined",E.inheritAttrs=!1;const H=E;const V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};function $(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){A(e,t,a[t])}))}return e}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var R=function(a,n){var o=$({},a,n.attrs);return e(t,$({},o,{icon:V}),null)};R.displayName="VerticalAlignBottomOutlined",R.inheritAttrs=!1;const T=R,U={class:"btn-line"},N=S(a({__name:"DeliveryList",setup(t){n("enums");const a=C([["input","order_sn","订单编号"],["input","order_id","订单ID"],["input","supplier_name","供应商"],["input","goods_id","商品ID"],["select","cate_id","商品分类"],["input","goods_title","商品标题"],["input","uid","下单人ID"],["input","receiver_name","收货人姓名"],["input","receiver_phone","收货人电话"],["dateRange ","time_start-time_end",["下单时间开始","下单时间结束"]]]),S=L([["订单编号","order_sn"],["订单ID","order_id"],["快递选择","code"],["快递单号","sn"],["供应商","supplier_name"],["商品ID","goods_id"],["商品分类","cate_name"],["商品标题","goods_title"],["规格","skus"],["下单人ID","uid"],["实付金额","actual_fee"],["收货人姓名","receiver_name"],["收货人电话","receiver_phone"],["收货人地址","receiver_full_address"],["下单时间","created_at"],["导出次数","export_num"],["用户备注","user_remark"]]),z=o({handlingId:"",handlingRow:{},dataSource:[],loading:!1,query:{},pagination:P(),selectedRowKeys:[],calculate:{},logisticsMap:{}});i((()=>{M(),r.common.getLogisticsMap({}).then((e=>{z.logisticsMap=e.data}))}));const M=()=>{z.loading=!0,r.order.deliveryList.list({page:z.pagination.current,page_size:z.pagination.pageSize,status:z.tab_status,...z.query}).then((e=>{var t;z.loading=!1,e.data.items.forEach((e=>{e.code=e.logistics_code||void 0,e.sn=e.logistics_sn})),z.dataSource=e.data.items,z.calculate=e.data.calculate,1===z.pagination.current&&(z.pagination.total=+(null==(t=e.data)?void 0:t.count)),F(a,"client_type",e.data.client_type_map),F(a,"cate_id",e.data.categories_map)}))},B=()=>{r.order.deliveryList.send({}).then((e=>{if(0===e.data.send_num)return f.info("快递单号未设置，请先保存");f.info(`成功发出${e.data.send_num}个订单`),M()}))},E=()=>{let e=!0;const t=z.dataSource.filter((e=>e.code&&e.sn)).map((t=>(!/^[a-zA-Z0-9]+$/.test(t.sn)&&e&&(f.error("物流单号只能是数字和英文!"),e=!1),{id:t.order_id,code:t.code,sn:t.sn.replace(/\s*/g,"")})));e&&(t.length<1?f.error("请选择快递及填写对应单号"):r.order.deliveryList.saveSn({items:t}).then((e=>{M()})))},V=()=>{window.open(`${r.order.deliveryList.template.url}`)},$=e=>{z.pagination={...z.pagination,...e},M()},A=()=>{document.getElementById("importFileInput").click()},R=e=>{z.query=e,z.pagination={...z.pagination,current:1},M()},N=async(e=0)=>{let t,a,n=document.getElementById("importFileInput")||{};e?(a=z.formFile,a.append("version",2)):(t=n.files[0],a=new FormData,a.append("file",t),a.append("version",1),z.formFile=a);const o=await r.order.deliveryList.import(a);let i=[];o.data.message&&(o.data.message=o.data.message.split("<br>"),o.data.message.forEach((e=>{i.push(y("p",e))}))),o.data.need_confirmed?q.confirm({title:"提示",content:y("div",{width:"650px",maxHeight:"600px",overflow:"auto"},i),onOk:()=>{N(1)},onCancel:()=>{n.value=""}}):(q.info({title:"提示",content:y("div",{},[y("p",o.data.imported_num?`成功导入${o.data.imported_num}行`:""),...i])}),setTimeout((()=>{n.value="",M()}),1500))};return(t,n)=>{const o=s("Export"),i=s("Search"),f=_,y=w,L=I,C=k,F=D,P=l("permission");return c(),d("div",null,[e(i,{"search-options":p(a),onOnSearch:R},{default:u((()=>[g(e(o,{api:p(r).order.deliveryList.export,query:p(z).query},null,8,["api","query"]),[[P,[p(r).order.deliveryList.export]]])])),_:1},8,["search-options"]),m("div",U,[m("input",{id:"importFileInput",ref:"importFileInput",type:"file",style:{display:"none"},accept:".xls, .xlsx, .csv, .pdf",onChange:n[0]||(n[0]=()=>N())},null,544),g((c(),v(f,{type:"primary",onClick:A},{icon:u((()=>[e(p(H))])),default:u((()=>[h("导入 ")])),_:1})),[[P,[p(r).order.deliveryList.import]]]),g((c(),v(f,{type:"primary",ghost:"",onClick:E},{default:u((()=>[h(" 保存 ")])),_:1})),[[P,[p(r).order.deliveryList.saveSn]]]),g((c(),v(f,{type:"primary",ghost:"",onClick:B},{default:u((()=>[h(" 一键发货 ")])),_:1})),[[P,[p(r).order.deliveryList.send]]]),e(f,{onClick:V},{icon:u((()=>[e(p(T))])),default:u((()=>[h("模板 ")])),_:1})]),e(F,{"data-source":p(z).dataSource,columns:p(S),scroll:{x:"max-content"},loading:p(z).loading,pagination:p(z).pagination,onChange:$},{bodyCell:u((({column:e,record:t})=>["code"===e.key?(c(),v(L,{key:0,value:t.code,"onUpdate:value":e=>t.code=e,placeholder:"请选择快递公司",style:{width:"140px"},"allow-clear":""},{default:u((()=>[(c(!0),d(b,null,O(p(z).logisticsMap||{},((e,t)=>(c(),v(y,{key:t,value:t},{default:u((()=>[h(j(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):x("",!0),"sn"===e.key?(c(),v(C,{key:1,value:t.sn,"onUpdate:value":e=>t.sn=e,placeholder:"请输入物流单号"},null,8,["value","onUpdate:value"])):x("",!0)])),_:1},8,["data-source","columns","loading","pagination"])])}}}),[["__scopeId","data-v-fd2cd8be"]]);export{N as default};
