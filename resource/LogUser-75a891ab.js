import{d as a,i as n,m as e,o,l as t,a as l,b as i,e as d,w as s,f as r,k as g,M as c,g as p,z as m,s as _,F as u,n as h,x as f,y,p as b,a2 as I,$ as v,S as w,_ as O,G as j}from"./index-c2ae2a0e.js";import{u as k,_ as N}from"./useTableColumns-dd067b4d.js";import"./index-c8577ae4.js";import"./index-3f0a4d2e.js";import{u as T,a as C}from"./useSearchItems-c7d75cf3.js";import{u as x}from"./usePagination-c05046ed.js";import{L as D}from"./log-6aa04327.js";import"./FolderOpenOutlined-fa174baf.js";import"./tool-d986b095.js";import"./RadioButton-bc4165ed.js";const A={class:"label"},S={class:"label"},$={key:0,class:"label"},L={key:1,class:"label"},q={key:2,class:"label"},B={class:"label"},U={class:"label"},z={key:0,class:"label",style:{"margin-top":"10px"}},F={key:1,class:"label",style:{"margin-top":"10px"}},M=O(a({__name:"LogUserDetail",props:{show:Boolean,id:Number,handlingInfo:{type:Object,default:()=>{}},ACTION_NO_BOTTOM:{type:Array,default:[]},ACTION:{type:Array,default:[]},name:String},emits:["fresh"],setup(a,{emit:O}){const j=a,T=n(j,"show",O),C=k([["字段","name"],["操作前","before",430],["操作后","behind",430]]),x=e({loading:!1,keys:{},list:[]});o((()=>{})),t(T,(a=>{if(a){x.loading=!0,v.jurisdiction.log.getKey({log_service:j.name,log_type:j.handlingInfo.log_type}).then((a=>{x.keys=a.data||{},setTimeout((a=>{x.loading=!1}),50)}));let a=j.handlingInfo,n=[];a.old_data=a.old_data||{},n.push({tableData:D.toList(a.old_data,a.new_data,j.name)}),console.log(n),x.list=n}}));const M=a=>{for(let n=0;n<j.ACTION.length;n++)if(j.ACTION[n].value==a)return j.ACTION[n].label};return(n,e)=>{const o=N,t=w,v=c;return l(),i("div",null,[d(v,{visible:r(T),"onUpdate:visible":e[0]||(e[0]=a=>g(T)?T.value=a:null),width:"1100px",title:"操作记录","mask-closable":!1,footer:null,onOk:n.handleOk},{default:s((()=>[d(t,{spinning:r(x).loading},{default:s((()=>[p("div",A," 操作对象："+m(`${a.handlingInfo.object_name}(id:${a.handlingInfo.object_id})`),1),p("div",S," 操作名："+m(M(a.handlingInfo.log_type)),1),4==a.handlingInfo.log_type?(l(),i("div",$," 调整积分值："+m(a.handlingInfo.new_data.integral),1)):_("",!0),2==a.handlingInfo.log_type?(l(),i("div",L," 优惠券："+m(a.handlingInfo.new_data.coupon_name)+"(id:"+m(a.handlingInfo.new_data.coupon_id)+") ",1)):_("",!0),2==a.handlingInfo.log_type?(l(),i("div",q," 数量："+m(a.handlingInfo.new_data.coupon_num),1)):_("",!0),p("div",B," 操作人："+m(a.handlingInfo.admin_name),1),p("div",U," 操作时间："+m(a.handlingInfo.handle_time),1),(l(!0),i(u,null,h(r(x).list,((n,e)=>f((l(),i("div",{key:e},[n.data_name&&"类目规格"!==n.data_name?(l(),i("div",z," 【"+m(n.data_name)+"】： ",1)):_("",!0),n.data_name&&"类目规格"===n.data_name?(l(),i("div",F,m(n.data_name1),1)):_("",!0),n.tableData&&n.tableData.length?(l(),b(o,{key:2,"data-source":n.tableData,columns:r(C),scroll:{x:"max-content"},loading:r(x).loading,pagination:!1},{bodyCell:s((({column:a,record:n})=>["name"===a.key?(l(),i("span",{key:0,style:I({color:n.before===n.behind?"#000000":"red"})},m(r(x).keys[n.name]||n.name),5)):_("",!0)])),_:2},1032,["data-source","columns","loading"])):_("",!0)])),[[y,!a.ACTION_NO_BOTTOM.includes(a.handlingInfo.log_type)]]))),128))])),_:1},8,["spinning"])])),_:1},8,["visible","onOk"])])}}}),[["__scopeId","data-v-c46c745e"]]),J=["onClick"],R="user",E=O(a({__name:"LogUser",setup(a){const n=[],t=T([["input","admin_id","操作者ID"],["dateRange","start_time-end_time",["开始时间","结束时间"]],["select","log_type","动作"],["input","object_id","目标ID"]]),g=k([["操作者","admin_name"],["操作者ID","admin_id"],["操作时间","handle_time"],["模块","log_type"],["操作名","handle_name"],["操作对象","object_name",340],["操作记录","operate"]]),c=e({handlingId:0,dataSource:[],loading:!1,query:{},pagination:x(),showNewDialog:!1,handlingInfo:{},ACTION:[]});o((()=>{p(),u()}));const p=()=>{c.loading=!0,v.jurisdiction.log.userList({page:c.pagination.current,page_size:c.pagination.pageSize,...c.query}).then((a=>{var n;c.loading=!1,a.data.items.forEach((a=>{a.new_data=a.new_data?JSON.parse(a.new_data):{},a.old_data=a.old_data?JSON.parse(a.old_data):{}})),c.dataSource=a.data.items,1===c.pagination.current&&(c.pagination.total=+(null==(n=a.data)?void 0:n.count))}))},u=async()=>{try{const{data:a}=await v.jurisdiction.log.getType({log_service:R});let n=[];for(let e in a)n.push({label:a[e],value:+e});c.ACTION=n,C(t,"log_type",n)}catch(a){}},h=a=>{c.pagination={...c.pagination,...a},p()},f=a=>{c.query=a,c.pagination={...c.pagination,current:1},p()};return(a,e)=>{const o=j("Search"),u=N;return l(),i("div",null,[d(o,{"search-options":r(t),onOnSearch:f},null,8,["search-options"]),d(u,{"data-source":r(c).dataSource,columns:r(g),scroll:{x:"max-content"},loading:r(c).loading,pagination:r(c).pagination,onChange:h},{bodyCell:s((({column:a,record:n})=>["operate"===a.key?(l(),i("a",{key:0,class:"cell",href:"javascript:;",onClick:a=>{r(c).handlingId=n.id,r(c).handlingInfo=n,r(c).showNewDialog=!0}},m(`操作对象：${n.object_name}(id:${n.object_id})，操作名：`)+" "+m(n.handle_name)+" "+m(`，操作人：${n.admin_name}，操作时间：`)+" "+m(n.handle_time),9,J)):_("",!0)])),_:1},8,["data-source","columns","loading","pagination"]),d(M,{id:r(c).handlingId,show:r(c).showNewDialog,"onUpdate:show":e[0]||(e[0]=a=>r(c).showNewDialog=a),"handling-info":r(c).handlingInfo,"a-c-t-i-o-n":r(c).ACTION,"a-c-t-i-o-n-n-o-b-o-t-t-o-m":n,name:R,onFresh:p},null,8,["id","show","handling-info","a-c-t-i-o-n"])])}}}),[["__scopeId","data-v-bbb559d4"]]);export{E as default};
